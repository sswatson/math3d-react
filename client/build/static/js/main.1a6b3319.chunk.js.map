{"version":3,"sources":["utils/colors.js","components/SubtleButton/index.js","containers/Drawer/components/DrawerToggleButton.js","containers/Drawer/components/Drawer.js","containers/Drawer/actions.js","containers/Drawer/reducer.js","services/errors/ErrorData.js","services/errors/actions.js","containers/MathObjects/actions.js","containers/ControlledTabs/reducer.js","containers/MathObjects/MathObject.js","components/SortableList/PartlyDraggable.js","components/SortableList/index.js","utils/functions/index.js","services/LoopManager.js","components/MathBox/MathBox.js","utils/mathjs/custom.js","utils/mathjs/derivatives.js","utils/mathjs/index.js","components/MathBox/helpers.js","utils/shallowDiffWithSets.js","utils/marchingCubes/triangleTable.js","utils/marchingCubes/index.js","constants/colors.js","components/MathBox/MathBoxComponents.js","utils/helpers.js","containers/MathObjects/MathGraphics/MathGraphic.js","components/EditableDescription/getTextWidth.js","components/EditableDescription/index.js","containers/MathObjects/components/DeleteButton.js","constants/theme.js","containers/MathObjects/components/MathObjectUI.js","containers/MathObjects/services/activeObject/actions.js","containers/MathObjects/selectors.js","containers/MathObjects/Folder/metadata.js","containers/MathObjects/MathObjectUI.js","containers/MathObjects/MathGraphics/metadata.js","components/MathQuill/index.js","containers/MathObjects/containers/MathInput/components/MathQuillStyled.js","utils/mathParsing/MathExpression.js","utils/sets/index.js","utils/mathParsing/preprocessors/preprocessHOFs.js","utils/mathParsing/Parser.js","utils/mathParsing/preprocessors/preprocessMathQuill.js","utils/mathParsing/postprocessors/reassignOperators.js","utils/mathParsing/mathscope.js","constants/parsing.js","containers/MathObjects/containers/MathInput/components/validators.js","containers/MathObjects/containers/MathInput/components/MathInput.js","services/errors/selectors.js","containers/MathObjects/containers/MathInput/selectors.js","containers/MathObjects/containers/MathInput/MathInputLHS.js","containers/MathObjects/containers/MathInput/MathInputRHS.js","containers/MathObjects/containers/MathInput/ConnectedStaticMath.js","containers/MathObjects/containers/ToggleSwitch/index.js","containers/MathObjects/components/MainRow.js","containers/MathObjects/MathGraphics/Camera/UseComputedToggle.js","containers/MathObjects/MathGraphics/Camera/index.js","components/LongPressable/index.js","containers/MathObjects/MathGraphics/containers/EvaluatedStatusSymbol/components/StatusSymbol/components/ColorSquare.js","containers/MathObjects/MathGraphics/containers/EvaluatedStatusSymbol/components/StatusSymbol/components/ColorPicker.js","containers/MathObjects/MathGraphics/containers/EvaluatedStatusSymbol/components/StatusSymbol/components/ColorPickerPopover.js","containers/MathObjects/MathGraphics/containers/EvaluatedStatusSymbol/components/StatusSymbol/index.js","containers/MathScopeContext/components/MathScopeContext.js","containers/MathObjects/MathSymbols/VariableSlider/metadata.js","containers/MathObjects/MathSymbols/VariableSlider/components/SliderValueDisplay.js","services/evalData.js","containers/MathObjects/MathSymbols/VariableSlider/components/EvaluatedSlider.js","containers/MathObjects/MathSymbols/VariableSlider/components/AnimationControls.js","containers/MathObjects/MathSymbols/VariableSlider/components/VariableSlider.js","containers/MathObjects/MathSymbols/VariableSlider/index.js","containers/MathObjects/MathSymbols/VariableSlider/actions.js","containers/MathScopeContext/selectors.js","containers/MathScopeContext/index.js","containers/MathObjects/MathGraphics/containers/EvaluatedStatusSymbol/components/EvaluatedStatusSymbol.js","containers/MathObjects/MathGraphics/containers/EvaluatedStatusSymbol/index.js","containers/MathObjects/containers/Settings/components/SettingsButton.js","containers/MathObjects/containers/Settings/components/SettingsContainer.js","containers/MathObjects/containers/Settings/components/SettingsContent.js","containers/MathObjects/containers/Settings/components/Settings.js","containers/MathObjects/containers/Settings/index.js","containers/MathObjects/MathGraphics/containers/MathGraphicUI/components/MathGraphicUI.js","containers/MathObjects/MathGraphics/containers/MathGraphicUI/index.js","containers/MathObjects/MathGraphics/Point/index.js","containers/MathObjects/MathGraphics/Line/index.js","containers/MathObjects/MathGraphics/Vector/index.js","containers/MathObjects/MathGraphics/Axis/index.js","containers/MathObjects/MathGraphics/Grid/index.js","containers/MathObjects/MathGraphics/ParametricCurve/index.js","containers/MathObjects/MathGraphics/ParametricSurface/containers/components/ColorScale.js","containers/MathObjects/MathGraphics/ParametricSurface/containers/ParametricSurfaceStatus.js","containers/MathObjects/MathGraphics/ParametricSurface/index.js","containers/MathObjects/MathGraphics/ImplicitSurface/index.js","containers/MathObjects/MathGraphics/VectorField/index.js","containers/MathObjects/MathGraphics/index.js","containers/MathObjects/MathSymbols/Variable/index.js","containers/MathObjects/MathSymbols/Variable/metadata.js","containers/MathObjects/MathSymbols/Variable/components/Variable.js","containers/MathObjects/MathSymbols/BooleanVariable/metadata.js","containers/MathObjects/MathSymbols/BooleanVariable/components/BooleanVariable.js","containers/MathObjects/MathSymbols/BooleanVariable/index.js","containers/MathObjects/MathSymbols/index.js","containers/MathObjects/Folder/components/CollapsedIndicator.js","containers/MathObjects/Folder/components/Folder.js","containers/MathObjects/Folder/selectors.js","containers/MathObjects/Folder/index.js","containers/MathObjects/Folder/actions.js","containers/MathObjects/index.js","containers/SortableTree/reducer.js","containers/MathObjects/MathSymbols/VariableSlider/reducer.js","services/metadata/reducer.js","containers/MathObjects/reducer.js","constants/idGenerator.js","store/initialState.js","store/hydration.js","store/actions.js","services/lastSavedState/reducer.js","services/errors/reducer.js","store/reducer.js","services/metadata/actions.js","containers/ControlledTabs/actions.js","containers/SortableTree/actions.js","containers/MathObjects/services/activeObject/reducer.js","services/lastSavedState/actions.js","store/index.js","components/FlexContainer/index.js","containers/Drawer/index.js","containers/SortableTree/components/MathTree.js","containers/SortableTree/index.js","containers/ControllerHeader/components/ControllerHeader.js","containers/ControllerHeader/selectors.js","containers/ControllerHeader/index.js","components/ScrollWithOverflow/index.js","containers/ControlledTabs/index.js","views/MainView/UserControls/components/ControlsDrawer.js","constants/index.js","containers/Drawer/ScreenSizeDrawerManager.js","views/MainView/UserControls/index.js","containers/MathBoxContainer/components/MathBoxContainer.js","containers/MathBoxContainer/index.js","containers/MathBoxScene/components/MathBoxScene.js","containers/MathBoxScene/index.js","views/MainView/Scene.js","views/MainView/Examples/ExamplesList.js","views/MainView/Examples/data.js","views/MainView/Examples/index.js","components/PopModal/index.js","services/api/index.js","services/getCameraData.js","views/MainView/Header/containers/ShareButton/components/ShareButton.js","views/MainView/Header/containers/ShareButton/index.js","views/MainView/Header/components/HeaderButton.js","views/MainView/Header/containers/TitleInput/index.js","views/MainView/Header/components/HelpButton.js","views/MainView/Header/containers/ExamplesButton/index.js","views/MainView/Header/containers/HeaderMenu/index.js","views/MainView/Header/index.js","views/MainView/index.js","views/MainView/actions.js","App.js","registerServiceWorker.js","index.js","services/lastSavedState/index.js"],"names":["lighten","colorStr","amount","color","Color","increaseBy","lightness","hex","buttonEffects","css","props","focusColor","theme","primary","pressing","lightenOnHover","backgroundColor","SubtleButtonInner","styled","button","borderRadius","transitionDuration","transitionTimingFunction","disabled","SubtleButton","state","getRef","ref","endPress","setState","beginPress","focus","this","otherProps","Error","onPointerDown","onPointerUp","onPointerLeave","PureComponent","defaultProps","StyledButton","side","buttonIcons","left","true","false","right","DrawerToggleButton","onClick","isDrawerOpen","onClose","onOpen","iconType","slideTo","type","DrawerContainer","div","width","gray","animationSpeed","Drawer","bind","id","children","isOpen","isAnimating","className","classNames","opening","buttonSide","React","DEFAULT_ANIMATION_SPEED","setVisibility","isVisible","payload","setAnimationStatus","closeDrawer","msDuration","cssTime","from","dispatch","setTimeout","openDrawer","initialState","main","examples","ErrorData","errorMsg","isError","undefined","ParseErrorData","EvalErrorData","RenderErrorData","setError","property","errorData","toggleProperty","name","setProperty","value","setPropertyAndError","error","batchActions","controls","activeTab","MathSymbol","config","reducer","support","Object","assign","PartlyDraggable","targetUndraggable","event","target","rootEle","rootRef","current","isDragAllowed","createRef","isDragDisabled","key","element","classList","contains","top","isElementDraggable","parentElement","DraggableItemContainer","isDragging","SortableList","droppableType","draggableType","style","renderItem","droppableId","isDropDisabled","provided","snapshot","innerRef","items","map","item","index","draggableProps","draggableId","dragHandleProps","placeholder","renderDraggableItem","timeout","delay","Promise","resolve","LoopManager","threestrap","slowOnTime","slowOffTime","isInSlowMode","isPointerDown","isScrolling","unbindEventListeners","canvas","removeEventListener","downHandler","enterSlowMode","touchExitHandler","wheelHandler","slowModeCycle","a","Loop","start","stop","exitSlowMode","mouseUpHandler","touches","length","scrollTime","addEventListener","MathBox","mathboxNode","mathbox","updateSymbol","Symbol","loopManager","three","child","mathboxParent","math","core","create","require","EPS","EPS2","diff","f","derivative","args","derivComponents","arg","j","add","initialValue","finalValue","divide","subtract","defineProperty","values","unitT","t","tangent","norm","unitN","normal","imaginaryUnit","customMath","i","pdiff","diffNumber","pop","original","unitB","cross","fullDeriv","trace","curl","x","y","z","dxf","dyf","dzf","k","I","arcsin","asin","arccos","acos","arctan","arg0","arg1","atan","atan2","arcsinh","asinh","arccosh","acosh","arctanh","atanh","override","isEqualNumerically","obj1","obj2","Array","every","isReal","validateReal","TypeError","isComplex","Complex","isVector","numComponents","real","validateVector","validateFunctionSignature","func","numInputs","numOutputs","String","theArgs","Math","random","result","hasFunctionSignature","err","window","diffWithSets","base","compared","difference","keys","reduce","acc","Set","triangleTable","interp","x1","x2","b","c","MarchingCube","xStep","yStep","zStep","v1","v2","v4","v8","v16","v32","v64","v128","edgePoints","Map","bit","edgeIndex","has","get","set","THREE","colors","colorMaps","rainbow","frac","setHSL","r","g","bluered","temperature","AbstractMBC","oldProps","diffProps","added","deleted","unchanged","updated","shouldComponentUpdate","nextProps","prop","size","componentDidMount","ReferenceError","constructor","mathboxRender","forceUpdate","updateHandledProps","componentWillUnmount","remove","renderChildren","nodeNames","select","join","propsToUpdate","nodes","dataNodes","getNodes","dataNodeNames","renderNodes","renderNodeNames","groupNode","root","errors","forEach","handlers","hasOwnProperty","extraErrors","handleErrors","differing","updatedProps","propName","console","warn","makeSetProperty","validator","handledProps","defaultHandleErrors","universalHandlers","opacity","zBias","zIndex","zOrder","calculatedVisibility","useCalculatedVisibility","validateBoolean","visible","lineLikeHandlers","end","surfaceHandlers","shaded","makeHandleLabel","dataOffset","data","fill","label","handleLabelVisible","labelVisible","scaleToUnit","xMin","xMax","Camera","handleIsOrthographic","isOrthographic","dollyZoom","dollyZoomFactor","handleUseComputed","computedPosition","computedLookAt","handleComputedPosition","handleComputedLookAt","useComputed","cartesian","relPosition","toRelativeCoords","camera","position","translateForDollyZoom","parent","group","classes","proxy","relativePosition","handleRelativePosition","relativeLookAt","handleRelativeLookAt","isRotateEnabled","handleIsRotateEnabled","isZoomEnabled","handleIsZoomEnabled","isPanEnabled","handlePanIsPanEnabled","fovDegrees","distance","tan","PI","height","mathboxRoot","zoomFactor","d1","distanceTo","center","fov1","fov","h","frustrumHeightAtDistance","d2","fov2","fovForHeightAndDistance","d","translateZ","noPan","noZoom","noRotate","relLookAt","coords","range","scale","toArray","coord","max","min","Cartesian","Axis","handleLabel","handleMin","handleMax","axis","handleAxis","handleScale","ticksVisible","handleTicksVisible","node","nice","zero","ticks","format","digits","array","channels","live","text","weight","offset","getCartesian","scaleCopy","setAxisEnd","labelPosition","vec3Object","vec3ToArray","endIndex","cartesianRange","copyCartesianRange","axisMap","axisNode","currentNode","Grid","axes","handleAxes","handleWidth","divisions","handleDivisions","snap","handleSnap","grid","divideX","divideY","niceX","niceY","Point","handleCoords","point","Number","Line","line","Vector","components","handleComponents","tail","handleTail","updateData","head","ParametricCurve","handleRange","expr","handleExpr","samples","handleSamples","interval","points","emit","ParametricSurface","handleColor","lines","colorsNode","handleColorExpr","lineColor","canUpdateColorExpr","colorExpr","uSamples","vSamples","rangeU","rangeV","isExprValid","isRangeValid","trueParamsFunc","getTrueParamsFunc","transformedExpr","transformExpr","updateColorExpr","area","updateExpr","validateExpr","renderParametricSurface","handleZOrder","handleUSamples","handleVSamples","gridWidth","handleGridWidth","gridOpacity","handleGridOpacity","gridU","handleGridU","gridV","handleGridV","rerender","colorsArea","valueToColor","yMin","yMax","zMin","zMax","u","v","trueU","trueV","X","Y","Z","isArray","du","dv","trueParmasFunc","rangeX","rangeY","surface","resample","source","transpose","order","newNodes","ExplicitSurface","ExplicitSurfacePolar","cos","sin","ImplicitSurface","lhs","handleLHS","rhs","handleRHS","makeHandleRange","rangeZ","strip","rangeName","canUpdate","implicitTriangles","resolution","finalTriangles","cube","cubeCase","getIndex","triangle","push","getEdgePoint","marchingCubes","trueSamplesNum","VectorField","renderVectorField","updateRangeAndExpr","volume","canUpdateRangeAndExpr","scaledX","scaledY","scaledZ","percentX","percentY","percentZ","vx","vy","vz","vector","depth","capitalize","string","charAt","toUpperCase","slice","toLowerCase","escapeRegExp","str","replace","replaceAll","find","replaceWith","RegExp","findClosingBrace","startIdx","openingBrace","closingBrace","stack","MathGraphic","description","metadata","uiComponent","mathboxComponent","defaultSettings","getDefaultSettings","computedProps","filter","inputType","initial","defaultValue","getTextWidth","font","context","document","createElement","getContext","metrics","measureText","floor","StyledTextarea","Textarea","maxwidth","EditableDescription","onChange","currentTarget","textWidth","getWidthFromText","rows","StyledDeleteButton","DeleteButton","transitionDurationMS","OuterContainer","span","isActive","isDeleting","SidePanel","AncestryLine","MainContainer","HeaderContainer","MathObjectUI","parentMaxWidth","onDelete","parentId","positionInParent","setActiveObject","deleteMathObject","onFocus","onEditDescription","containerRef","getParentMaxWidth","containerElement","offsetWidth","sidePanelContent","isDeleteable","isFolder","showAncestry","getParent","tree","nodeId","parentFolders","objOfArrays","includes","getContainingArrayKeys","FOLDER","mapDispatchToProps","connect","ownProps","sortableTree","mathObjectData","found","mathGraphics","mathSymbols","folders","substate","getMathObjectData","getIsDeletable","activeObject","indexOf","genDescription","defaultDescription","isPrimary","universal","allowEmpty","labeled","axisMeta","gridMeta","pointSpecific","pointMeta","lineLike","lineSpecific","lineMeta","vectorMeta","parametricCurveMeta","surfaceLike","makeParametricSamplesAndGrid","labelU","labelV","parametricSurfacaSpecific","parametricSurfacaMeta","explicitSurfaceMeta","explicitSurfacePolarMeta","volumetricRange","implicitSurfaceMeta","vectorFieldMeta","cameraMeta","MQ","MathQuill","getInterface","isFocused","onEdit","mathField","handler","preventOnEdit","onBlur","configKeys","theConfig","edit","handlerKeys","handlerKey","getConfig","MathField","setLatex","latex","mqClasses","onEnter","onMoveOutOf","onDeleteOutOf","onUpOutOf","onSelectOutOf","onDownOutOf","StaticMath","staticMath","borderStyling","errorStyling","alignmentStyling","MathQuillStyled","hasError","displayName","StaticMathStyled","MathExpression","expression","preprocessors","postprocessors","parse","_preprocess","_postprocess","dependencies","_getDependencies","eval","memoizeOne","_getEval","_getSubscopeEquality","traverse","isAssignmentNode","isFunctionAssignmentNode","_getRHS","params","compiled","compile","scope","localScope","raw","DenseMatrix","Function","temp","newScope","oldScope","symbol","setMergeInto","hofNames","Parser","_defaultPreprocessors","_defaultPostprocessors","_cache","_preprocessors","_postprocessors","expresssion","addToCache","parsed","fromMQ","noBraceSub","convertSubscript","subStart","numStart","newExpr","fracToDivision","fracStart","divIdx","tex","mathjs","convertSingleHOF","hofName","hofStart","normalizeHOFExpression","funcStart","funcClose","argStart","operatorFnMap","fnName","op","fn","reassignOperators","DEFAULT_SYMBOL_NAMES","evalScope","parser","symbols","changed","childMap","getChildMap","getEvalOrder","evalOrder","cycles","deps","rawResult","symbolName","removeFunctionsWithMissingDeps","directDependencies","unmet","dep","names","sorted","isolated","edges","withoutCycles","onlyTheseAndChildren","nodesToInclude","getDescendants","getSubgraphEdges","toposort","message","startsWith","removeCycles","haveParents","childless","graph","Graph","connected","getStronglyConnectedComponents","scc","successors","vertex","sort","cyclicNodes","getDescendantsOfNode","descendants","ScopeEvaluator","_oldResult","scopeDiff","errorsDiff","_oldSymbols","_parser","_detectChanges","updatesOnly","_patchScope","_recalculateScope","_updateState","combinedErrors","newSymbols","oldSymbols","scopeEvaluator","charRegexp","isAssignmentRHS","MathInputContainer","ErrorContainer","MathInput","isPersistentError","_containerRef","getContainerRef","body","mq","prefix","validateSelf","onValidatedTextChange","_errorId","errorId","displayErrorDelay","Boolean","validators","validateAgainst","validate","onValidatorAndErrorChange","handleErrorPersistence","displayErrorNow","prevProps","getPopupContainer","title","trigger","placement","autoCommands","autoOperatorNames","trim","parseErrorData","getErrorMsg","errorsArray","getMathObjectProp","objectsArray","obj","getUsedNames","createCachedSelector","omittedId","calculateUsedNames","getValidateNameAgainst","usedNames","latexRHS","MathInputLHS","postProcessLaTeX","field","processedLaTeX","flex","nodeType","latexLHS","isValid","parseErrors","evalErrors","renderErrors","MathInputRHS","fullLatex","_ToggleSwitch","disabledField","inferDisabled","checked","Cell","Label","_UseComputedToggle","IndentedRow","MainRow","CameraUI","ToggleSwitch","checkedChildren","unCheckedChildren","UseComputedToggle","CameraGraphic","eventToPosition","clientX","clientY","LongPressable","isLongPressing","startingPosition","e","timerID","clearLongPressTimer","mousePosition","exceedDragThreshold","onShortPress","primaryMouseButtonOnly","pointerType","onLongPress","longPressTime","onPointerMove","onTouchStart","preventDefault","onTouchMove","onTouchEnd","clearTimeout","pointA","pointB","sqrt","pow","dragThreshold","onMouseUp","onMouseDown","onMouseMove","onMouseOut","ColorSquare","pickColor","onPickColor","Container","ColorPicker","Component","TabPane","Tabs","ColorPickerPopover","handleVisibleChange","onHideColorPicker","extraTabs","tab","content","getContent","onVisibleChange","Circle","gradient","InnerCircle","isFilled","StatusSymbol","displayColorPicker","showColorPicker","hideColorPicker","onToggleVisibility","MathScopeContext","createContext","MathScopeProvider","idsByName","allSymbolIds","symbolIds","prevIdsByName","Provider","MathScopeConsumer","Consumer","speedMultiplier","valueStyle","SliderValueDisplay","valueText","evalData","evaluated","evalError","parseError","handleEvalErrors","newErrors","existingErrors","EvaluatedSlider","incrementByFraction","ownEvalErrors","newState","fraction","onSliderChange","step","tipFormatter","timers","AnimationControlsContainer","AnimationButton","Button","speedDisplay","cursor","groupStyle","display","speedValues","speedDisplays","AnimationControls","startAnimation","stopAnimation","incrementSpeed","decrementSpeed","baseAnimationDuration","fps","delayMs","fractionalStepSize","_interval","setInterval","clearInterval","newIndex","newSpeed","shape","Group","canDecrement","fontSize","canIncrement","limitStyle","VariableSlider","renderSlider","previousValueIsManual","manualValue","setSliderValue","getLaTeX","_evaluatedSlider","numDigits","toFixed","toString","sliderValues","mathSymbol","getParseableSymbols","seen","evaluationResult","EvaluatedStatusSymbol","renderStatusSymbol","trueVisibility","StyledSettingsButton","SettingsButton","TitleBar","CloseButton","SettingsContainer","closePopover","switchStyle","SettingsContent","renderRow","renderInput","formRow","settingsList","Settings","LeftOfSettings","showOverflow","MathGraphicUI","settingsTitle","PointUI","PointGraphic","LineUI","LineGraphic","VectorUI","VectorGraphic","noFlex","AxisUI","ConnectedStaticMath","AxisGraphic","GridUI","GridGraphic","justifyRight","justifyContent","rangeStyle","ParemetricCurveUI","ParametricCurveGraphic","ScaleContainer","ColorBar","ColorScale","extendedColors","makeStripFuncPrefix","varname","prefixLength","full","texRHS","makeSurfaceComponent","meta","stripFuncPrefixIfPossibleU","stripFuncPrefixIfPossibleV","ParametricSurfaceStatus","ParametricSurfaceGraphic","ExplicitSurfaceGraphic","ExplicitSurfacePolarGraphic","ImplicitSurfaceUI","ImplicitSurfaceGraphic","VectorFieldUI","VectorFieldGraphic","makeExports","BooleanVariable","Variable","CollapseIndicatorButton","RotatingSpan","CollapsedIndicator","isCollapsed","onToggleContentCollapsed","Folder","listClassName","open","transitionTime","overflowWhenOpen","FolderContents","MathSymbols","MathGraphics","SpecificMathObject","DRAG_DISABLED","getItems","folderId","itemIds","getType","mathObjects","MathObjects","reOrder","list","sourceIndex","destinationIndex","splice","removed","update","extend","sourceDestIndexes","versionAtCreation","process","creationDate","JSON","stringify","Date","createReducer","mathObjectNames","action","settings","$merge","$unset","$toggle","$set","mathGraphicsRaw","idGenerator","_lastId","sortableTreeFixedPortion","metaData","mainFolder","sliders","demoState","isEmpty","simpleDiff","keep","dehydrateMathObjects","subStore","initialStore","isFolders","itemType","differsFromInitial","rehydrateMathObjects","dehydrated","withInitial","diffAgainst","dehydrateFolders","initialFolders","partial","fromEntries","entries","dehydrate","sortableTreeWithoutFixed","keepMeta","metadataInitial","rehydrate","rehydratedFolders","emptyFolders","rehydrateFolders","rehydratedSymbols","rehydratedGraphics","rehydrated","concat","maxId","folderIdasNumber","parseInt","asNumber","getMaxId","setNextId","loadDehydratedState","createErrorReducer","errorTypes","errorType","combinedReducer","combineReducers","drawers","tabs","destination","$reOrder","$splice","parentFolderId","positionInFolder","extraMerge","partialUpdate","lastSavedState","middleware","thunk","composedEnhancers","compose","applyMiddleware","store","createStore","enableBatching","oldState","cloneDeep","FolderComponent","SortableListOfFolders","onDragEnd","dropResult","NewObjectButton","GradientDiv","WarningSpan","ControllerHeader","handleMenuClick","next","targetFolder","newFolderIndex","newItemIndex","createMathObject","setContentCollapsed","renderMenuItem","Item","renderMenu","menuItems","overlay","FORBIDDEN_INSERT_FOLDERS","treeRoot","activeFolder","getActiveFolder","ScrollingDiv","ScrollingDivInner","PaddingCover","ScrollWithOverflow","eventNames","domElement","forwardEvent","stopPropagation","syntheticEvent","dispatchEvent","forwardEventToElement","coverRef","options","passive","eventName","_ControlledTabs","activeKey","setActiveTab","omit","StyledControlledTabs","ControlledTabs","ControlsDrawer","tabBarExtraContent","SortableTree","ScreenSizeDrawerManager","isSmall","setWidth","resize","withSizes","UserControls","MathBoxOuterDiv","leftOffset","MathBoxContainer","assignRef","mathboxElement","parentNode","removeChild","appendChild","getLeftAnimationStatus","getLeftOffset","MathBoxScene","handleRenderErrors","errMsg","oldErrors","Graphic","superObject","toEvaluate","renderGraphic","SceneBoundary","Math3dScene","ExamplesList","example","NavLink","to","featureDemos","neatExamples","Examples","_PopModal","_setVisible","setVisible","useModal","onCancel","maskClosable","maxWidth","popoverMaxWidth","footer","popoverPlacement","overlayStyle","getGraph","fetch","method","headers","then","res","json","saveGraph","urlKey","lookAt","SharePopoverContainer","CopyContainer","fadeIn","keyframes","CopyStatus","copyButtonStyle","margin","ShareButton","isCopied","saveCameraData","getCameraData","setCreationDate","getState","getId","dehydratedJson","onCopy","randomstring","generate","url","readOnly","PopModal","paddingRight","renderContent","mapDispatchToState","StyledInput","setTitle","ContactList","ul","HelpPopoverContainer","ContactIcon","Icon","Email","HelpButton","rel","href","_ExamplesButton","IconHolder","borderBottom","collapsed","mode","Menu","HeaderGroup","Header","HeaderButton","TitleInput","HeaderMenu","ExamplesButton","MainView","graphId","loadGraphFromDb","setLastSavedState","FlexContainer","overflow","flexDirection","groupEnd","getStore","clonedStore","App","match","location","Switch","Route","exact","path","render","legacyReRoute","renderGraph","hostname","ReactGA","initialize","testMode","pageview","pathname","search","exemptKeys","some","oldValue","newValue","deepEqual","hasMeaningfulChangeOccured","returnValue","querySelector","BrowserRouter","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.1a6b3319.chunk.js","sourcesContent":["// @flow\nimport Color from 'color'\n\nexport function lighten(colorStr: string, amount: number) {\n  const color = Color(colorStr)\n  const lightness = color.lightness()\n  const increaseBy = amount * (1 - lightness / 100)\n  return color.lighten(increaseBy).hex()\n}\n","import React, { PureComponent } from 'react'\nimport styled, { css } from 'styled-components'\nimport { lighten } from 'utils/colors'\nimport PropTypes from 'prop-types'\n\nconst buttonEffects = css`\n  &:focus {\n    outline: none;\n    color: ${props => props.focusColor || props.theme.primary[4]};\n  };\n  /* by default, button darkens on hover*/\n  &:hover {\n    background-color: rgba(0,0,0,0.10);\n    font-weight:900;\n    ${props => props.pressing && css`\n      background-color: rgba(0,0,0,0.20);\n      transition-duration: 0.1s;\n      transform: translateY(1px);\n      `};\n    };\n    /* if lightenOnHover, then lighten background on hover */\n    ${props => props.lightenOnHover && css`\n      background-color: ${props => props.backgroundColor};\n      &:hover {\n        background-color: ${props => lighten(props.backgroundColor, 0.75)};\n        ${props => props.pressing && css`\n          background-color: ${props => lighten(props.backgroundColor, 1)};\n          transition-duration: 0.1s;\n          `};\n        };\n        `}\n`\n\nconst SubtleButtonInner = styled.button`\n  border: none;\n  border-radius: ${props => props.theme.borderRadius};\n  transition-duration: ${props => props.theme.transitionDuration};\n  transition-timing-function: ${props => props.theme.transitionTimingFunction};\n  transition-property: all;\n  background-color: ${props => props.backgroundColor}\n  ${props => !props.disabled && buttonEffects}\n  ${props => props.disabled && css`\n    opacity: 0.5;\n    cursor: not-allowed;\n  `}\n`\n\n/**\n  * A 'subtle' button component.\n  * - no border\n  * - transparent by default, increased opacity on lightenOnHover\n  * - if lightenOnHover=true AND backgroundColor supplied, then backgroundColor\n  *   is lightened on hover instead.\n */\n\nexport default class SubtleButton extends PureComponent {\n\n  static propTypes = {\n    disabled: PropTypes.bool.isRequired,\n    lightenOnHover: PropTypes.bool.isRequired,\n    backgroundColor: PropTypes.string,\n    focusColor: PropTypes.string\n  }\n\n  static defaultProps = {\n    lightenOnHover: false,\n    disabled: false,\n    backgroundColor: 'transparent'\n  }\n\n  state = {\n    pressing: false\n  }\n\n  getRef = ref => {\n    this.button = ref\n  }\n\n  endPress = () => {\n    this.setState( { pressing: false } )\n  }\n\n  beginPress = () => {\n    // button focus triggers unreliably, so force it\n    this.button.focus()\n    this.setState( { pressing: true } )\n  }\n\n  render() {\n    const {\n      lightenOnHover,\n      backgroundColor,\n      focusColor,\n      ...otherProps } = this.props\n\n    if (lightenOnHover && !backgroundColor) {\n      throw Error('lightenOnHover requires backgroundColor to be specified.')\n    }\n\n    return (\n      // The only purpose of outer div is to capture press events\n      <SubtleButtonInner\n        onPointerDown={this.beginPress}\n        onPointerUp={this.endPress}\n        onPointerLeave={this.endPress}\n        lightenOnHover={lightenOnHover}\n        backgroundColor={backgroundColor}\n        focusColor={focusColor}\n        ref={this.getRef}\n        pressing={this.state.pressing}\n        disabled={this.props.disabled}\n        {...otherProps}\n      />\n    )\n  }\n\n}\n","import React, { PureComponent } from 'react'\nimport PropTypes from 'prop-types'\nimport styled, { css } from 'styled-components'\nimport { Icon } from 'antd'\nimport SubtleButton from 'components/SubtleButton'\n\nconst StyledButton = styled(SubtleButton)`\n  z-index:200;\n  width:30px;\n  height:30px;\n  ${props => props.side === 'right' && css`\n    margin-right: -30px;\n  `};\n  ${props => props.side === 'left' && css`\n    margin-left: -30px;\n    padding-left: 30px;\n    & > i {\n      margin-left: -30px;\n    }\n  `};\n}\n`\n\n// slideTo, isDrawerOpen\nconst buttonIcons = {\n  left: {\n    true: 'left',\n    false: 'right'\n  },\n  right: {\n    true: 'right',\n    false: 'left'\n  }\n}\n\nexport default class DrawerToggleButton extends PureComponent {\n\n  static propTypes = {\n    onClose: PropTypes.func.isRequired,\n    onOpen: PropTypes.func.isRequired,\n    isDrawerOpen: PropTypes.bool.isRequired,\n    slideTo: PropTypes.oneOf( ['left', 'right'] ),\n    side: PropTypes.oneOf( ['left', 'right'] )\n  }\n\n  render() {\n    const props = this.props\n    const onClick = props.isDrawerOpen ? props.onClose : props.onOpen\n    const iconType = buttonIcons[props.slideTo][props.isDrawerOpen]\n    return (\n      <StyledButton onClick={onClick} side={props.side}>\n        <Icon type={iconType} />\n      </StyledButton>\n    )\n  }\n\n}\n","import React, { Fragment } from 'react'\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\nimport DrawerToggleButton from './DrawerToggleButton'\nimport classNames from 'classnames'\n\n// These css classes control the opening/closing animation.\n// Animation is done using CSS transitions & transforms.\n// Transforms interfere with react-beautiful-dnd in Drawer children, so the\n// default open class is implemented without any transforms\nconst DrawerContainer = styled.div`\n  z-index:10;\n  width: ${props => props.width};\n  position: relative;\n  background-color: ${props => props.theme.gray[1]};\n  height:100%;\n  &.closing-or-closed.left {\n    transform: ${props => `translateX(-${props.width})`};\n    transition-duration: ${props => props.animationSpeed};\n    margin-right: ${props => `-${props.width}`};\n  }\n  &.opening.left {\n    transform: translateX(0px);\n    transition-duration: ${props => props.animationSpeed};\n    margin-right: 0;\n  }\n  &.closing-or-closed.right {\n    transform: ${props => `translateX(${props.width})`};\n    transition-duration: ${props => props.animationSpeed};\n    margin-left: ${props => `-${props.width}`};\n  }\n  &.opening.right {\n    transform: translateX(0px);\n    transition-duration: ${props => props.animationSpeed};\n    margin-right: 0;\n  }\n`\n\n/**\n * A sliding drawer component. Can be made to slide left or right off of These\n * viewport.\n *\n * Notes:\n *  - for rightward sliding drawer gto function correctly, Drawer's parent\n *    container must have overflow:hidden\n *  - css transforms are used to animate the sliding. However, no transforms\n *    are applied in drawer's open state.\n *\n */\nexport default class Drawer extends React.PureComponent {\n\n  static propTypes = {\n    id: PropTypes.string.isRequired,\n    width: PropTypes.string.isRequired,\n    isOpen: PropTypes.bool.isRequired,\n    isAnimating: PropTypes.bool.isRequired,\n    animationSpeed: PropTypes.string,\n    onOpen: PropTypes.func.isRequired,\n    onClose: PropTypes.func.isRequired,\n    slideTo: PropTypes.oneOf( ['left', 'right'] ).isRequired,\n    children: PropTypes.oneOfType( [\n      PropTypes.arrayOf(PropTypes.node),\n      PropTypes.node\n    ] ).isRequired\n  }\n\n  static defaultProps = {\n    slideTo: 'left',\n    animationSpeed: '1000ms'\n  }\n\n  constructor(props) {\n    super(props)\n    this.onClose = this.props.onClose.bind(this, this.props.id, this.props.animationSpeed)\n    this.onOpen = this.props.onOpen.bind(this, this.props.id, this.props.animationSpeed)\n  }\n\n  render() {\n    const {\n      animationSpeed,\n      width,\n      children,\n      isOpen,\n      isAnimating,\n      slideTo\n    } = this.props\n\n    const className = classNames( {\n      opening: isOpen && isAnimating,\n      'closing-or-closed': !isOpen,\n      left: slideTo === 'left',\n      right: slideTo === 'right'\n    } )\n\n    const buttonSide = slideTo === 'left' ? 'right' : 'left'\n\n    return (\n      <Fragment>\n        {\n          buttonSide === 'left' && isOpen && (\n            <DrawerToggleButton\n              isDrawerOpen={isOpen}\n              onOpen={this.onOpen}\n              onClose={this.onClose}\n              side={buttonSide}\n              slideTo={slideTo}\n            />\n          )\n        }\n        <DrawerContainer\n          width={width}\n          className={className}\n          animationSpeed={animationSpeed}\n        >\n          {children}\n        </DrawerContainer>\n        {\n          buttonSide === 'right' && (\n            <DrawerToggleButton\n              isDrawerOpen={isOpen}\n              onOpen={this.onOpen}\n              onClose={this.onClose}\n              side={buttonSide}\n              slideTo={slideTo}\n            />\n          )\n        }\n      </Fragment>\n    )\n  }\n\n}\n","import cssTime from 'css-time'\nimport Drawer from './components/Drawer'\n\nconst DEFAULT_ANIMATION_SPEED = Drawer.defaultProps.animationSpeed\n\nexport const SET_VISIBILITY = 'SET_VISIBILITY'\nexport const SET_ANIMATION_STATUS = 'SET_ANIMATION_STATUS'\nexport const OPEN_DRAWER = 'OPEN_DRAWER'\nexport const CLOSE_DRAWER = 'CLOSE_DRAWER'\nexport const SET_WIDTH = 'SET_WIDTH'\n\nexport const setVisibility = (id, isVisible) => ( {\n  type: SET_VISIBILITY,\n  payload: { id, isVisible }\n} )\n\nexport const setWidth = (id, width) => ( {\n  type: SET_WIDTH,\n  payload: { id, width }\n} )\n\nexport const setAnimationStatus = (id, isAnimating) => ( {\n  type: SET_ANIMATION_STATUS,\n  payload: { id, isAnimating }\n} )\n\nexport const closeDrawer = (id, animationSpeed = DEFAULT_ANIMATION_SPEED) => {\n  const msDuration = cssTime.from(animationSpeed)\n  return dispatch => {\n    dispatch(setVisibility(id, false))\n    dispatch(setAnimationStatus(id, true))\n    setTimeout(() => dispatch(setAnimationStatus(id, false)), msDuration)\n  }\n}\n\nexport const openDrawer = (id, animationSpeed = DEFAULT_ANIMATION_SPEED) => {\n  const msDuration = cssTime.from(animationSpeed)\n  return dispatch => {\n    dispatch(setVisibility(id, true))\n    dispatch(setAnimationStatus(id, true))\n    setTimeout(() => dispatch(setAnimationStatus(id, false)), msDuration)\n  }\n}\n","import { SET_VISIBILITY, SET_ANIMATION_STATUS, SET_WIDTH } from './actions'\n\nexport const DEFAULT_WIDTH = '400px'\n\nexport const initialState = {\n  main: {\n    isVisible: true,\n    isAnimating: false,\n    width: DEFAULT_WIDTH\n  },\n  examples: {\n    isVisible: false,\n    isAnimating: false,\n    width: DEFAULT_WIDTH\n  }\n}\n\nexport default (state = initialState, { type, payload } ) => {\n  switch (type) {\n\n    case SET_VISIBILITY:\n      return {\n        ...state,\n        [payload.id]: { ...state[payload.id], isVisible: payload.isVisible }\n      }\n    case SET_ANIMATION_STATUS:\n      return {\n        ...state,\n        [payload.id]: { ...state[payload.id], isAnimating: payload.isAnimating }\n      }\n    case SET_WIDTH: {\n      const { id, width } = payload\n      return {\n        ...state,\n        [id]: { ...state[id], width }\n      }\n    }\n    default:\n      return state\n\n  }\n}\n","// @flow\n\nexport const PARSE_ERROR = 'PARSE_ERROR'\nexport const EVAL_ERROR = 'EVAL_ERROR'\nexport const RENDER_ERROR = 'RENDER_ERROR'\n\nexport class ErrorData {\n\n  type: string\n  errorMsg: ?string\n  isError: boolean\n\n  constructor(type: string, errorMsg: ?string) {\n    this.type = type\n    this.isError = errorMsg !== null && errorMsg !== undefined\n    if (this.isError) {\n      // do not set errorMsg at all if it's void.\n      this.errorMsg = errorMsg\n    }\n  }\n\n}\n\nexport class ParseErrorData extends ErrorData {\n\n  constructor(errorMsg: ?string) {\n    super(PARSE_ERROR, errorMsg)\n  }\n\n}\n\nexport class EvalErrorData extends ErrorData {\n\n  constructor(errorMsg: ?string) {\n    super(EVAL_ERROR, errorMsg)\n  }\n\n}\n\nexport class RenderErrorData extends ErrorData {\n\n  constructor(errorMsg: ?string) {\n    super(RENDER_ERROR, errorMsg)\n  }\n\n}\n","// @flow\nimport { ErrorData } from './ErrorData'\n\nexport const SET_ERROR = 'SET_ERROR'\nexport const UNSET_ERROR = 'UNSET_ERROR'\n\nexport function setError(id: string, property: string, errorData: ErrorData) {\n  return errorData.isError\n    ? {\n      type: SET_ERROR,\n      payload: { id, property, errorData }\n    }\n    : {\n      type: UNSET_ERROR,\n      payload: { id, property, errorData }\n    }\n}\n","// @flow\nimport { batchActions } from 'redux-batched-actions'\nimport { setError } from 'services/errors'\nimport type { ErrorData } from 'services/errors/ErrorData'\n\nexport const TOGGLE_PROPERTY = 'TOGGLE_PROPERTY'\nexport const SET_PROPERTY = 'SET_PROPERTY'\nexport const UNSET_PROPERTY = 'UNSET_PROPERTY'\nexport const SET_PROPERTY_AND_ERROR = 'SET_PROPERTY_AND_ERROR'\nexport const SET_ERROR = 'SET_ERROR'\nexport const CREATE_MATH_OBJECT = 'CREATE_MATH_OBJECT'\nexport const DELETE_MATH_OBJECT = 'DELETE_MATH_OBJECT'\n\nexport function toggleProperty(id: string, name: string, property: string) {\n  return {\n    type: TOGGLE_PROPERTY,\n    name,\n    payload: { id, property }\n  }\n}\n\nexport function setProperty(id: string, name: string, property: string, value: any) {\n  return {\n    type: SET_PROPERTY,\n    name,\n    payload: { id, property, value }\n  }\n}\n\nexport function setPropertyAndError(id: string, name: string, property: string, value: any, error: ErrorData) {\n  return batchActions( [\n    setProperty(id, name, property, value),\n    setError(id, property, error)\n  ], 'SET_PROPERTY_AND_ERROR')\n}\n\nexport function createMathObject(\n  id: string,\n  name: string,\n  parentFolderId: string,\n  positionInFolder: number,\n  settings: ?Object = {}\n) {\n  return {\n    type: CREATE_MATH_OBJECT,\n    name,\n    payload: { parentFolderId, positionInFolder, id, settings }\n  }\n}\n\nexport function deleteMathObject(id: string, name: string, parentId: string, positionInParent: number) {\n  return {\n    type: DELETE_MATH_OBJECT,\n    name,\n    payload: { parentId, id, positionInParent }\n  }\n}\n","import { SET_ACTIVE_TAB } from './actions'\nimport { CREATE_MATH_OBJECT } from 'containers/MathObjects/actions'\nconst initialState = {\n  controls: {\n    activeTab: '1'\n  },\n  examples: {\n    activeTab: '1'\n  }\n}\n\nexport default function tabs(state = initialState, action) {\n  const { type, payload } = action\n\n  switch (type) {\n\n    case SET_ACTIVE_TAB: {\n      const { id, activeTab } = payload\n      return {\n        ...state,\n        [id]: { activeTab }\n      }\n    }\n    case CREATE_MATH_OBJECT: {\n\n      return state.controls.activeTab === '1'\n        ? state\n        : { ...state, controls: { activeTab: '1' } }\n    }\n    default: {\n      return state\n    }\n\n  }\n\n}\n","// @flow\n\nexport type Settings = { [property: string]: any, description: string }\n\n/**\n * @module MathObject\n * Defines wrapper objects that contains react component and metadata\n *\n * Three types of MathObjects:\n * - Folder: wrapper defiend here\n * - Symbol: wrapped defined here\n * - Graphic: wrapped defined in ./MathGraphics\n */\n\nexport type Support = 'full' | 'experimental' | 'deprecationWarning'\n\ntype Config = {\n  type: string,\n  defaultSettings: Settings,\n  uiComponent: Function,\n  support?: Support\n}\n\nexport interface MathObjectWrapper {\n  type: string,\n  defaultSettings: Settings,\n  uiComponent: Function,\n  reducer: string,\n  support: Support\n}\n\nexport class MathFolder implements MathObjectWrapper {\n\n  type: string\n  defaultSettings: Settings\n  uiComponent: Function\n  reducer = 'folders'\n  support: Support\n\n  constructor(config: Config) {\n    if (!config.support) {\n      config.support = 'full'\n    }\n    Object.assign(this, config)\n  }\n\n}\n\nexport class MathSymbol implements MathObjectWrapper {\n\n  type: string\n  defaultSettings: Settings\n  uiComponent: Function\n  reducer = 'mathSymbols'\n  support: Support\n\n  constructor(config: Config) {\n    if (!config.support) {\n      config.support = 'full'\n    }\n    Object.assign(this, config)\n  }\n\n}\n","import React from 'react'\nimport { Draggable } from 'react-beautiful-dnd'\n\n/**\n * PartlyDraggable\n *\n * Temporarily sets isDragDisabled=true when PointerDown event encounters\n * an HTML element that custom isElementDraggable detects as undraggable.\n * isElementDraggable could be customized for other use-cases.\n */\nexport default class PartlyDraggable extends React.PureComponent {\n\n  state = {\n    targetUndraggable: false\n  }\n\n  constructor(props) {\n    super(props)\n    this.rootRef = React.createRef()\n    this.onPointerDown = this.onPointerDown.bind(this)\n    this.onPointerUp = this.onPointerUp.bind(this)\n  }\n\n  static isElementDraggable(element) {\n    // Detects MathQuill editable fields\n    if (element.classList.contains('mq-editable-field')) {\n      return false\n    }\n    // Detects MathQuill editable fields\n    if (element.classList.contains('math3d-longpressable')) {\n      return false\n    }\n    // Detects Ant Design Slider elements\n    if (element.classList.contains('ant-slider')) {\n      return false\n    }\n    return true\n  }\n\n  static isDragAllowed(top, current) {\n    if (top === current) {\n      return true\n    }\n    if (!PartlyDraggable.isElementDraggable(current)) {\n      return false\n    }\n    if (current.parentElement === null) {\n      // happens if current is the root DOM node.\n      return true\n    }\n    return PartlyDraggable.isDragAllowed(top, current.parentElement)\n  }\n\n  onPointerDown = (event) => {\n    const { target } = event\n    const rootEle = this.rootRef.current\n    if (!PartlyDraggable.isDragAllowed(rootEle, target)) {\n      this.setState( { targetUndraggable: true } )\n    }\n  }\n\n  onPointerUp = () => {\n    this.setState( { targetUndraggable: false } )\n  }\n\n  render() {\n    const { id, isDragDisabled, children, ...otherProps } = this.props\n    const { targetUndraggable } = this.state\n    return (\n      <div\n        onPointerDown={this.onPointerDown}\n        onPointerUp={this.onPointerUp}\n        ref={this.rootRef}\n      >\n        <Draggable\n          key={id}\n          isDragDisabled={targetUndraggable || isDragDisabled}\n          {...otherProps}\n        >\n          {this.props.children}\n        </Draggable>\n      </div>\n    )\n  }\n\n}\n","import React, { Fragment } from 'react'\nimport { Droppable } from 'react-beautiful-dnd'\nimport PartlyDraggable from './PartlyDraggable'\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\n\nconst DraggableItemContainer = styled.div`\n  box-shadow: ${props => props.isDragging ? '0 0 5px gray' : ''}\n`\n\n/**\n * SortableList, React Component\n *\n * A list component with draggable items, constructed with react-beautiful-dnd.\n * Must be placed inside a DragDropContext.\n *\n */\n\nSortableList.propTypes = {\n  // array of items to be rendered inisde <Draggable>s\n  items: PropTypes.arrayOf(\n    PropTypes.shape( {\n      id: PropTypes.string.isRequired,\n      isDraggable: PropTypes.bool\n    } )\n  ).isRequired,\n  // function to render each item\n  renderItem: PropTypes.func.isRequired,\n  // Type identifier for droppable and its contained draggables.\n  // Draggables can only be dragged to Droppables with same type.\n  droppableType: PropTypes.string.isRequired,\n  draggableType: PropTypes.string.isRequired,\n  // Identifier for the droppable\n  droppableId: PropTypes.string.isRequired,\n  isDropDisabled: PropTypes.bool,\n  // css applied to Droppable's outermost div\n  style: PropTypes.object,\n  className: PropTypes.string\n}\n\nexport default function SortableList(props) {\n  const { droppableType, draggableType, className, style, renderItem } = props\n  return (\n    <Droppable\n      droppableId={props.droppableId}\n      isDropDisabled={props.isDropDisabled}\n      type={droppableType}\n    >\n      {\n        // eslint-disable-next-line no-unused-vars\n        (provided, snapshot) => (\n          <div\n            ref={provided.innerRef}\n            className={className}\n            style={style}\n          >\n            {props.items.map((item, index) => (\n              renderDraggableItem(\n                item,\n                renderItem,\n                { index, type: draggableType }\n              )\n            ))}\n            {provided.placeholder}\n          </div>\n        )\n      }\n    </Droppable>\n  )\n}\n\nfunction renderDraggableItem(item, renderItem, draggableProps) {\n  return (\n    <PartlyDraggable\n      key={item.id}\n      draggableId={item.id}\n      isDragDisabled={item.isDragDisabled}\n      {...draggableProps}\n    >\n      {(provided, snapshot) => (\n        <Fragment>\n          <div\n            ref={provided.innerRef}\n            {...provided.draggableProps}\n            {...provided.dragHandleProps}\n          >\n            <DraggableItemContainer isDragging={snapshot.isDragging}>\n              {renderItem(item)}\n            </DraggableItemContainer>\n          </div>\n          {provided.placeholder}\n        </Fragment>\n      )}\n    </PartlyDraggable>\n  )\n}\n","// @flow\n/**\n * Creates a Promise that is resolved after delay.\n * Good for using with async/await\n *\n * @param  {number} delay in milliseconds\n */\nexport function timeout(delay: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, delay))\n}\n","// @flow\nimport { timeout } from 'utils/functions'\n\ntype LoopAPI = {\n  running: boolean,\n  start: () => void,\n  stop: () => void\n}\ntype ThreeStrap = {\n  Loop: LoopAPI,\n  canvas: HTMLCanvasElement\n}\n\nexport default class LoopManager {\n\n  /**\n   * For managing the animation loop. Let's us enter/exit a 'slow mode' which\n   * is useful when to reduce CPU consumption when no updates are expected.\n   *\n   * Note: we use 'slow mode' rather than turning the loop off entirely because\n   * I don't know how to detect exactly when the scene has finished rendering\n   */\n\n  enterSlowMode: () => void\n  exitSlowMode: () => void\n  isInSlowMode = false\n  isPointerDown = false\n  isScrolling = false\n  Loop: LoopAPI\n  slowOnTime: number\n  slowOffTime: number\n  canvas: HTMLCanvasElement\n  static scrollTime = 3000\n\n  constructor(threestrap: ThreeStrap, slowOnTime: number = 10, slowOffTime: number = 500) {\n    this.Loop = threestrap.Loop\n    this.canvas = threestrap.canvas\n    this.slowOffTime = slowOffTime\n    this.slowOnTime = slowOnTime\n\n    this.canvas.addEventListener('mousedown', this.downHandler)\n    this.canvas.addEventListener('touchstart', this.downHandler)\n    this.canvas.addEventListener('mouseup', this.mouseUpHandler)\n    this.canvas.addEventListener('touchend', this.touchExitHandler)\n    this.canvas.addEventListener('mousewheel', this.wheelHandler)\n    this.canvas.addEventListener('wheel', this.wheelHandler)\n  }\n\n  unbindEventListeners = () => {\n    this.canvas.removeEventListener('mousedown', this.downHandler)\n    this.canvas.removeEventListener('touchstart', this.downHandler)\n    this.canvas.removeEventListener('mouseup', this.enterSlowMode)\n    this.canvas.removeEventListener('touchend', this.touchExitHandler)\n    this.canvas.removeEventListener('mousewheel', this.wheelHandler)\n    this.canvas.removeEventListener('wheel', this.wheelHandler)\n  }\n\n  slowModeCycle = async () => {\n    this.Loop.start()\n    await timeout(this.slowOnTime)\n    if (this.isInSlowMode) { this.Loop.stop() }\n    await timeout(this.slowOffTime)\n    if (this.isInSlowMode) { this.slowModeCycle() }\n  }\n\n  downHandler = () => {\n    this.isPointerDown = true\n    this.exitSlowMode()\n  }\n\n  mouseUpHandler = () => {\n    this.isPointerDown = false\n    this.enterSlowMode()\n  }\n\n  touchExitHandler = async (event: TouchEvent) => {\n    if (event.touches.length > 0) { return }\n    this.isPointerDown = false\n    await timeout(LoopManager.scrollTime)\n    this.enterSlowMode()\n  }\n\n  wheelHandler = async () => {\n    this.exitSlowMode()\n    this.isScrolling = true\n    await timeout(LoopManager.scrollTime)\n    this.enterSlowMode()\n    this.isScrolling = false\n  }\n\n  enterSlowMode = () => {\n    if (this.isInSlowMode || this.isPointerDown || this.isScrolling) { return }\n    this.isInSlowMode = true\n    this.slowModeCycle()\n  }\n\n  exitSlowMode = () => {\n    this.isInSlowMode = false\n    this.Loop.start()\n  }\n\n}\n","// @flow\nimport * as React from 'react'\nimport { timeout } from 'utils/functions'\nimport LoopManager from 'services/LoopManager'\n\ntype Props = {\n  mathbox: any,\n  children: React.Node\n}\n\nexport class MathBox extends React.PureComponent<Props> {\n\n  mathboxNode = this.props.mathbox\n  loopManager: LoopManager\n  updateSymbol = Symbol('update marker')\n\n  componentDidMount() {\n    this.loopManager = new LoopManager(this.mathboxNode.three)\n  }\n\n  componentWillUnmount() {\n    this.loopManager.unbindEventListeners()\n  }\n\n  // handles entering/exiting slow mode\n  async componentDidUpdate() {\n    const updateSymbol = Symbol('update marker')\n    this.updateSymbol = updateSymbol\n    this.loopManager.exitSlowMode()\n\n    await timeout(100)\n    if (this.updateSymbol === updateSymbol) {\n      this.loopManager.enterSlowMode()\n    }\n\n  }\n\n  render() {\n    if (!this.props.children) {\n      return null\n    }\n    return React.Children.map(\n      this.props.children,\n      child => React.cloneElement(child, {\n        mathboxParent: this.mathboxNode,\n        mathbox: this.mathboxNode\n      } )\n    )\n  }\n\n}\n","// @flow\nimport type { Math } from './types'\nimport core from 'mathjs/core'\nconst math: Math = core.create()\n\nmath.import(require('mathjs/lib/type/matrix'))\nmath.import(require('mathjs/lib/type/complex'))\nmath.import(require('mathjs/lib/constants'))\nmath.import(require('mathjs/lib/function/arithmetic'))\nmath.import(require('mathjs/lib/function/trigonometry'))\nmath.import(require('mathjs/lib/function/matrix'))\nmath.import(require('mathjs/lib/function/statistics'))\n\nmath.import(require('mathjs/lib/expression'))\n\nexport default math\n","// @flow\nimport type { Numeric } from './types'\nimport math from './custom'\n\ntype NumericFunction = (...args: Array<Numeric>) => Numeric\n\nconst EPS = 0.0008\nconst EPS2 = EPS/2\n\n// TODO: diff currently accepts two call signatures:\n//  1. diff(f), returns a function\n//  2. diff(f, x, y...), returns a numeric value\n//  The first signature was used in a very old version of math3d, but is never\n//  used now internally or in examples. Also, it causes a bunch of flow problems\n//  so let's remove it.\nexport const diff = (f: NumericFunction, ...values: [] | Array<Numeric>) => {\n\n  const derivative = (...args: Array<Numeric>): Numeric => {\n    const derivComponents = args.map((arg, j) => {\n      args[j] = math.add(arg, -EPS2)\n      const initialValue = f(...args)\n      args[j] = math.add(arg, +EPS2)\n      const finalValue = f(...args)\n      args[j] = arg\n      return math.divide(math.subtract(finalValue, initialValue), EPS)\n    } )\n    return derivComponents.length === 1\n      ? derivComponents[0]\n      : derivComponents\n  }\n  Object.defineProperty(derivative, 'length', { value: f.length } )\n\n  // $FlowFixMe\n  return values.length === 0\n    ? derivative\n    : derivative(...values)\n}\n\ntype Func1to3 = (t: number) => [number, number, number]\n\nexport const unitT = (f: Func1to3, t: number) => {\n  // $FlowFixMe ... need to make add/subtract polymorhpic & length-preserving\n  const tangent = math.subtract(f(t + EPS2), f(t - EPS2))\n  return math.divide(tangent, math.norm(tangent))\n}\nexport const unitN = (f: Func1to3, t: number) => {\n  const normal = math.subtract(unitT(f, t + EPS2), unitT(f, t - EPS2))\n  return math.divide(normal, math.norm(normal))\n}\nexport const unitB = (f: Func1to3, t: number) => {\n  return math.cross(unitT(f, t), unitN(f, t))\n}\n\nexport const curl = (f: NumericFunction, x: number, y: number, z: number) => {\n  const [dxf, dyf, dzf] = diff(f, x, y, z)\n  // $FlowFixMe flow has trouble recognizing that diff() returned a 3 x 3 matrix\n  return [ dyf[2] - dzf[1], dzf[0] - dxf[2], dxf[1] - dyf[0] ]\n}\n\nexport const div = (f: NumericFunction, ...values: Array<number>) => {\n  // $FlowFixMe\n  const fullDeriv: Numeric = diff(f, ...values)\n  return math.trace(fullDeriv)\n}\n\nexport const pdiff = (f: NumericFunction, ...args: Array<Numeric>) => {\n  // The last element of args should be the argument number we're differentiating\n  // with respect to. For example, pdiff(f, x, y, 1)\n\n  // $FlowFixMe The last element of args should be a number\n  const diffNumber = args.pop() - 1\n  const original = args[diffNumber]\n  args[diffNumber] = math.add(original, EPS2)\n  const finalValue = f(...args)\n  args[diffNumber] = math.add(original, -EPS2)\n  const initialValue = f(...args)\n  return math.divide(math.subtract(finalValue, initialValue), EPS)\n}\n","// @flow\nimport customMath from './custom'\nimport { diff, pdiff, unitT, unitN, unitB, curl, div } from './derivatives'\n\nfunction arctan(arg0: number, arg1?: number) {\n  return arg1 === undefined ? customMath.atan(arg0) : customMath.atan2(arg0, arg1)\n}\n\nconst imaginaryUnit = customMath.i\ncustomMath.import( {\n  diff,\n  pdiff,\n  unitT,\n  unitN,\n  unitB,\n  div,\n  curl,\n  i: [1, 0, 0],\n  j: [0, 1, 0],\n  k: [0, 0, 1],\n  I: imaginaryUnit,\n  arcsin: customMath.asin,\n  arccos: customMath.acos,\n  arctan: arctan,\n  arcsinh: customMath.asinh,\n  arccosh: customMath.acosh,\n  arctanh: customMath.atanh\n}, { override: true } )\n\nexport default customMath\n\nwindow.math = customMath\n","// @flow\nimport math from 'utils/mathjs'\n\n// TODO test this? Maybe Flow is good enough\n\nexport function validateBoolean(value: mixed) {\n  const valueType = typeof value\n  if (valueType !== 'boolean') {\n    throw new TypeError('value must be boolean')\n  }\n}\n\nexport function isEqualNumerically(obj1: mixed, obj2: mixed): bool {\n  if (obj1 === obj2) { return true }\n  if (!(obj1 instanceof Array && obj2 instanceof Array)) { return false }\n  if (obj1.length !== obj2.length) { return false }\n\n  // Both objects are arrays of the same length\n  return (obj1: any).every((element, index) => {\n    return isEqualNumerically(element, (obj2: any)[index] )\n  } )\n\n}\n\nexport function isReal(value: mixed) {\n  return typeof value === 'number'\n}\n\nexport function validateReal(value: mixed) {\n  if (isReal(value)) { return }\n  throw TypeError(`Expected value to be a real number, but it was an ${typeof value}`)\n}\n\nexport function isComplex(value: mixed) {\n  if (isReal(value)) return true\n  return value instanceof math.type.Complex\n}\n\nexport function isVector(value: mixed, numComponents: number, { real = true }: { real: boolean } = {}) {\n  if (value instanceof Array) {\n    if (value.length !== numComponents) { return false }\n    return real ? value.every(x => isReal(x)) : value.every(x => isComplex(x))\n  }\n  return false\n}\n\nexport function validateVector(value: mixed, numComponents: number, { real = true }: { real: boolean } = {}) {\n  if (isVector(value, numComponents, { real })) { return }\n  const type = real ? 'real ' : ''\n  throw TypeError(`Expected value to be a ${numComponents}-component ${type}vector, but it is not.`)\n}\n\n// Validate that func is a function from C^numInputs to C^numpOutputs\nexport function validateFunctionSignature(func: mixed, numInputs: number, numOutputs: number,) {\n  if (!(typeof func === 'function')) {\n    throw TypeError(`Expected a function, but received a ${typeof func}`)\n  }\n\n  if (func.length !== numInputs) {\n    throw TypeError(`Expected function to have ${String(numInputs)} inputs`)\n  }\n  const theArgs = [...Array(numInputs)].map(() => Math.random())\n\n  const result = func(...theArgs) // if func throws, well... then that's the error!\n\n  if (numOutputs === 1) {\n    if (isComplex(result)) {\n      return\n    }\n    throw TypeError('Expected function to return a number, but it did not.')\n  }\n  if (numOutputs > 1) {\n    if (isVector(result, numOutputs, { real: false })) {\n      return\n    }\n    throw TypeError(`Expected function to return a vector of length ${numOutputs}, but it did not.`)\n  }\n}\n\nexport function hasFunctionSignature(func: mixed, numInputs: number, numOutputs: number) {\n  try {\n    validateFunctionSignature(func, numInputs, numOutputs)\n    return true\n  }\n  catch (err) {\n    return false\n  }\n}\n","// @flow\nimport diff from 'shallow-diff'\n// TODO Use this version everywhere, or fork original shallow-diff and make the\n// change there.\nexport default function diffWithSets(base: Object, compared: Object) {\n  const difference = diff(base, compared)\n  return Object.keys(difference).reduce((acc, key) => {\n    acc[key] = new Set<string>(difference[key] )\n    return acc\n  }, {} )\n}\n","// This Lookup Table is taken from Paul Bourke's page: http://paulbourke.net/geometry/polygonise/\n// but it is originally created by Cory Gene Bloyd.\n\nexport const triangleTable = [\n  [],\n  [[0, 8, 3]],\n  [[0, 1, 9]],\n  [[1, 8, 3], [9, 8, 1]],\n  [[1, 2, 10]],\n  [[0, 8, 3], [1, 2, 10]],\n  [[9, 2, 10], [0, 2, 9]],\n  [[2, 8, 3], [2, 10, 8], [10, 9, 8]],\n  [[3, 11, 2]],\n  [[0, 11, 2], [8, 11, 0]],\n  [[1, 9, 0], [2, 3, 11]],\n  [[1, 11, 2], [1, 9, 11], [9, 8, 11]],\n  [[3, 10, 1], [11, 10, 3]],\n  [[0, 10, 1], [0, 8, 10], [8, 11, 10]],\n  [[3, 9, 0], [3, 11, 9], [11, 10, 9]],\n  [[9, 8, 10], [10, 8, 11]],\n  [[4, 7, 8]],\n  [[4, 3, 0], [7, 3, 4]],\n  [[0, 1, 9], [8, 4, 7]],\n  [[4, 1, 9], [4, 7, 1], [7, 3, 1]],\n  [[1, 2, 10], [8, 4, 7]],\n  [[3, 4, 7], [3, 0, 4], [1, 2, 10]],\n  [[9, 2, 10], [9, 0, 2], [8, 4, 7]],\n  [[2, 10, 9], [2, 9, 7], [2, 7, 3], [7, 9, 4]],\n  [[8, 4, 7], [3, 11, 2]],\n  [[11, 4, 7], [11, 2, 4], [2, 0, 4]],\n  [[9, 0, 1], [8, 4, 7], [2, 3, 11]],\n  [[4, 7, 11], [9, 4, 11], [9, 11, 2], [9, 2, 1]],\n  [[3, 10, 1], [3, 11, 10], [7, 8, 4]],\n  [[1, 11, 10], [1, 4, 11], [1, 0, 4], [7, 11, 4]],\n  [[4, 7, 8], [9, 0, 11], [9, 11, 10], [11, 0, 3]],\n  [[4, 7, 11], [4, 11, 9], [9, 11, 10]],\n  [[9, 5, 4]],\n  [[9, 5, 4], [0, 8, 3]],\n  [[0, 5, 4], [1, 5, 0]],\n  [[8, 5, 4], [8, 3, 5], [3, 1, 5]],\n  [[1, 2, 10], [9, 5, 4]],\n  [[3, 0, 8], [1, 2, 10], [4, 9, 5]],\n  [[5, 2, 10], [5, 4, 2], [4, 0, 2]],\n  [[2, 10, 5], [3, 2, 5], [3, 5, 4], [3, 4, 8]],\n  [[9, 5, 4], [2, 3, 11]],\n  [[0, 11, 2], [0, 8, 11], [4, 9, 5]],\n  [[0, 5, 4], [0, 1, 5], [2, 3, 11]],\n  [[2, 1, 5], [2, 5, 8], [2, 8, 11], [4, 8, 5]],\n  [[10, 3, 11], [10, 1, 3], [9, 5, 4]],\n  [[4, 9, 5], [0, 8, 1], [8, 10, 1], [8, 11, 10]],\n  [[5, 4, 0], [5, 0, 11], [5, 11, 10], [11, 0, 3]],\n  [[5, 4, 8], [5, 8, 10], [10, 8, 11]],\n  [[9, 7, 8], [5, 7, 9]],\n  [[9, 3, 0], [9, 5, 3], [5, 7, 3]],\n  [[0, 7, 8], [0, 1, 7], [1, 5, 7]],\n  [[1, 5, 3], [3, 5, 7]],\n  [[9, 7, 8], [9, 5, 7], [10, 1, 2]],\n  [[10, 1, 2], [9, 5, 0], [5, 3, 0], [5, 7, 3]],\n  [[8, 0, 2], [8, 2, 5], [8, 5, 7], [10, 5, 2]],\n  [[2, 10, 5], [2, 5, 3], [3, 5, 7]],\n  [[7, 9, 5], [7, 8, 9], [3, 11, 2]],\n  [[9, 5, 7], [9, 7, 2], [9, 2, 0], [2, 7, 11]],\n  [[2, 3, 11], [0, 1, 8], [1, 7, 8], [1, 5, 7]],\n  [[11, 2, 1], [11, 1, 7], [7, 1, 5]],\n  [[9, 5, 8], [8, 5, 7], [10, 1, 3], [10, 3, 11]],\n  [[5, 7, 0], [5, 0, 9], [7, 11, 0], [1, 0, 10], [11, 10, 0]],\n  [[11, 10, 0], [11, 0, 3], [10, 5, 0], [8, 0, 7], [5, 7, 0]],\n  [[11, 10, 5], [7, 11, 5]],\n  [[10, 6, 5]],\n  [[0, 8, 3], [5, 10, 6]],\n  [[9, 0, 1], [5, 10, 6]],\n  [[1, 8, 3], [1, 9, 8], [5, 10, 6]],\n  [[1, 6, 5], [2, 6, 1]],\n  [[1, 6, 5], [1, 2, 6], [3, 0, 8]],\n  [[9, 6, 5], [9, 0, 6], [0, 2, 6]],\n  [[5, 9, 8], [5, 8, 2], [5, 2, 6], [3, 2, 8]],\n  [[2, 3, 11], [10, 6, 5]],\n  [[11, 0, 8], [11, 2, 0], [10, 6, 5]],\n  [[0, 1, 9], [2, 3, 11], [5, 10, 6]],\n  [[5, 10, 6], [1, 9, 2], [9, 11, 2], [9, 8, 11]],\n  [[6, 3, 11], [6, 5, 3], [5, 1, 3]],\n  [[0, 8, 11], [0, 11, 5], [0, 5, 1], [5, 11, 6]],\n  [[3, 11, 6], [0, 3, 6], [0, 6, 5], [0, 5, 9]],\n  [[6, 5, 9], [6, 9, 11], [11, 9, 8]],\n  [[5, 10, 6], [4, 7, 8]],\n  [[4, 3, 0], [4, 7, 3], [6, 5, 10]],\n  [[1, 9, 0], [5, 10, 6], [8, 4, 7]],\n  [[10, 6, 5], [1, 9, 7], [1, 7, 3], [7, 9, 4]],\n  [[6, 1, 2], [6, 5, 1], [4, 7, 8]],\n  [[1, 2, 5], [5, 2, 6], [3, 0, 4], [3, 4, 7]],\n  [[8, 4, 7], [9, 0, 5], [0, 6, 5], [0, 2, 6]],\n  [[7, 3, 9], [7, 9, 4], [3, 2, 9], [5, 9, 6], [2, 6, 9]],\n  [[3, 11, 2], [7, 8, 4], [10, 6, 5]],\n  [[5, 10, 6], [4, 7, 2], [4, 2, 0], [2, 7, 11]],\n  [[0, 1, 9], [4, 7, 8], [2, 3, 11], [5, 10, 6]],\n  [[9, 2, 1], [9, 11, 2], [9, 4, 11], [7, 11, 4], [5, 10, 6]],\n  [[8, 4, 7], [3, 11, 5], [3, 5, 1], [5, 11, 6]],\n  [[5, 1, 11], [5, 11, 6], [1, 0, 11], [7, 11, 4], [0, 4, 11]],\n  [[0, 5, 9], [0, 6, 5], [0, 3, 6], [11, 6, 3], [8, 4, 7]],\n  [[6, 5, 9], [6, 9, 11], [4, 7, 9], [7, 11, 9]],\n  [[10, 4, 9], [6, 4, 10]],\n  [[4, 10, 6], [4, 9, 10], [0, 8, 3]],\n  [[10, 0, 1], [10, 6, 0], [6, 4, 0]],\n  [[8, 3, 1], [8, 1, 6], [8, 6, 4], [6, 1, 10]],\n  [[1, 4, 9], [1, 2, 4], [2, 6, 4]],\n  [[3, 0, 8], [1, 2, 9], [2, 4, 9], [2, 6, 4]],\n  [[0, 2, 4], [4, 2, 6]],\n  [[8, 3, 2], [8, 2, 4], [4, 2, 6]],\n  [[10, 4, 9], [10, 6, 4], [11, 2, 3]],\n  [[0, 8, 2], [2, 8, 11], [4, 9, 10], [4, 10, 6]],\n  [[3, 11, 2], [0, 1, 6], [0, 6, 4], [6, 1, 10]],\n  [[6, 4, 1], [6, 1, 10], [4, 8, 1], [2, 1, 11], [8, 11, 1]],\n  [[9, 6, 4], [9, 3, 6], [9, 1, 3], [11, 6, 3]],\n  [[8, 11, 1], [8, 1, 0], [11, 6, 1], [9, 1, 4], [6, 4, 1]],\n  [[3, 11, 6], [3, 6, 0], [0, 6, 4]],\n  [[6, 4, 8], [11, 6, 8]],\n  [[7, 10, 6], [7, 8, 10], [8, 9, 10]],\n  [[0, 7, 3], [0, 10, 7], [0, 9, 10], [6, 7, 10]],\n  [[10, 6, 7], [1, 10, 7], [1, 7, 8], [1, 8, 0]],\n  [[10, 6, 7], [10, 7, 1], [1, 7, 3]],\n  [[1, 2, 6], [1, 6, 8], [1, 8, 9], [8, 6, 7]],\n  [[2, 6, 9], [2, 9, 1], [6, 7, 9], [0, 9, 3], [7, 3, 9]],\n  [[7, 8, 0], [7, 0, 6], [6, 0, 2]],\n  [[7, 3, 2], [6, 7, 2]],\n  [[2, 3, 11], [10, 6, 8], [10, 8, 9], [8, 6, 7]],\n  [[2, 0, 7], [2, 7, 11], [0, 9, 7], [6, 7, 10], [9, 10, 7]],\n  [[1, 8, 0], [1, 7, 8], [1, 10, 7], [6, 7, 10], [2, 3, 11]],\n  [[11, 2, 1], [11, 1, 7], [10, 6, 1], [6, 7, 1]],\n  [[8, 9, 6], [8, 6, 7], [9, 1, 6], [11, 6, 3], [1, 3, 6]],\n  [[0, 9, 1], [11, 6, 7]],\n  [[7, 8, 0], [7, 0, 6], [3, 11, 0], [11, 6, 0]],\n  [[7, 11, 6]],\n  [[7, 6, 11]],\n  [[3, 0, 8], [11, 7, 6]],\n  [[0, 1, 9], [11, 7, 6]],\n  [[8, 1, 9], [8, 3, 1], [11, 7, 6]],\n  [[10, 1, 2], [6, 11, 7]],\n  [[1, 2, 10], [3, 0, 8], [6, 11, 7]],\n  [[2, 9, 0], [2, 10, 9], [6, 11, 7]],\n  [[6, 11, 7], [2, 10, 3], [10, 8, 3], [10, 9, 8]],\n  [[7, 2, 3], [6, 2, 7]],\n  [[7, 0, 8], [7, 6, 0], [6, 2, 0]],\n  [[2, 7, 6], [2, 3, 7], [0, 1, 9]],\n  [[1, 6, 2], [1, 8, 6], [1, 9, 8], [8, 7, 6]],\n  [[10, 7, 6], [10, 1, 7], [1, 3, 7]],\n  [[10, 7, 6], [1, 7, 10], [1, 8, 7], [1, 0, 8]],\n  [[0, 3, 7], [0, 7, 10], [0, 10, 9], [6, 10, 7]],\n  [[7, 6, 10], [7, 10, 8], [8, 10, 9]],\n  [[6, 8, 4], [11, 8, 6]],\n  [[3, 6, 11], [3, 0, 6], [0, 4, 6]],\n  [[8, 6, 11], [8, 4, 6], [9, 0, 1]],\n  [[9, 4, 6], [9, 6, 3], [9, 3, 1], [11, 3, 6]],\n  [[6, 8, 4], [6, 11, 8], [2, 10, 1]],\n  [[1, 2, 10], [3, 0, 11], [0, 6, 11], [0, 4, 6]],\n  [[4, 11, 8], [4, 6, 11], [0, 2, 9], [2, 10, 9]],\n  [[10, 9, 3], [10, 3, 2], [9, 4, 3], [11, 3, 6], [4, 6, 3]],\n  [[8, 2, 3], [8, 4, 2], [4, 6, 2]],\n  [[0, 4, 2], [4, 6, 2]],\n  [[1, 9, 0], [2, 3, 4], [2, 4, 6], [4, 3, 8]],\n  [[1, 9, 4], [1, 4, 2], [2, 4, 6]],\n  [[8, 1, 3], [8, 6, 1], [8, 4, 6], [6, 10, 1]],\n  [[10, 1, 0], [10, 0, 6], [6, 0, 4]],\n  [[4, 6, 3], [4, 3, 8], [6, 10, 3], [0, 3, 9], [10, 9, 3]],\n  [[10, 9, 4], [6, 10, 4]],\n  [[4, 9, 5], [7, 6, 11]],\n  [[0, 8, 3], [4, 9, 5], [11, 7, 6]],\n  [[5, 0, 1], [5, 4, 0], [7, 6, 11]],\n  [[11, 7, 6], [8, 3, 4], [3, 5, 4], [3, 1, 5]],\n  [[9, 5, 4], [10, 1, 2], [7, 6, 11]],\n  [[6, 11, 7], [1, 2, 10], [0, 8, 3], [4, 9, 5]],\n  [[7, 6, 11], [5, 4, 10], [4, 2, 10], [4, 0, 2]],\n  [[3, 4, 8], [3, 5, 4], [3, 2, 5], [10, 5, 2], [11, 7, 6]],\n  [[7, 2, 3], [7, 6, 2], [5, 4, 9]],\n  [[9, 5, 4], [0, 8, 6], [0, 6, 2], [6, 8, 7]],\n  [[3, 6, 2], [3, 7, 6], [1, 5, 0], [5, 4, 0]],\n  [[6, 2, 8], [6, 8, 7], [2, 1, 8], [4, 8, 5], [1, 5, 8]],\n  [[9, 5, 4], [10, 1, 6], [1, 7, 6], [1, 3, 7]],\n  [[1, 6, 10], [1, 7, 6], [1, 0, 7], [8, 7, 0], [9, 5, 4]],\n  [[4, 0, 10], [4, 10, 5], [0, 3, 10], [6, 10, 7], [3, 7, 10]],\n  [[7, 6, 10], [7, 10, 8], [5, 4, 10], [4, 8, 10]],\n  [[6, 9, 5], [6, 11, 9], [11, 8, 9]],\n  [[3, 6, 11], [0, 6, 3], [0, 5, 6], [0, 9, 5]],\n  [[0, 11, 8], [0, 5, 11], [0, 1, 5], [5, 6, 11]],\n  [[6, 11, 3], [6, 3, 5], [5, 3, 1]],\n  [[1, 2, 10], [9, 5, 11], [9, 11, 8], [11, 5, 6]],\n  [[0, 11, 3], [0, 6, 11], [0, 9, 6], [5, 6, 9], [1, 2, 10]],\n  [[11, 8, 5], [11, 5, 6], [8, 0, 5], [10, 5, 2], [0, 2, 5]],\n  [[6, 11, 3], [6, 3, 5], [2, 10, 3], [10, 5, 3]],\n  [[5, 8, 9], [5, 2, 8], [5, 6, 2], [3, 8, 2]],\n  [[9, 5, 6], [9, 6, 0], [0, 6, 2]],\n  [[1, 5, 8], [1, 8, 0], [5, 6, 8], [3, 8, 2], [6, 2, 8]],\n  [[1, 5, 6], [2, 1, 6]],\n  [[1, 3, 6], [1, 6, 10], [3, 8, 6], [5, 6, 9], [8, 9, 6]],\n  [[10, 1, 0], [10, 0, 6], [9, 5, 0], [5, 6, 0]],\n  [[0, 3, 8], [5, 6, 10]],\n  [[10, 5, 6]],\n  [[11, 5, 10], [7, 5, 11]],\n  [[11, 5, 10], [11, 7, 5], [8, 3, 0]],\n  [[5, 11, 7], [5, 10, 11], [1, 9, 0]],\n  [[10, 7, 5], [10, 11, 7], [9, 8, 1], [8, 3, 1]],\n  [[11, 1, 2], [11, 7, 1], [7, 5, 1]],\n  [[0, 8, 3], [1, 2, 7], [1, 7, 5], [7, 2, 11]],\n  [[9, 7, 5], [9, 2, 7], [9, 0, 2], [2, 11, 7]],\n  [[7, 5, 2], [7, 2, 11], [5, 9, 2], [3, 2, 8], [9, 8, 2]],\n  [[2, 5, 10], [2, 3, 5], [3, 7, 5]],\n  [[8, 2, 0], [8, 5, 2], [8, 7, 5], [10, 2, 5]],\n  [[9, 0, 1], [5, 10, 3], [5, 3, 7], [3, 10, 2]],\n  [[9, 8, 2], [9, 2, 1], [8, 7, 2], [10, 2, 5], [7, 5, 2]],\n  [[1, 3, 5], [3, 7, 5]],\n  [[0, 8, 7], [0, 7, 1], [1, 7, 5]],\n  [[9, 0, 3], [9, 3, 5], [5, 3, 7]],\n  [[9, 8, 7], [5, 9, 7]],\n  [[5, 8, 4], [5, 10, 8], [10, 11, 8]],\n  [[5, 0, 4], [5, 11, 0], [5, 10, 11], [11, 3, 0]],\n  [[0, 1, 9], [8, 4, 10], [8, 10, 11], [10, 4, 5]],\n  [[10, 11, 4], [10, 4, 5], [11, 3, 4], [9, 4, 1], [3, 1, 4]],\n  [[2, 5, 1], [2, 8, 5], [2, 11, 8], [4, 5, 8]],\n  [[0, 4, 11], [0, 11, 3], [4, 5, 11], [2, 11, 1], [5, 1, 11]],\n  [[0, 2, 5], [0, 5, 9], [2, 11, 5], [4, 5, 8], [11, 8, 5]],\n  [[9, 4, 5], [2, 11, 3]],\n  [[2, 5, 10], [3, 5, 2], [3, 4, 5], [3, 8, 4]],\n  [[5, 10, 2], [5, 2, 4], [4, 2, 0]],\n  [[3, 10, 2], [3, 5, 10], [3, 8, 5], [4, 5, 8], [0, 1, 9]],\n  [[5, 10, 2], [5, 2, 4], [1, 9, 2], [9, 4, 2]],\n  [[8, 4, 5], [8, 5, 3], [3, 5, 1]],\n  [[0, 4, 5], [1, 0, 5]],\n  [[8, 4, 5], [8, 5, 3], [9, 0, 5], [0, 3, 5]],\n  [[9, 4, 5]],\n  [[4, 11, 7], [4, 9, 11], [9, 10, 11]],\n  [[0, 8, 3], [4, 9, 7], [9, 11, 7], [9, 10, 11]],\n  [[1, 10, 11], [1, 11, 4], [1, 4, 0], [7, 4, 11]],\n  [[3, 1, 4], [3, 4, 8], [1, 10, 4], [7, 4, 11], [10, 11, 4]],\n  [[4, 11, 7], [9, 11, 4], [9, 2, 11], [9, 1, 2]],\n  [[9, 7, 4], [9, 11, 7], [9, 1, 11], [2, 11, 1], [0, 8, 3]],\n  [[11, 7, 4], [11, 4, 2], [2, 4, 0]],\n  [[11, 7, 4], [11, 4, 2], [8, 3, 4], [3, 2, 4]],\n  [[2, 9, 10], [2, 7, 9], [2, 3, 7], [7, 4, 9]],\n  [[9, 10, 7], [9, 7, 4], [10, 2, 7], [8, 7, 0], [2, 0, 7]],\n  [[3, 7, 10], [3, 10, 2], [7, 4, 10], [1, 10, 0], [4, 0, 10]],\n  [[1, 10, 2], [8, 7, 4]],\n  [[4, 9, 1], [4, 1, 7], [7, 1, 3]],\n  [[4, 9, 1], [4, 1, 7], [0, 8, 1], [8, 7, 1]],\n  [[4, 0, 3], [7, 4, 3]],\n  [[4, 8, 7]],\n  [[9, 10, 8], [10, 11, 8]],\n  [[3, 0, 9], [3, 9, 11], [11, 9, 10]],\n  [[0, 1, 10], [0, 10, 8], [8, 10, 11]],\n  [[3, 1, 10], [11, 3, 10]],\n  [[1, 2, 11], [1, 11, 9], [9, 11, 8]],\n  [[3, 0, 9], [3, 9, 11], [1, 2, 9], [2, 11, 9]],\n  [[0, 2, 11], [8, 0, 11]],\n  [[3, 2, 11]],\n  [[2, 3, 8], [2, 8, 10], [10, 8, 9]],\n  [[9, 10, 2], [0, 9, 2]],\n  [[2, 3, 8], [2, 8, 10], [0, 1, 8], [1, 10, 8]],\n  [[1, 10, 2]],\n  [[1, 3, 8], [9, 1, 8]],\n  [[0, 9, 1]],\n  [[0, 3, 8]],\n  []\n]\n","import { triangleTable } from './triangleTable'\n\n/**\n * Interpolation\n *\n * Interpolates to find the value of x that makes\n * f(x) == c, assuming that a is f(x1), b is f(x2)\n * and c is between a and b.\n */\nfunction interp(x1, x2, a, b, c) {\n  const t = (c - a) / (b - a)\n  return x1 * (1 - t) + x2 * t\n}\n\nclass MarchingCube {\n\n  constructor(x, y, z, xStep, yStep, zStep, func, c) {\n    this.x = x\n    this.y = y\n    this.z = z\n    this.xStep = xStep\n    this.yStep = yStep\n    this.zStep = zStep\n    this.c = c\n    this.v1 = func(x, y, z)\n    this.v2 = func(x+xStep, y, z)\n    this.v4 = func(x+xStep, y, z+zStep)\n    this.v8 = func(x, y, z+zStep)\n    this.v16 = func(x, y+yStep, z)\n    this.v32 = func(x+xStep, y+yStep, z)\n    this.v64 = func(x+xStep, y+yStep, z+zStep)\n    this.v128 = func(x, y+yStep, z+zStep)\n    this.edgePoints = new Map()\n  }\n\n  /**\n   * getIndex\n   *\n   * Return the index into the 256 value lookup table\n   */\n  getIndex() {\n    let index = 0\n    const values = [\n      this.v1, this.v2, this.v4, this.v8,\n      this.v16, this.v32, this.v64, this.v128\n    ]\n    for (let i = 0; i < values.length; i++) {\n      const bit = 2**i\n      index += (values[i] > this.c) * bit\n    }\n    return index\n  }\n\n  getEdgePoint(edgeIndex) {\n    if (this.edgePoints.has(edgeIndex)) {\n      return this.edgePoints.get(edgeIndex)\n    }\n    let x, y, z\n    switch (edgeIndex) {\n\n      // See edge numbers here: http://paulbourke.net/geometry/polygonise/\n      case 0:\n        x = interp(this.x, this.x+this.xStep, this.v1, this.v2, this.c)\n        y = this.y\n        z = this.z\n        break\n      case 1:\n        x = this.x + this.xStep\n        y = this.y\n        z = interp(this.z, this.z+this.zStep, this.v2, this.v4, this.c)\n        break\n      case 2:\n        x = interp(this.x, this.x+this.xStep, this.v8, this.v4, this.c)\n        y = this.y\n        z = this.z + this.zStep\n        break\n      case 3:\n        x = this.x\n        y = this.y\n        z = interp(this.z, this.z+this.zStep, this.v1, this.v8, this.c)\n        break\n      case 4:\n        x = interp(this.x, this.x+this.xStep, this.v16, this.v32, this.c)\n        y = this.y + this.yStep\n        z = this.z\n        break\n      case 5:\n        x = this.x + this.xStep\n        y = this.y + this.yStep\n        z = interp(this.z, this.z+this.zStep, this.v32, this.v64, this.c)\n        break\n      case 6:\n        x = interp(this.x, this.x+this.xStep, this.v128, this.v64, this.c)\n        y = this.y + this.yStep\n        z = this.z + this.zStep\n        break\n      case 7:\n        x = this.x\n        y = this.y + this.yStep\n        z = interp(this.z, this.z+this.zStep, this.v16, this.v128, this.c)\n        break\n      case 8:\n        x = this.x\n        y = interp(this.y, this.y+this.yStep, this.v1, this.v16, this.c)\n        z = this.z\n        break\n      case 9:\n        x = this.x + this.xStep\n        y = interp(this.y, this.y+this.yStep, this.v2, this.v32, this.c)\n        z = this.z\n        break\n      case 10:\n        x = this.x + this.xStep\n        y = interp(this.y, this.y+this.yStep, this.v4, this.v64, this.c)\n        z = this.z + this.zStep\n        break\n      case 11:\n        x = this.x\n        y = interp(this.y, this.y+this.yStep, this.v8, this.v128, this.c)\n        z = this.z + this.zStep\n        break\n      default:\n        throw new Error('Edge index must be between 0 and 11')\n\n    }\n    this.edgePoints.set(edgeIndex, [x, y, z] )\n    return [x, y, z]\n  }\n\n}\n\nexport default function marchingCubes(\n  xMin, xMax, yMin, yMax, zMin, zMax,\n  func, c = 0, resolution = 128\n) {\n  const xStep = (xMax - xMin) / resolution\n  const yStep = (yMax - yMin) / resolution\n  const zStep = (zMax - zMin) / resolution\n  const finalTriangles = []\n  for (let x = xMin; x < xMax; x += xStep) {\n    for (let y = yMin; y < yMax; y += yStep) {\n      for (let z = zMin; z < zMax; z += zStep) {\n        // Same order as on http://paulbourke.net/geometry/polygonise/\n        const cube = new MarchingCube(x, y, z, xStep, yStep, zStep, func, c)\n        const cubeCase = triangleTable[cube.getIndex()]\n        for (let i = 0; i < cubeCase.length; i++) {\n          const triangle = cubeCase[i]\n          finalTriangles.push( [\n            cube.getEdgePoint(triangle[0] ),\n            cube.getEdgePoint(triangle[1] ),\n            cube.getEdgePoint(triangle[2] )\n          ] )\n        }\n      }\n    }\n  }\n  return finalTriangles\n}\n","// @flow\n\nconst THREE = window.THREE\n\nexport const colors = [\n  '#33FF00',\n  '#2ecc71',\n  '#3498db',\n  '#9b59b6',\n  '#8e44ad',\n  '#2c3e50',\n  '#f1c40f',\n  '#e67e22',\n  '#e74c3c',\n  '#808080'\n]\n\nexport const colorMaps = {\n  rainbow: {\n    css: `background: linear-gradient(\n      to right,\n      hsl(360, 100%, 50%),\n      hsl(300, 100%, 50%),\n      hsl(240, 100%, 50%),\n      hsl(180, 100%, 50%),\n      hsl(120, 100%, 50%),\n      hsl(60, 100%, 50%),\n      hsl(0, 100%, 50%)\n    )\n    `,\n    func: (frac: number) => {\n      const color = new THREE.Color(0xffffff)\n      color.setHSL(1 - frac, 1, 0.5)\n      return [color.r, color.g, color.b, 1.0]\n    }\n  },\n  bluered: {\n    css: 'background: linear-gradient(to right, blue, red)',\n    func: (frac: number) => {\n      return [frac, 0, 1 - frac, 1]\n    }\n  },\n  temperature: {\n    css: `background: linear-gradient(\n      to right,\n      hsl(240, 100%, 50%),\n      hsl(180, 100%, 50%),\n      hsl(120, 100%, 50%),\n      hsl(60, 100%, 50%),\n      hsl(0, 100%, 50%)\n    )\n    `,\n    func: (frac: number) => {\n      const color = new THREE.Color(0xffffff)\n      color.setHSL(0.666*(1 - frac), 1, 0.5)\n      return [color.r, color.g, color.b, 1.0]\n    }\n  }\n}\n","// @flow\nimport * as React from 'react'\nimport math from 'utils/mathjs'\nimport {\n  validateBoolean,\n  isEqualNumerically,\n  isReal,\n  validateReal,\n  validateVector,\n  isVector,\n  validateFunctionSignature,\n  hasFunctionSignature\n} from './helpers'\nimport diffWithSets from 'utils/shallowDiffWithSets'\nimport { lighten } from 'utils/colors'\nimport marchingCubes from 'utils/marchingCubes'\nimport { colorMaps } from 'constants/colors'\n\nconst THREE = window.THREE\n\ntype MathBoxNode = any\n\ntype HandlerNodes = {\n  renderNodes: MathBoxNode,\n  dataNodes: MathBoxNode,\n  groupNode: MathBoxNode,\n  root: MathBoxNode\n}\n\nexport type HandledProps = {\n  [string]: any,\n}\n\nexport type ErrorMap = {\n  [string]: Error | null\n}\n\nexport type Props = HandledProps & {\n  id: string,\n  children?: React.Node,\n  mathbox?: MathBoxNode, // supplied by parent during render\n  mathboxParent?: MathBoxNode, // supplied by parent during render\n  handleErrors: (errors: ErrorMap, id: string, updatedProps: HandledProps) => void\n}\n\ntype Handler = (\n  nodes: HandlerNodes,\n  props: Props,\n  handlers: { [string]: Handler }\n) => void | ErrorMap\ntype Handlers = { [string]: Handler }\n\ninterface MathBoxComponent {\n  mathboxRender: (MathBoxNode) => MathBoxNode,\n  dataNodeNames: ?Array<string>,\n  renderNodeNames: ?Array<string>,\n  handlers: Handlers\n}\n\nclass AbstractMBC extends React.Component<Props> {\n\n  mathbox: MathBoxNode // root node\n  mathboxNode: MathBoxNode // node for this component\n  oldProps = {}\n  diffProps: {\n    added: Set<string>,\n    deleted: Set<string>,\n    unchanged: Set<string>,\n    updated: Set<string>\n  } = {\n    added: new Set(),\n    deleted: new Set(),\n    unchanged: new Set(),\n    updated: new Set()\n  }\n\n  static defaultProps = {\n    handleErrors: AbstractMBC.defaultHandleErrors\n  }\n\n  shouldComponentUpdate = (nextProps: Props) => {\n    this.oldProps = this.props\n    this.diffProps = diffWithSets(this.props, nextProps)\n    const { added, deleted, updated, unchanged } = this.diffProps\n    for (const prop of updated) {\n      if (isEqualNumerically(this.oldProps[prop], nextProps[prop] )) {\n        updated.delete(prop)\n        unchanged.add(prop)\n      }\n    }\n    return updated.size !== 0 || added.size !== 0 || deleted.size !== 0\n  }\n\n  componentDidMount = () => {\n    if (this.props.mathboxParent) {\n      // $FlowFixMe: this.mathboxRender is abstract\n      this.mathboxNode = this.mathboxRender(this.props.mathboxParent)\n      this.mathbox = this.props.mathbox\n    }\n    else {\n      throw ReferenceError(`${this.constructor.name} called without a 'mathboxParent' property.`)\n    }\n\n    this.forceUpdate()\n    // render method only updates updated props, need to update all on mount\n    this.updateHandledProps(this.props)\n  }\n\n  componentWillUnmount = () => {\n    this.mathboxNode.remove()\n  }\n\n  renderChildren = () => {\n    if (!this.props.children) {\n      return null\n    }\n    return React.Children.map(\n      this.props.children,\n      child => React.cloneElement(child, {\n        mathboxParent: this.mathboxNode,\n        mathbox: this.mathbox\n      } )\n    )\n  }\n\n  render() {\n    if (this.mathboxNode) {\n      return this.renderChildren()\n    }\n    return null\n  }\n\n  getNodes(nodeNames: ?Array<string>) {\n    return nodeNames\n      ? this.mathboxNode.select(nodeNames.join(', '))\n      : undefined\n  }\n\n  updateHandledProps(propsToUpdate: HandledProps) {\n    const nodes = {\n      // $FlowFixMe: this.dataNodeNames is abstract\n      dataNodes: this.getNodes(this.dataNodeNames),\n      // $FlowFixMe: this.renderNodeNames is abstract\n      renderNodes: this.getNodes(this.renderNodeNames),\n      groupNode: this.mathboxNode,\n      root: this.mathbox\n    }\n\n    const errors = {}\n    Object.keys(propsToUpdate).forEach(prop => {\n      // $FlowFixMe: this.handlers is abstract\n      if (this.handlers.hasOwnProperty(prop)) {\n        try {\n          // $FlowFixMe: this.handlers is abstract\n          const extraErrors = this.handlers[prop](nodes, this.props, this.handlers)\n          if (extraErrors) {\n            Object.keys(extraErrors).forEach(key => {\n              errors[key] = extraErrors[key]\n            } )\n          }\n        }\n        catch (error) {\n          errors[prop] = error\n        }\n      }\n    } )\n\n    this.props.handleErrors(errors, this.props.id, propsToUpdate)\n\n  }\n\n  static defaultHandleErrors(errors: ErrorMap, id: string, updatedProps: HandledProps) {\n    if (Object.keys(errors).length === 0) {\n      return\n    }\n    Object.keys(errors).forEach(propName => {\n      console.warn(errors[propName] )\n    } )\n  }\n\n  componentDidUpdate() {\n    const differing = [\n      ...this.diffProps.updated,\n      ...this.diffProps.added\n    ].reduce((acc, prop) => {\n      acc[prop] = this.props[prop]\n      return acc\n    }, {} )\n    this.updateHandledProps(differing)\n  }\n\n}\n\nfunction makeSetProperty(propName, validator: ?Function) {\n  return ( { renderNodes }: HandlerNodes, handledProps: HandledProps) => {\n    if (validator) {\n      validator(handledProps[propName] )\n    }\n    return renderNodes.set(propName, handledProps[propName] )\n  }\n}\n\nconst universalHandlers = {\n  opacity: makeSetProperty('opacity', validateReal),\n  zBias: makeSetProperty('zBias', validateReal),\n  zIndex: makeSetProperty('zIndex', validateReal),\n  zOrder: makeSetProperty('zOrder', validateReal),\n  color: makeSetProperty('color'),\n  calculatedVisibility: function(nodes: HandlerNodes, props: Props) {\n    const { calculatedVisibility, useCalculatedVisibility } = props\n    if (useCalculatedVisibility) {\n      validateBoolean(calculatedVisibility)\n      nodes.groupNode.set('visible', calculatedVisibility)\n    }\n  },\n  visible: function(nodes: HandlerNodes, props: Props) {\n    if (!props.useCalculatedVisibility) {\n      nodes.groupNode.set('visible', props.visible)\n    }\n  }\n}\n\nconst lineLikeHandlers = {\n  size: makeSetProperty('size', validateReal),\n  width: makeSetProperty('width', validateReal),\n  start: makeSetProperty('start'),\n  end: makeSetProperty('end')\n}\n\nconst surfaceHandlers = {\n  shaded: makeSetProperty('shaded')\n}\n\nfunction makeHandleLabel(dataOffset) {\n  return (nodes: HandlerNodes, handledProps: HandledProps) => {\n    const data = [...Array(dataOffset).fill(''), handledProps.label]\n    nodes.groupNode.select('format.label').set('data', data)\n  }\n}\n\nfunction handleLabelVisible(nodes: HandlerNodes, handledProps: HandledProps) {\n  nodes.groupNode.select('label.label').set('visible', handledProps.labelVisible)\n}\n\nfunction scaleToUnit(x: number, xMin: number, xMax: number) {\n  return (x - xMin)/(xMax - xMin)\n}\n\nexport class Camera extends AbstractMBC implements MathBoxComponent {\n  // NOTE: MathBox seems to have some issues with orthographic cameras:\n  // A type: \"orthographic\" key can be provided to the camera config during\n  // mathbox initialization, but sprites are rendered upside-down.\n  //\n  // As a workaround, I'm using dolly zoom to get an orthographic-like effect.\n  // See, for example, https://docs.unity3d.com/Manual/DollyZoom.html\n  dataNodeNames = ['camera']\n  renderNodeNames = null\n  handlers: Handlers\n  isOrthographic: boolean\n  dollyZoomFactor: number\n\n  constructor(props: Props) {\n    super(props)\n    this.isOrthographic = false\n    this.dollyZoomFactor = 50\n    this.handlers = {\n      relativePosition: Camera.handleRelativePosition,\n      relativeLookAt: Camera.handleRelativeLookAt,\n      isRotateEnabled: Camera.handleIsRotateEnabled,\n      isZoomEnabled: Camera.handleIsZoomEnabled,\n      isPanEnabled: Camera.handlePanIsPanEnabled,\n      computedPosition: this.handleComputedPosition,\n      computedLookAt: Camera.handleComputedLookAt,\n      useComputed: this.handleUseComputed,\n      isOrthographic: this.handleIsOrthographic\n    }\n  }\n\n  static frustrumHeightAtDistance(fovDegrees: number, distance: number) {\n    return 2 * distance * Math.tan(0.5 * fovDegrees * Math.PI/180)\n  }\n  static fovForHeightAndDistance(height: number, distance: number) {\n    return 2 * Math.atan(0.5 * height / distance) * 180/Math.PI\n  }\n\n  static dollyZoom(mathboxRoot: MathBoxNode, zoomFactor: number) {\n    const { camera, controls } = mathboxRoot.three\n    const d1 = camera.position.distanceTo(controls.center)\n    const fov1 = camera.fov\n    const h = Camera.frustrumHeightAtDistance(fov1, d1)\n    const d2 = d1 * zoomFactor\n    const fov2 = Camera.fovForHeightAndDistance(h, d2)\n\n    // This tells mathBox to account for the zoom when drawing lines/points\n    mathboxRoot.set('focus', mathboxRoot.get('focus') * zoomFactor)\n\n    Camera.translateForDollyZoom(camera, controls, zoomFactor)\n    camera.fov = fov2\n  }\n\n  static translateForDollyZoom(camera: any, controls: any, zoomFactor: number) {\n    const d = camera.position.distanceTo(controls.center)\n    camera.translateZ(d * (zoomFactor - 1))\n  }\n\n  handleIsOrthographic = (nodes: HandlerNodes, handledProps: HandledProps) => {\n    const { isOrthographic } = handledProps\n    if (this.isOrthographic === isOrthographic) {\n      return\n    }\n    if (isOrthographic) {\n      Camera.dollyZoom(nodes.root, this.dollyZoomFactor)\n      this.isOrthographic = true\n    }\n    else {\n      Camera.dollyZoom(nodes.root, 1/this.dollyZoomFactor)\n      this.isOrthographic = false\n    }\n  }\n\n  static handlePanIsPanEnabled(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { root } = nodes\n    root.three.controls.noPan = !handledProps.isPanEnabled\n  }\n\n  static handleIsZoomEnabled(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { root } = nodes\n    root.three.controls.noZoom = !handledProps.isZoomEnabled\n  }\n\n  static handleIsRotateEnabled(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { root } = nodes\n    root.three.controls.noRotate = !handledProps.isRotateEnabled\n  }\n\n  static handleRelativePosition(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { dataNodes } = nodes\n    const { relativePosition } = handledProps\n    dataNodes.set('position', relativePosition)\n  }\n\n  static handleRelativeLookAt(nodes: HandlerNodes, handledProps: HandledProps) {\n    // MathBox Camera lookAt prop seems to do nothing. Set the center of threejs\n    // OrbitControls object instead\n    const { root } = nodes\n    const { relativeLookAt } = handledProps\n    root.three.controls.center.set(...relativeLookAt)\n  }\n\n  handleUseComputed = (nodes: HandlerNodes, handledProps: HandledProps) => {\n    const { computedPosition, computedLookAt } = handledProps\n    if (isVector(computedPosition, 3)) {\n      this.handleComputedPosition(nodes, handledProps)\n    }\n    if (isVector(computedLookAt, 3)) {\n      Camera.handleComputedLookAt(nodes, handledProps)\n    }\n  }\n\n  handleComputedPosition = (nodes: HandlerNodes, handledProps: HandledProps) => {\n    const { computedPosition, useComputed } = handledProps\n    validateVector(computedPosition, 3)\n    if (!useComputed) { return }\n    const { root } = nodes\n    // range is an array of 4 THREE.Vector2 objects\n    const cartesian = root.select('cartesian')\n    const relPosition = Camera.toRelativeCoords(computedPosition, cartesian)\n    // set position directly on camera object, not in mathBox\n    root.three.camera.position.set(...relPosition)\n\n    if (this.isOrthographic) {\n      const { camera, controls } = root.three\n      Camera.translateForDollyZoom(camera, controls, this.dollyZoomFactor)\n    }\n  }\n\n  static handleComputedLookAt(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { computedLookAt, useComputed } = handledProps\n    validateVector(computedLookAt, 3)\n    if (!useComputed) { return }\n    const { root } = nodes\n    // range is an array of 4 THREE.Vector2 objects\n    const cartesian = root.select('cartesian')\n    const relLookAt = Camera.toRelativeCoords(computedLookAt, cartesian)\n    // set position directly on camera object, not in mathBox\n    root.three.controls.center.set(...relLookAt)\n  }\n\n  static toRelativeCoords(\n    coords: Array<number>,\n    cartesian: MathBoxNode\n  ): Array<number> {\n    // Converts from cartesian's coordinates to relative coordinates\n    // input box:\n    //  [xMin, xMax] by [yMin, yMax] by [zMin, zMax] from range\n    // output box:\n    //  [-scale.x, +scale.x] by [-scale.y, +scale.y] by [-scale.z, +scale.z]\n\n    const range: Array<{ x: number, y: number }> = cartesian.get('range')\n    const scale: Array<number> = cartesian.get('scale').toArray()\n\n    return coords.map((coord, index) => {\n      const { y: max, x: min } = range[index]\n      const b = -(max + min)/(max - min)\n      const a = 2/(max - min)\n      return (a*coord + b)*scale[index]\n    } )\n  }\n\n  mathboxRender = (parent) => {\n    const group = parent.group( { classes: ['camera'] } )\n\n    group.camera( { proxy: true } )\n    return group\n  }\n\n}\n\nexport class Cartesian extends AbstractMBC implements MathBoxComponent {\n\n  dataNodeNames = ['cartesian']\n  renderNodeNames = null\n  handlers = {}\n\n  mathboxRender = (parent) => {\n    const node = parent.cartesian( {\n      range: [[-5, 5], [-5, 5], [-5, 5]],\n      scale: [2, 2, 1]\n    } )\n    return node\n  }\n\n}\n\nfunction vec3ToArray(vec3Object: { x?: number, y?: number, z?: number } ) {\n  const { x = 0, y = 0, z = 0 } = vec3Object\n  return [x, y, z]\n}\n\nexport class Axis extends AbstractMBC implements MathBoxComponent {\n\n  dataNodeNames = null\n  renderNodeNames = ['axis']\n  handlers = {\n    ...universalHandlers,\n    // not using lineLikeHandlers because axis doesn't have start/end.\n    width: makeSetProperty('width'),\n    size: makeSetProperty('size'),\n    // now the rest\n    label: Axis.handleLabel,\n    labelVisible: handleLabelVisible,\n    min: Axis.handleMin,\n    max: Axis.handleMax,\n    axis: Axis.handleAxis,\n    scale: Axis.handleScale,\n    ticksVisible: Axis.handleTicksVisible\n  }\n\n  static handleTicksVisible(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { groupNode } = nodes\n    const { ticksVisible } = handledProps\n    groupNode.select('.ticks').set('visible', ticksVisible)\n  }\n\n  static handleLabel(nodes: HandlerNodes, handledProps: HandledProps) {\n    nodes.groupNode.select('.label text').set('data', [handledProps.label] )\n  }\n\n  static handleScale(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { scale, axis } = handledProps\n    validateReal(scale)\n    const cartesian = Axis.getCartesian(nodes.renderNodes)\n    const scaleCopy = { ...cartesian.props.scale }\n    scaleCopy[axis] = scale\n    cartesian.set('scale', scaleCopy)\n  }\n\n  static handleAxis(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { axis } = handledProps\n    nodes.renderNodes.set('axis', axis)\n    nodes.groupNode.select('scale').set('axis', axis)\n    if (axis === 'z') {\n      nodes.groupNode.select('.ticks > label').set('offset', [20, 0, 0] )\n    }\n  }\n\n  static handleMin(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { min, axis } = handledProps\n    validateReal(min)\n    const cartesian = Axis.getCartesian(nodes.renderNodes)\n    Axis.setAxisEnd(cartesian, axis, min, 0)\n  }\n\n  static handleMax(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { max, axis } = handledProps\n    validateReal(max)\n    const cartesian = Axis.getCartesian(nodes.renderNodes)\n    Axis.setAxisEnd(cartesian, axis, max, 1)\n\n    const labelPosition = vec3ToArray( { [axis]: max } )\n    nodes.groupNode.select('.label > array').set('data', [labelPosition] )\n  }\n\n  static copyCartesianRange(cartesian: MathBoxNode): Array<Array<number>> {\n    const range = cartesian.props.range // this is a THREE.vec4 object\n    return [\n      [range[0].x, range[0].y],\n      [range[1].x, range[1].y],\n      [range[2].x, range[2].y]\n    ]\n  }\n\n  static axisMap = { 'x': 0, 'y': 1, 'z': 2 }\n  static setAxisEnd(cartesian: MathBoxNode, axis: 'x' | 'y' | 'z', value: number, endIndex: 0 | 1) {\n    const cartesianRange = Axis.copyCartesianRange(cartesian)\n    const axisIndex = Axis.axisMap[axis]\n    cartesianRange[axisIndex][endIndex] = value\n    cartesian.set('range', cartesianRange)\n  }\n\n  static getCartesian(axisNode: MathBoxNode) {\n    let currentNode = axisNode[0]\n    while (currentNode.type !== 'cartesian') {\n      currentNode = currentNode.parent\n      if (currentNode.type === 'root') {\n        throw Error(\"Node type 'axis' should have 'cartesian' as an ancestor.\")\n      }\n    }\n    return currentNode\n  }\n\n  mathboxRender = (parent) => {\n    const node = parent.group( { classes: ['axis'] } )\n    node.axis()\n      .scale( {\n        divide: 10,\n        nice: true,\n        zero: false\n      } )\n\n    node.group( { classes: ['ticks'] } )\n      .ticks( { width: 2 } )\n      .format( { digits: 2 } )\n      .label( { classes: ['tick-labels'] } )\n\n    node.group( { classes: ['label'] } )\n      .array( { channels: 3, live: false } )\n      .text( { weight: 'bold' } )\n      .label( { offset: [0, 40, 0] } )\n\n    return node\n  }\n\n}\n\nexport class Grid extends AbstractMBC implements MathBoxComponent {\n\n  dataNodeNames = null\n  renderNodeNames = ['grid']\n  handlers = {\n    ...universalHandlers,\n    axes: Grid.handleAxes,\n    width: Grid.handleWidth,\n    divisions: Grid.handleDivisions,\n    snap: Grid.handleSnap\n  }\n\n  static handleAxes = makeSetProperty('axes')\n  static handleWidth = makeSetProperty('width')\n  static handleDivisions(nodes: HandlerNodes, handledProps: HandledProps) {\n    const divisions = handledProps.divisions\n    validateVector(divisions, 2)\n    nodes.renderNodes.set( {\n      divideX: divisions[0],\n      divideY: divisions[1]\n    } )\n  }\n  static handleSnap(nodes: HandlerNodes, handledProps: HandledProps) {\n    nodes.renderNodes.set( {\n      niceX: handledProps.snap,\n      niceY: handledProps.snap\n    } )\n  }\n\n  mathboxRender = (parent) => {\n    const node = parent.group()\n    node.grid()\n    return node\n  }\n\n}\n\nexport class Point extends AbstractMBC implements MathBoxComponent {\n\n  dataNodeNames = ['array']\n  renderNodeNames = ['point']\n  handlers = {\n    ...universalHandlers,\n    label: makeHandleLabel(0),\n    labelVisible: handleLabelVisible,\n    size: makeSetProperty('size'),\n    coords: Point.handleCoords\n  }\n\n  static handleCoords(nodes: HandlerNodes, handledProps: HandledProps) {\n    const coords = handledProps.coords\n    const data = (coords instanceof Array) && (coords[0] instanceof Number)\n      ? [coords]\n      : coords\n    nodes.dataNodes.set('data', data)\n  }\n\n  mathboxRender = (parent) => {\n    const node = parent.group( { classes: ['point'] } )\n    node.array( { items: 1, channels: 3 } )\n      .point()\n      .format( { classes: ['label'], weight: 'bold' } )\n      .label( { classes: ['label'], offset: [0, 40, 0] } )\n\n    return node\n  }\n\n}\n\nexport class Line extends AbstractMBC implements MathBoxComponent {\n\n  dataNodeNames = ['array']\n  renderNodeNames = ['line']\n  handlers = {\n    ...universalHandlers,\n    ...lineLikeHandlers,\n    label: makeHandleLabel(1),\n    labelVisible: handleLabelVisible,\n    coords: Line.handleCoords\n  }\n\n  static handleCoords(nodes: HandlerNodes, handledProps: any) {\n    nodes.dataNodes.set('data', handledProps.coords)\n  }\n\n  mathboxRender = (parent) => {\n    const node = parent.group( { classes: ['line'] } )\n    node.array( { items: 1, channels: 3 } )\n      .line()\n      .format( { classes: ['label'], weight: 'bold' } )\n      .label( { classes: ['label'], offset: [0, 40, 0] } )\n\n    return node\n  }\n\n}\n\nexport class Vector extends AbstractMBC implements MathBoxComponent {\n\n  dataNodeNames = ['array']\n  renderNodeNames = ['line']\n  handlers = {\n    ...universalHandlers,\n    ...lineLikeHandlers,\n    label: makeHandleLabel(1),\n    labelVisible: handleLabelVisible,\n    components: Vector.handleComponents,\n    tail: Vector.handleTail\n  }\n\n  static handleTail(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { tail, components } = handledProps\n    validateVector(tail, 3) // throws error if tail invalid\n\n    // If head is valid, finish updating. If head is not valid:\n    //    1. don't update, but...\n    //    2. do not throw error. it's not the tail's fault!\n    if (isVector(components, 3)) {\n      Vector.updateData(nodes, handledProps)\n    }\n  }\n\n  static handleComponents(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { tail, components } = handledProps\n    validateVector(components, 3)\n    if (isVector(tail, 3)) {\n      Vector.updateData(nodes, handledProps)\n    }\n  }\n\n  static updateData(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { tail, components } = handledProps\n    const head = math.add(tail, components)\n    nodes.dataNodes.set('data', [tail, head] )\n  }\n\n  mathboxRender = (parent) => {\n    const node = parent.group( { classes: ['vector'] } )\n    node.array( { items: 1, channels: 3 } )\n      .line()\n      .format( { classes: ['label'], weight: 'bold' } )\n      .label( { classes: ['label'], offset: [0, 40, 0] } )\n\n    return node\n  }\n\n}\n\nexport class ParametricCurve extends AbstractMBC implements MathBoxComponent {\n\n  dataNodeNames = ['interval']\n  renderNodeNames = ['line']\n  handlers = {\n    ...universalHandlers,\n    ...lineLikeHandlers,\n    range: ParametricCurve.handleRange,\n    expr: ParametricCurve.handleExpr,\n    samples: ParametricCurve.handleSamples\n  }\n\n  static handleRange(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { range } = handledProps\n    validateVector(range, 2)\n    const cartesian = nodes.groupNode.select('cartesian')\n    cartesian.set('range', [range, [0, 1]] )\n\n    ParametricCurve.forceUpdate(nodes, handledProps)\n  }\n\n  static handleExpr(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { expr } = handledProps\n    validateFunctionSignature(expr, 1, 3)\n    nodes.dataNodes.set('expr', (emit, t) => {\n      return emit(...expr(t))\n    } )\n  }\n\n  static handleSamples(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { samples } = handledProps\n    validateReal(samples)\n    nodes.dataNodes.set('width', samples)\n  }\n\n  // This method is a hacky way to force the interval data primitive to update.\n  static forceUpdate(nodes: HandlerNodes, handledProps: HandledProps) {\n    try {\n      ParametricCurve.handleExpr(nodes, handledProps)\n    }\n    catch (err) {\n      // don't do anything with the error; it should have been caught when\n      // handleExpr was called directly.\n    }\n  }\n\n  mathboxRender = (parent) => {\n    // NOTE: Updating an <interval>'s range does not work. However, it does work\n    // to make interval a child of its own <cartesian>, inherit range from\n    // \\cartesian, and update <cartesian>'s range. See\n    // https://groups.google.com/forum/?fromgroups#!topic/mathbox/zLX6WJjTDZk\n\n    const group = parent.group()\n    const data = group.cartesian().interval( {\n      channels: 3,\n      axis: 1,\n      live: false\n    } )\n\n    group.line( {\n      points: data\n    } )\n\n    return group\n  }\n\n}\n\ntype SurfaceRange = [number, number] | (number) => [number, number]\ntype TrueParamsFunc = (unitU: number, unitV: number) => [number, number]\ntype ParametricSurfaceFunc = (number, number) => [number, number, number]\n\nexport class ParametricSurface extends AbstractMBC implements MathBoxComponent {\n\n  dataNodeNames = ['area.data']\n  renderNodeNames = ['surface']\n  handlers: Handlers\n\n  constructor(props: Props) {\n    super(props)\n\n    this.handlers = {\n      ...universalHandlers,\n      ...surfaceHandlers,\n      zOrder: ParametricSurface.handleZOrder,\n      color: this.handleColor,\n      colorExpr: this.handleColorExpr,\n      expr: this.handleExpr,\n      rangeU: this.handleRange,\n      rangeV: this.handleRange,\n      uSamples: ParametricSurface.handleUSamples,\n      vSamples: ParametricSurface.handleVSamples,\n      // gridColor\n      gridWidth: ParametricSurface.handleGridWidth,\n      gridOpacity: ParametricSurface.handleGridOpacity,\n      gridU: ParametricSurface.handleGridU,\n      gridV: ParametricSurface.handleGridV\n    }\n  }\n\n  static handleZOrder(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { zOrder } = handledProps\n    const { groupNode } = nodes\n    groupNode.select('surface').set( { zOrder } )\n    // Make sure to draw gridlines after the surface\n    groupNode.select('line').set( { zOrder: zOrder + 0.001 } )\n  }\n\n  static handleGridOpacity(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { gridOpacity } = handledProps\n    const { groupNode } = nodes\n    validateReal(gridOpacity)\n    groupNode.select('line').set('opacity', gridOpacity)\n  }\n\n  static handleGridWidth(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { gridWidth } = handledProps\n    const { groupNode } = nodes\n    validateReal(gridWidth)\n    groupNode.select('line').set('width', gridWidth)\n  }\n\n  static handleGridU(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { gridU } = handledProps\n    validateReal(gridU)\n    nodes.groupNode.select('.gridU resample').set('width', gridU)\n  }\n  static handleGridV(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { gridV } = handledProps\n    validateReal(gridV)\n    nodes.groupNode.select('.gridV resample').set('height', gridV)\n  }\n\n  static handleUSamples(nodes: HandlerNodes, handledProps: HandledProps, handlers: Handlers) {\n    const { groupNode } = nodes\n    const { uSamples } = handledProps\n    validateReal(uSamples)\n    const area = groupNode.select('area')\n    const colorsNode = groupNode.select('.colors')\n    if (area.get('width') === null) {\n      area.set('width', uSamples)\n      colorsNode.set('width', uSamples)\n    }\n    else {\n      ParametricSurface.rerender(nodes, handledProps, handlers)\n    }\n  }\n\n  static handleVSamples(nodes: HandlerNodes, handledProps: HandledProps, handlers: Handlers) {\n    const { groupNode } = nodes\n    const { vSamples } = handledProps\n    validateReal(vSamples)\n    const area = groupNode.select('area')\n    const colorsNode = groupNode.select('.colors')\n    if (area.get('height') === null) {\n      area.set('height', vSamples)\n      colorsNode.set('height', vSamples)\n    }\n    else {\n      ParametricSurface.rerender(nodes, handledProps, handlers)\n    }\n  }\n\n  handleColor = (nodes: HandlerNodes, handledProps: HandledProps) => {\n    const { color } = handledProps\n    const { groupNode } = nodes\n    const lines = groupNode.select('line')\n    const colorsNode = groupNode.select('.colors')\n    // delegate to colorMap\n    if (colorMaps.hasOwnProperty(color)) {\n      this.handleColorExpr(nodes, handledProps)\n      lines.set('color', 'gray')\n      return\n    }\n\n    const colorExpr = (emit) => {\n      const { r, g, b } = new THREE.Color(color)\n      emit(r, g, b, 1.0)\n    }\n\n    colorsNode.set('expr', colorExpr)\n\n    const lineColor = lighten(color, -0.75)\n    lines.set('color', lineColor)\n  }\n\n  static updateColorExpr(\n    nodes: HandlerNodes,\n    handledProps: HandledProps,\n    trueParamsFunc: TrueParamsFunc,\n    transformedExpr: ParametricSurfaceFunc) {\n    // These should already have been validated\n    const { color, colorExpr, uSamples, vSamples } = handledProps\n\n    const { root, groupNode } = nodes\n    const colorsArea = groupNode.select('.colors')\n    const cartesian = root.select('cartesian')[0]\n\n    const { func: valueToColor } = colorMaps[color]\n\n    const [\n      [xMin, xMax],\n      [yMin, yMax],\n      [zMin, zMax]\n    ] = Axis.copyCartesianRange(cartesian)\n\n    const rgbaEmitter = (emit, u: number, v: number) => {\n      const [trueU, trueV] = trueParamsFunc(u, v)\n      const [x, y, z] = transformedExpr(trueU, trueV)\n      const X = scaleToUnit(x, xMin, xMax)\n      const Y = scaleToUnit(y, yMin, yMax)\n      const Z = scaleToUnit(z, zMin, zMax)\n      const frac = colorExpr(X, Y, Z, trueU, trueV)\n      emit(...valueToColor(frac))\n    }\n\n    colorsArea.set( {\n      expr: rgbaEmitter,\n      width: uSamples,\n      height: vSamples\n    } )\n\n  }\n\n  canUpdateColorExpr = (handledProps: HandledProps) => {\n    const { colorExpr, color, expr, uSamples, vSamples, rangeU, rangeV } = handledProps\n    if (!hasFunctionSignature(colorExpr, 5, 1)) { return false }\n    if (!colorMaps[color] ) { return false }\n    if (!isReal(uSamples) || !isReal(vSamples)) { return false }\n    if (!this.constructor.isExprValid(expr)) { return false }\n    if (!ParametricSurface.isRangeValid(rangeU, rangeV)) { return false }\n    return true\n  }\n\n  handleColorExpr = (nodes: HandlerNodes, handledProps: HandledProps) => {\n    const { colorExpr, expr, rangeU, rangeV } = handledProps\n    validateFunctionSignature(colorExpr, 5, 1)\n    if (!this.canUpdateColorExpr(handledProps)) { return }\n\n    const trueParamsFunc = ParametricSurface.getTrueParamsFunc(rangeU, rangeV)\n    const transformedExpr = this.constructor.transformExpr(expr)\n    ParametricSurface.updateColorExpr(nodes, handledProps, trueParamsFunc, transformedExpr)\n\n  }\n\n  // The next two handlers all perform validation, then delegate to updateExpr\n  // Handlers are structured this way because range properties can be functions.\n  handleRange = (nodes: HandlerNodes, handledProps: HandledProps) => {\n    const { rangeU, rangeV, expr } = handledProps\n    const { dataNodes: area } = nodes\n\n    const isExprValid = this.constructor.isExprValid(expr)\n    const isRangeValid = ParametricSurface.isRangeValid(rangeU, rangeV)\n\n    if (!isRangeValid) {\n      if (typeof rangeU === 'function' && typeof rangeV === 'function') {\n        throw new Error('Either the u-range can depend on v, OR the v-range can dependent on u, but NOT both.')\n      }\n      else {\n        throw new Error(`Parameter ranges must be 2-component arrays.`)\n      }\n    }\n    if (!isExprValid) { return }\n\n    const trueParamsFunc = ParametricSurface.getTrueParamsFunc(rangeU, rangeV)\n    const transformedExpr = this.constructor.transformExpr(expr)\n    ParametricSurface.updateExpr(area, trueParamsFunc, transformedExpr)\n\n    if (!this.canUpdateColorExpr(handledProps)) { return }\n    ParametricSurface.updateColorExpr(nodes, handledProps, trueParamsFunc, transformedExpr)\n\n    // If handleRange finishes, then both rangeU and rangeV are valid.\n    // (i.e., have null error)\n    // We announce this manually because range validation is correlated:\n    // updating rangeU can validate a previously invalid rangeV value\n    return { rangeU: null, rangeV: null }\n  }\n\n  static isRangeValid(rangeU: mixed, rangeV: mixed) {\n    if (isVector(rangeU, 2) && isVector(rangeV, 2)) {\n      return true\n    }\n    else if (hasFunctionSignature(rangeU, 1, 2) && isVector(rangeV, 2)) {\n      return true\n    }\n    else if (isVector(rangeU, 2) && hasFunctionSignature(rangeV, 1, 2)) {\n      return true\n    }\n    else {\n      return false\n    }\n  }\n\n  // Inheriting classes override the next three method to transform scalar\n  // functions in rectangular and polar coordinates into parametric surfaces\n  static isExprValid(expr: mixed) {\n    return hasFunctionSignature(expr, 2, 3)\n  }\n  static validateExpr(expr: mixed) {\n    validateFunctionSignature(expr, 2, 3)\n  }\n  static transformExpr(expr: mixed): (number, number) => [number, number, number] {\n    // $FlowFixMe previous line will throw if invalid type\n    return expr\n  }\n\n  handleExpr = (nodes: HandlerNodes, handledProps: HandledProps) => {\n    const { expr, rangeU, rangeV } = handledProps\n    this.constructor.validateExpr(expr)\n    const { dataNodes: area } = nodes\n\n    const isRangeValid = ParametricSurface.isRangeValid(rangeU, rangeV)\n\n    // Already know expr is valid\n    if (!isRangeValid) { return }\n\n    const trueParamsFunc = ParametricSurface.getTrueParamsFunc(rangeU, rangeV)\n    const transformedExpr = this.constructor.transformExpr(expr)\n    ParametricSurface.updateExpr(area, trueParamsFunc, transformedExpr)\n    if (!this.canUpdateColorExpr(handledProps)) { return }\n    ParametricSurface.updateColorExpr(nodes, handledProps, trueParamsFunc, transformedExpr)\n\n  }\n\n  static getTrueParamsFunc(rangeU: SurfaceRange, rangeV: SurfaceRange): TrueParamsFunc {\n    if (Array.isArray(rangeU) && Array.isArray(rangeV)) {\n      return (u: number, v: number) => {\n        const du = rangeU\n        const dv = rangeV\n        const trueU = du[0] + u*(du[1] - du[0] )\n        const trueV = dv[0] + v*(dv[1] - dv[0] )\n        return [trueU, trueV]\n      }\n    }\n    else if (Array.isArray(rangeU) && typeof rangeV === 'function') {\n      return (u: number, v: number) => {\n        const du = rangeU\n        const trueU = du[0] + u*(du[1] - du[0] )\n        // $FlowFixMe\n        const dv = rangeV(trueU)\n        const trueV = dv[0] + v*(dv[1] - dv[0] )\n        return [trueU, trueV]\n      }\n    }\n    else if (Array.isArray(rangeV) && typeof rangeU === 'function') {\n      return (u: number, v: number) => {\n        const dv = rangeV\n        const trueV = dv[0] + v*(dv[1] - dv[0] )\n        // $FlowFixMe\n        const du = rangeU(trueV)\n        const trueU = du[0] + u*(du[1] - du[0] )\n        return [trueU, trueV]\n      }\n    }\n    else {\n      throw new Error(`Expected rangeV and rangeU to be (1) array, array (2)\n                       array, function, or (3) function, array. Instead, found\n                       ${typeof rangeU} and ${typeof rangeV}`)\n    }\n\n  }\n\n  // assumes rangeU, rangeV, expr all validated\n  // expr type is mixed because it's different for inheriting classes\n  static updateExpr(\n    area: MathBoxNode,\n    trueParmasFunc: TrueParamsFunc,\n    transformedExpr: (number, number) => [number, number, number]\n  ) {\n    area.set('expr', (emit, u, v) => {\n      const [trueU, trueV] = trueParmasFunc(u, v)\n      const [x, y, z] = transformedExpr(trueU, trueV)\n      emit(x, y, z)\n    } )\n\n  }\n\n  mathboxRender = (parent) => {\n\n    const group = parent.group()\n\n    return ParametricSurface.renderParametricSurface(group)\n  }\n\n  static renderParametricSurface(group: MathBoxNode) {\n    const data = group.area( {\n      classes: ['data'],\n      channels: 3,\n      axes: [1, 2],\n      live: false,\n      rangeX: [0, 1],\n      rangeY: [0, 1]\n    } )\n\n    const colors = group.area( {\n      classes: ['colors'],\n      channels: 4,\n      items: 1,\n      axes: [1, 2],\n      live: false,\n      rangeX: [0, 1],\n      rangeY: [0, 1],\n      width: 2,\n      height: 2\n    } )\n\n    group\n      .surface( {\n        points: data,\n        colors: colors,\n        color: '#FFFFFF'\n      } )\n      .group( { classes: ['gridV'] } )\n      .resample( { source: data } )\n      .line( { zBias: 5 } )\n      .end()\n      .group( { classes: 'gridU' } )\n      .resample( { source: data } )\n      .transpose( { order: 'yx' } )\n      .line( { zBias: 5 } )\n      .end()\n\n    return group\n  }\n\n  static rerender(nodes: HandlerNodes, handledProps: HandledProps, handlers: Handlers) {\n    const { groupNode, root } = nodes\n    groupNode.select('area, surface, .gridU, .gridV').remove()\n    ParametricSurface.renderParametricSurface(groupNode)\n    const newNodes = {\n      groupNode,\n      root,\n      dataNodes: groupNode.select('area.data'),\n      renderNodes: groupNode.select('surface')\n    }\n    Object.keys(handlers).forEach(key => {\n      handlers[key](newNodes, handledProps, handlers)\n    } )\n  }\n\n}\n\nexport class ExplicitSurface extends ParametricSurface implements MathBoxComponent {\n\n  static isExprValid(expr: mixed) {\n    return hasFunctionSignature(expr, 2, 1)\n  }\n  static validateExpr(expr: mixed) {\n    validateFunctionSignature(expr, 2, 1)\n  }\n  static transformExpr(expr: mixed): (number, number) => [number, number, number] {\n    // $FlowFixMe previous line will throw if invalid type\n    return (u, v) => [u, v, expr(u, v)]\n  }\n\n}\n\nexport class ExplicitSurfacePolar extends ParametricSurface implements MathBoxComponent {\n\n  static isExprValid(expr: mixed) {\n    return hasFunctionSignature(expr, 2, 1)\n  }\n  static validateExpr(expr: mixed) {\n    validateFunctionSignature(expr, 2, 1)\n  }\n  static transformExpr(expr: mixed): (number, number) => [number, number, number] {\n    // $FlowFixMe previous line will throw if invalid type\n    return (u, v) => [u*Math.cos(v), u*Math.sin(v), expr(u, v)]\n  }\n\n}\n\nexport class ImplicitSurface extends AbstractMBC implements MathBoxComponent {\n\n  dataNodeNames = ['array']\n  renderNodeNames = ['strip']\n  handlers = {\n    ...universalHandlers,\n    shaded: makeSetProperty('shaded'),\n    lhs: ImplicitSurface.handleLHS,\n    rhs: ImplicitSurface.handleRHS,\n    rangeX: ImplicitSurface.makeHandleRange('rangeX'),\n    rangeY: ImplicitSurface.makeHandleRange('rangeY'),\n    rangeZ: ImplicitSurface.makeHandleRange('rangeZ'),\n    samples: ImplicitSurface.handleSamples\n  }\n\n  // The next several handlers all validate, then delgate to updateData\n  static handleLHS(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { lhs } = handledProps\n    validateFunctionSignature(lhs, 3, 1)\n    ImplicitSurface.updateData(nodes, handledProps)\n  }\n\n  static handleRHS(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { rhs } = handledProps\n    validateFunctionSignature(rhs, 3, 1)\n    ImplicitSurface.updateData(nodes, handledProps)\n  }\n\n  static makeHandleRange(rangeName: 'rangeX' | 'rangeY' | 'rangeZ') {\n    return (nodes: HandlerNodes, handledProps: HandledProps) => {\n      const range = handledProps[rangeName]\n      validateVector(range, 2)\n      ImplicitSurface.updateData(nodes, handledProps)\n    }\n  }\n\n  static handleSamples(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { samples } = handledProps\n    validateReal(samples)\n    ImplicitSurface.updateData(nodes, handledProps)\n  }\n\n  static canUpdate(handledProps: HandledProps) {\n    const { lhs, rhs, rangeX, rangeY, rangeZ, samples } = handledProps\n    return (\n      isVector(rangeX, 2) &&\n      isVector(rangeY, 2) &&\n      isVector(rangeZ, 2) &&\n      hasFunctionSignature(lhs, 3, 1) &&\n      hasFunctionSignature(rhs, 3, 1) &&\n      isReal(samples)\n    )\n  }\n\n  static updateData(nodes: HandlerNodes, handledProps: HandledProps) {\n    if (!ImplicitSurface.canUpdate(handledProps)) {\n      return\n    }\n    const { lhs, rhs, rangeX, rangeY, rangeZ, samples } = handledProps\n    const { dataNodes } = nodes\n\n    const implicitFunc = (x, y, z) => lhs(x, y, z) - rhs(x, y, z)\n    const implicitTriangles = marchingCubes(\n      rangeX[0], rangeX[1],\n      rangeY[0], rangeY[1],\n      rangeZ[0], rangeZ[1],\n      implicitFunc, 0, samples)\n\n    // \"samples\" really determines the field discretization length\n    // true number of samples depends on discretization length and implicitFunc\n    const trueSamplesNum = implicitTriangles.length\n    // Sample cap of 5400 was found experimentally; I do not really understand\n    // what goes wrong when too many samples are generated.\n    if (trueSamplesNum > 5400) {\n      throw new Error('Too many data points generated. Please decrease sample size.')\n    }\n\n    dataNodes.set( {\n      data: implicitTriangles,\n      width: trueSamplesNum\n    } )\n  }\n\n  mathboxRender = (parent) => {\n\n    // @jason put all of the implicit-surface related MathBox code inside a\n    // group. This function MUST return the group.\n    const group = parent.group()\n\n    // Array stores a list of the points of the triangles\n    // Use strip to render them\n    group.array( {\n      channels: 3,\n      items: 3,\n      width: 0,\n      live: false\n    } ).strip()\n\n    return group\n  }\n\n}\n\nexport class VectorField extends AbstractMBC implements MathBoxComponent {\n\n  dataNodeNames = ['volume']\n  renderNodeNames = ['vector']\n  handlers = {\n    ...universalHandlers,\n    ...lineLikeHandlers,\n    rangeX: VectorField.makeHandleRange('rangeX'),\n    rangeY: VectorField.makeHandleRange('rangeY'),\n    rangeZ: VectorField.makeHandleRange('rangeZ'),\n    samples: VectorField.handleSamples,\n    scale: VectorField.handleScale,\n    expr: VectorField.handleExpr\n  }\n\n  // handleExpr and makeHandleRange both delegate to updateRangeAndExpression.\n  // handlers are structured this way because updating the range properties of\n  // a volume node seems not to have any effect. Area nodes suffer a similar\n  // bug, see discussion at\n  // https://groups.google.com/forum/?fromgroups#!topic/mathbox/zLX6WJjTDZk\n  // for an alternative approach.\n  static makeHandleRange(rangeName: 'rangeX' | 'rangeY' | 'rangeZ') {\n    return (nodes: HandlerNodes, handledProps: HandledProps) => {\n      validateVector(handledProps[rangeName], 2)\n      VectorField.updateRangeAndExpr(nodes, handledProps)\n    }\n  }\n\n  static handleExpr(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { expr } = handledProps\n    validateFunctionSignature(expr, 3, 3)\n    VectorField.updateRangeAndExpr(nodes, handledProps)\n  }\n\n  static handleScale(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { scale } = handledProps\n    isReal(scale)\n    VectorField.updateRangeAndExpr(nodes, handledProps)\n  }\n\n  static canUpdateRangeAndExpr(rangeX: mixed, rangeY: mixed, rangeZ: mixed, expr: mixed, samples: mixed, scale: mixed) {\n    return (\n      isVector(rangeX, 2) &&\n      isVector(rangeY, 2) &&\n      isVector(rangeZ, 2) &&\n      isVector(samples, 3) &&\n      isReal(scale) &&\n      hasFunctionSignature(expr, 3, 3)\n    )\n  }\n\n  static updateRangeAndExpr(nodes: HandlerNodes, handledProps: HandledProps) {\n    const { rangeX, rangeY, rangeZ, expr, samples, scale } = handledProps\n    const { dataNodes: volume } = nodes\n    if (!VectorField.canUpdateRangeAndExpr(rangeX, rangeY, rangeZ, expr, samples, scale)) {\n      return\n    }\n\n    volume.set('expr', (emit, scaledX, scaledY, scaledZ) => {\n      const percentX = samples[0] === 1 ? 0.5 : scaledX\n      const percentY = samples[1] === 1 ? 0.5 : scaledY\n      const percentZ = samples[2] === 1 ? 0.5 : scaledZ\n\n      const x = rangeX[0] + percentX * (rangeX[1] - rangeX[0] )\n      const y = rangeY[0] + percentY * (rangeY[1] - rangeY[0] )\n      const z = rangeZ[0] + percentZ * (rangeZ[1] - rangeZ[0] )\n      emit(x, y, z)\n      const [vx, vy, vz] = expr(x, y, z)\n      emit(x + scale*vx, y + scale*vy, z + scale*vz)\n    } )\n  }\n\n  mathboxRender = (parent) => {\n    const group = parent.group( { classes: ['vector-field'] } )\n\n    return VectorField.renderVectorField(group)\n  }\n\n  static renderVectorField(group: MathBoxNode) {\n    group.volume( {\n      items: 2,\n      channels: 3,\n      rangeX: [0, 1],\n      rangeY: [0, 1],\n      rangeZ: [0, 1]\n    } ).vector()\n\n    return group\n  }\n\n  static rerender(nodes: HandlerNodes, handledProps: HandledProps, handlers: Handlers) {\n    const { groupNode, root } = nodes\n    groupNode.select('volume, vector').remove()\n    VectorField.renderVectorField(groupNode)\n    const newNodes = {\n      groupNode,\n      root,\n      dataNodes: groupNode.select('volume'),\n      renderNodes: groupNode.select('vector')\n    }\n    Object.keys(handlers).forEach(key => {\n\n      handlers[key](newNodes, handledProps, handlers)\n    } )\n  }\n\n  static handleSamples(nodes: HandlerNodes, handledProps: HandledProps, handlers: Handlers) {\n    const { dataNodes } = nodes\n    const { samples } = handledProps\n    validateVector(samples, 3)\n    const volume = dataNodes\n    if (volume.get('width') === null) {\n      dataNodes.set( {\n        width: samples[0],\n        height: samples[1],\n        depth: samples[2]\n      } )\n    }\n    else {\n      VectorField.rerender(nodes, handledProps, handlers)\n    }\n  }\n\n}\n","// @flow\n\nexport function capitalize(string: string) {\n  return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase()\n}\n\nexport function escapeRegExp(str: string) {\n  // from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions#Using_Special_Characters\n  // $& means the whole matched string\n  return str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')\n}\n\nexport function replaceAll(str: string, find: string, replaceWith: string) {\n  // from https://stackoverflow.com/a/1144788/2747370\n  return str.replace(new RegExp(escapeRegExp(find), 'g'), replaceWith)\n}\n\nexport function findClosingBrace(str: string, startIdx: number) {\n  const braces = {\n    '[': ']',\n    '<': '>',\n    '(': ')',\n    '{': '}'\n  }\n\n  const openingBrace = str[startIdx]\n\n  const closingBrace = braces[openingBrace]\n\n  if (closingBrace === undefined) {\n    throw Error(`${str} does not contain an opening brace at position ${startIdx}.`)\n  }\n\n  let stack = 1\n\n  // eslint-disable-next-line no-plusplus\n  for (let j = startIdx + 1; j < str.length; j++) {\n    if (str[j] === openingBrace) {\n      stack += +1\n    }\n    else if (str[j] === closingBrace) {\n      stack += -1\n    }\n    if (stack === 0) {\n      return j\n    }\n  }\n\n  // stack !== 0\n  throw Error(`${str} has a brace that opens at position ${startIdx} but does not close.`)\n}\n","// @flow\nimport type { MetaData } from './types'\nimport { capitalize } from 'utils/helpers'\nimport type { MathObjectWrapper, Settings, Support } from '../MathObject'\n\n/**\n * Contains metadata about MathGraphic and coerces it into a form consumable\n * by other sources\n */\nexport default class MathGraphic implements MathObjectWrapper {\n\n  type: string\n  defaultSettings: Settings\n  uiComponent: Function\n  mathboxComponent: Function\n  computedProps: Array<string>\n  support: Support\n  reducer = 'mathGraphics'\n\n  constructor( { type, description, metadata, uiComponent, mathboxComponent, support = 'full' }: {\n    type: string,\n    description?: string,\n    metadata: MetaData,\n    uiComponent: Function,\n    mathboxComponent: Function,\n    support?: Support\n  } ) {\n    this.type = type\n    this.support = support\n    this.uiComponent = uiComponent\n    this.mathboxComponent = mathboxComponent\n    this.defaultSettings = MathGraphic.getDefaultSettings(type, metadata, description)\n    this.computedProps = Object.keys(metadata)\n      .filter(key => metadata[key].inputType === 'math')\n  }\n\n  static getDefaultSettings(type: string, metadata: MetaData, description: ?string) {\n    const initial = {\n      type,\n      description: description || capitalize(type),\n      useCalculatedVisibility: false\n    }\n    return Object.keys(metadata).reduce((acc, property) => {\n      acc[property] = metadata[property].defaultValue\n      return acc\n    }, initial)\n  }\n\n}\n","// @flow\ntype GetTextWidth = {\n  (text: string, font: string): number,\n  canvas?: HTMLCanvasElement\n}\n\nexport const getTextWidth: GetTextWidth = function getTextWidth(text, font) {\n  // from https://stackoverflow.com/a/21015393/2747370\n  // re-use canvas object for better performance\n  const canvas = getTextWidth.canvas || (getTextWidth.canvas = document.createElement('canvas'))\n  const context = canvas.getContext('2d')\n  context.font = font\n  const metrics = context.measureText(text)\n  const roundedWidth = Math.floor(metrics.width) + 1\n  return roundedWidth\n}\n\nwindow.getTextWidth = getTextWidth\n","// @flow\nimport * as React from 'react'\nimport styled from 'styled-components'\n// ant design also has an autosizing textarea, but I found it too hard to resize\nimport Textarea from 'react-textarea-autosize'\nimport { getTextWidth } from './getTextWidth'\n\n// NOTE: using maxwidth below instead of maxWidth because TextArea seems to\n//  pass all of its props on textarea, which does does not recognize, hence\n//  React throws a warning\n\nconst StyledTextarea = styled(Textarea)`\n  width: ${props => props.width};\n  max-width: ${props => props.maxwidth ? `${props.maxwidth}px` : '100%'};\n  min-height:24px;\n  resize: none;\n  border-top:none;\n  border-left: none;\n  border-right:none;\n  border-radius: 0px;\n  padding-bottom: 1px; /*MO border was appearing too small. This fixed it. I do not understand ... */\n  padding-top: 0px;\n  padding-right:2px;\n  padding-left:2px;\n  border-bottom: 1px solid ${props => props.theme.gray[5]};\n  color: ${props => props.theme.gray[6]};\n  &:focus {\n    outline: none;\n    border-bottom: 2px solid ${props => props.theme.primary[4]};\n  };\n  overflow:hidden;\n`\n\ntype Props = {\n  value: string,\n  onChange: (text: string) => void,\n  style?: Object,\n  className?: Array<string>,\n  maxwidth?: number\n}\ntype State = {\n  width: string\n}\n\nexport default class EditableDescription extends React.PureComponent<Props, State> {\n\n  getWidthFromText(text: string) {\n    const font = '14px sans-serif'\n    const paddedText = text + ' '\n    const textWidth = getTextWidth(paddedText, font)\n    const paddingWidth = 4\n    // Hack: Give a bit of extra width...\n    // Phones/Table text width detection was not working.\n    // Maybe a font issue?\n    const factor = 1.1\n    const extra = 5\n    return `${factor*textWidth + extra + paddingWidth}px`\n  }\n\n  onChange = (event: SyntheticMouseEvent<HTMLTextAreaElement>) => {\n    const text: string = event.currentTarget.value\n    this.props.onChange(text)\n  }\n\n  render() {\n    const width = this.getWidthFromText(this.props.value)\n    return (\n      <StyledTextarea\n        rows={1}\n        width={width}\n        maxwidth={this.props.maxwidth}\n        value={this.props.value}\n        onChange={this.onChange}\n        style={this.props.style}\n        className={this.props.className}\n      />\n    )\n  }\n\n}\n","import React from 'react'\nimport styled from 'styled-components'\nimport SubtleButton from 'components/SubtleButton'\nimport { Icon } from 'antd'\n\nconst StyledDeleteButton = styled(SubtleButton)`\n  padding:0px;\n  margin-right: -3px;\n  margin-top: -6px;\n  min-width:25px;\n  max-width:25px;\n  height:25px;\n  position:absolute;\n  right:0;\n  top:0;\n  display:flex;\n  justify-content: center;\n  align-items: center;\n  font-size:133%;\n  color: ${props => props.theme.gray[5]};\n`\n\nexport default function DeleteButton(props) {\n  return (\n    <StyledDeleteButton {...props}>\n      <Icon\n        type='close'\n      />\n    </StyledDeleteButton>\n  )\n}\n","// @flow\n\nexport const theme = {\n  borderRadius: '4px',\n  transitionDuration: '300ms',\n  transitionDurationMS: 300,\n  transitionTimingFunction: 'cubic-bezier(0.645, 0.045, 0.355, 1);',\n  // From ant design\n  gray: [\n    '#ffffff',\n    '#fafafa',\n    '#f5f5f5',\n    '#e8e8e8',\n    '#d9d9d9',\n    '#bfbfbf',\n    '#8c8c8c',\n    '#595959',\n    '#262626',\n    '#000000'\n  ],\n  // from ant design, daybreak blue\n  primary: [\n    '#e6f7ff',\n    '#bae7ff',\n    '#91d5ff',\n    '#69c0ff',\n    '#40a9ff',\n    '#1890ff',\n    '#096dd9',\n    '#0050b3',\n    '#003a8c',\n    '#002766'\n  ]\n}\n\nexport const MOBILE_BREAKPOINT = 480\n\nexport default theme\n","import React, { Fragment, PureComponent, createRef } from 'react'\nimport PropTypes from 'prop-types'\nimport styled, { css } from 'styled-components'\nimport EditableDescription from 'components/EditableDescription'\nimport DeleteButton from './DeleteButton'\nimport { theme } from 'constants/theme'\n\nconst OuterContainer = styled.span`\n  display: inline-flex;\n  vertical-align: top; /*Removes extra space below inline element's baseline*/\n  min-width:100%;\n  max-width: ${props => props.isActive ? 'auto' : '100%'};\n  background-color: white;\n  margin-bottom: -2px;\n  border: 1px solid ${props => props.theme.gray[5]};\n  transition-duration: ${props => props.theme.transitionDuration};\n  transition-timing-function: ${props => props.theme.transitionTimingFunction};\n  transition-property: all;\n  ${props => props.isDeleting && css`\n    transform: scale(0);\n    transform-origin: top left;\n  `};\n  /*\n  Note:\n  - above, margin-bottom: -1px prevents double-thick borders between (Folders\n    are also mathObjects)\n  - But this causes very last MathObject in very last folder to lose its border.\n  - This is taken care of by border on SortableListOfFolders\n   */\n`\n\nconst SIDEPANEL_WIDTH = '40px'\nconst SidePanel = styled.div`\n  margin-bottom:-1px; /*Compensates for margin-bottom:-1px in OuterContainer*/\n  padding-top: 2px;\n  padding-bottom: 2px;\n  width: ${SIDEPANEL_WIDTH};\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  transition-duration: ${props => props.theme.transitionDuration};\n  transition-timing-function: ${props => props.theme.transitionTimingFunction};\n  transition-property: background-color;\n  /* This makes fixed-width */\n  flex-basis: auto;\n  flex-grow: 0;\n  flex-shrink: 0;\n  ${props => props.isActive && css`\n    background-color: ${props => props.theme.primary[1]}\n  `}\n`\nconst AncestryLine = styled.div`\n  width:1px;\n  height:100%;\n  background-color: ${props => props.theme.gray[5]};\n  display:flex;\n  flex-direction:column;\n  justify-content: space-around;\n  align-items: center;\n`\n\nconst MainContainer = styled.div`\n  display:flex;\n  flex-direction:column;\n  width: calc(100% - ${SIDEPANEL_WIDTH});\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 6px;\n  padding-right: 6px;\n  ${props => !props.isActive && css`\n    overflow: hidden;\n  `};\n`\n\nconst HeaderContainer = styled.div`\n  position:relative;\n  max-width:75vw;\n`\n\nexport default class MathObjectUI extends PureComponent {\n\n  static propTypes = {\n    // passed as ownProps\n    id: PropTypes.string.isRequired,\n    // TODO: is type necessary?\n    // Lots of things use the type value in redux store.\n    // Not sure anything actually uses the type prop\n    type: PropTypes.string.isRequired,\n    isFolder: PropTypes.bool.isRequired,\n    sidePanelContent: PropTypes.node,\n    children: PropTypes.oneOfType( [\n      PropTypes.arrayOf(PropTypes.node),\n      PropTypes.node\n    ] ).isRequired,\n    // passed by mapStateToProps / mapDispatchToProps\n    isActive: PropTypes.bool.isRequired,\n    description: PropTypes.string.isRequired,\n    parentId: PropTypes.string.isRequired,\n    positionInParent: PropTypes.number.isRequired,\n    isDeleteable: PropTypes.bool.isRequired,\n    setActiveObject: PropTypes.func.isRequired,\n    setProperty: PropTypes.func.isRequired,\n    deleteMathObject: PropTypes.func.isRequired\n  }\n\n  static defaultProps = {\n    isFolder: false,\n    showAncestry: true,\n    sidePanelContent: null\n  }\n\n  state = {\n    isDeleting: false,\n    parentMaxWidth: null\n  }\n\n  constructor(props) {\n    super(props)\n    this.setProperty = this.setProperty.bind(this)\n    this.onEditDescription = this.onEditDescription.bind(this)\n    this.containerRef = createRef()\n  }\n\n  componentDidMount() {\n    this.setState( { parentMaxWidth: this.getParentMaxWidth() } )\n  }\n\n  getParentMaxWidth() {\n    // I want the EditableDescription Element's max width to be fixed, not\n    // influenced by MathObject's overflow into the scene.\n    // containerElement's parent element is the most recent ancestor\n    // of EditableDescription that does not grow during overflow\n    const { current: containerElement } = this.containerRef\n    if (containerElement) {\n      const parentWidth = containerElement.parentElement.offsetWidth\n      // subtract 30 for the DeleteButton, 40 for the sidePanel\n      return parentWidth\n    }\n    else {\n      return undefined\n    }\n  }\n\n  setProperty(property, value) {\n    const { id, type } = this.props\n    this.props.setProperty(id, type, property, value)\n  }\n\n  onEditDescription(value) {\n    this.setProperty('description', value)\n  }\n\n  onDelete = () => {\n    const { id, type, parentId, positionInParent } = this.props\n    this.props.setActiveObject(null)\n    this.setState( { isDeleting: true } )\n    setTimeout(\n      () => this.props.deleteMathObject(id, type, parentId, positionInParent),\n      theme.transitionDurationMS\n    )\n\n  }\n\n  onFocus = () => {\n    this.props.setActiveObject(this.props.id)\n  }\n\n  render() {\n\n    const {\n      isActive,\n      sidePanelContent,\n      description,\n      children,\n      isDeleteable,\n      isFolder\n    } = this.props\n\n    return (\n      <Fragment\n      >\n        <OuterContainer\n          ref={this.containerRef}\n          onFocus={this.onFocus}\n          isActive={isActive}\n          isFolder={isFolder}\n          isDeleting={this.state.isDeleting}\n        >\n          <SidePanel isActive={isActive}>\n            {isFolder\n              ? sidePanelContent\n              : <AncestryLine> {sidePanelContent} </AncestryLine>\n            }\n          </SidePanel>\n          <MainContainer isActive={isActive}>\n            <HeaderContainer>\n              <EditableDescription\n                // subtracting 70 for sidepanel and delebutton\n                maxwidth={this.state.parentMaxWidth - 70}\n                value={description}\n                onChange={this.onEditDescription}\n                isFolder={isFolder}\n              />\n              <DeleteButton onClick={this.onDelete} disabled={!isDeleteable} />\n            </HeaderContainer>\n            {!isFolder && children}\n          </MainContainer>\n        </OuterContainer>\n        {isFolder && children}\n      </Fragment>\n    )\n  }\n\n}\n","export const SET_ACTIVE_OBJECT = 'SET_ACTIVE_OBJECT'\n\nexport function setActiveObject(id = null) {\n  return {\n    type: SET_ACTIVE_OBJECT,\n    payload: { id }\n  }\n}\n","/**\n * Given an item and an object of arrays, return keys of arrays containing item\n *\n * @param  {object} objOfArrays  maps keys to arrays\n * @param  {[type]} item anything\n * @return {set} set of strings\n */\nexport function getContainingArrayKeys(objOfArrays, item) {\n  const initial = new Set()\n  return Object.keys(objOfArrays).reduce((acc, key) => {\n    if (objOfArrays[key].includes(item)) {\n      acc.add(key)\n    }\n    return acc\n  }, initial)\n}\n\n/**\n * gets id of node's parent\n *\n * @param  {Object} tree maps node to arrayOfNodes\n * @param  {string} nodeName id of activeObject\n * @return {string} string of folder corresponding to activeObject\n */\nexport function getParent(tree, nodeId) {\n\n  const parentFolders = getContainingArrayKeys(tree, nodeId)\n  // I'm not really sure I need to validate my redux state in this way ...\n  if (parentFolders.size < 1) {\n    throw Error(`${nodeId} does not have parent`)\n  }\n  else if (parentFolders.size > 1) {\n    throw Error(`${nodeId} has multiple parents`)\n  }\n  return Array.from(parentFolders)[0]\n}\n","// @flow\nexport const FOLDER = 'FOLDER'\nexport const defaultSettings = {\n  isCollapsed: false,\n  isDropDisabled: false,\n  isDragDisabled: false, // for the folder, not its items\n  description: 'Folder'\n}\n","import MathObjectUI from './components/MathObjectUI'\nimport { connect } from 'react-redux'\nimport { setActiveObject } from './services/activeObject/actions'\nimport { getParent } from './selectors'\nimport { FOLDER } from './Folder/metadata'\nimport {\n  deleteMathObject,\n  setProperty\n} from './actions'\n\nfunction getMathObjectData(state, id) {\n  const { mathGraphics, mathSymbols, folders } = state\n  let found = 0\n  let value\n  const substates = [mathGraphics, mathSymbols, folders]\n  for (const substate of substates) {\n    if (substate[id] ) {\n      found += 1\n      value = substate[id]\n    }\n  }\n\n  if (found !== 1) {\n    throw Error(`Expected ${id} to be present in exactly 1 of [mathGraphics, mathSymbols, folders] but it was present in ${found}`)\n  }\n  return value\n}\n\nfunction getIsDeletable(ownProps, sortableTree) {\n  const { id, type, isDeleteable } = ownProps\n  return isDeleteable !== undefined\n    ? isDeleteable\n    // otherwise, infer the value\n    : type === FOLDER\n      ? sortableTree[id].length === 0 && sortableTree.root.length !== 1\n      : true\n}\n\nconst mapStateToProps = (state, ownProps) => {\n  const { id } = ownProps\n  const { sortableTree } = state\n  const mathObjectData = getMathObjectData(state, id)\n  const isDeleteable = getIsDeletable(ownProps, sortableTree)\n\n  const parentId = getParent(sortableTree, id)\n\n  return {\n    isActive: state.activeObject === id,\n    parentId,\n    isDeleteable,\n    positionInParent: sortableTree[parentId].indexOf(id),\n    description: mathObjectData.description\n  }\n}\n\nconst mapDispatchToProps = {\n  setActiveObject,\n  deleteMathObject,\n  setProperty\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MathObjectUI)\n","// @flow\nimport type { MetaData } from './types'\n\nfunction genDescription(defaultDescription: string) {\n  return {\n    inputType: 'text',\n    defaultValue: defaultDescription,\n    isPrimary: true\n  }\n}\n\nconst universal: MetaData = {\n  color: {\n    inputType: 'text',\n    defaultValue: '#3090FF',\n    isPrimary: true\n  },\n  visible: {\n    inputType: 'boolean',\n    defaultValue: true,\n    isPrimary: true\n  },\n  opacity: {\n    inputType: 'math',\n    defaultValue: '1'\n  },\n  zIndex: {\n    inputType: 'math',\n    defaultValue: '0',\n    label: 'z-index'\n  },\n  zBias: {\n    inputType: 'math',\n    defaultValue: '0',\n    label: 'z-bias'\n  },\n  calculatedVisibility: {\n    inputType: 'math',\n    defaultValue: '',\n    allowEmpty: true,\n    label: 'calculated visibility'\n  }\n}\n\nconst labeled: MetaData = {\n  label: {\n    inputType: 'text',\n    defaultValue: ''\n  },\n  labelVisible: {\n    inputType: 'boolean',\n    defaultValue: false,\n    label: 'label visible'\n  }\n}\n\n// ---------- Axis ---------- //\nconst axisSpecific: MetaData = {\n  color: {\n    inputType: 'text',\n    defaultValue: '#808080',\n    isPrimary: true\n  },\n  min: {\n    inputType: 'math',\n    defaultValue: '-5',\n    isPrimary: true\n  },\n  max: {\n    inputType: 'math',\n    defaultValue: '+5',\n    isPrimary: true\n  },\n  axis: {\n    inputType: 'text',\n    defaultValue: 'x',\n    isPrimary: true\n  },\n  scale: {\n    inputType: 'math',\n    defaultValue: '1'\n  },\n  labelVisible: {\n    inputType: 'boolean',\n    defaultValue: true,\n    label: 'label visible'\n  },\n  ticksVisible: {\n    inputType: 'boolean',\n    defaultValue: true,\n    label: 'ticks visible'\n  },\n  size: {\n    inputType: 'math',\n    defaultValue: '2'\n  },\n  width: {\n    inputType: 'math',\n    defaultValue: '1'\n  }\n}\n\nexport const axisMeta: MetaData = {\n  ...universal,\n  ...labeled,\n  ...axisSpecific\n}\n\n// ---------- Grid ---------- //\nconst gridSpecific: MetaData = {\n  color: {\n    inputType: 'text',\n    defaultValue: '#808080',\n    isPrimary: true\n  },\n  width: {\n    inputType: 'math',\n    defaultValue: '1/2'\n  },\n  divisions: {\n    inputType: 'math',\n    defaultValue: '\\\\left[10,\\\\ 10\\\\right]'\n  },\n  snap: {\n    inputType: 'boolean',\n    defaultValue: true\n  }\n}\n\nexport const gridMeta: MetaData = {\n  ...universal,\n  ...gridSpecific\n}\n\n// ---------- Point ---------- //\nconst pointSpecific: MetaData = {\n  description: genDescription('Point'),\n  coords: {\n    inputType: 'math',\n    defaultValue: '\\\\left[0,0,0\\\\right]',\n    isPrimary: true\n  },\n  size: {\n    inputType: 'math',\n    defaultValue: '16'\n  }\n}\n\nexport const pointMeta: MetaData = {\n  ...universal,\n  ...labeled,\n  ...pointSpecific\n}\n\n// ---------- Line ---------- //\nconst lineLike: MetaData = {\n  size: {\n    inputType: 'math',\n    defaultValue: '6'\n  },\n  width: {\n    inputType: 'math',\n    defaultValue: '4'\n  },\n  start: {\n    inputType: 'boolean',\n    defaultValue: false\n  },\n  end: {\n    inputType: 'boolean',\n    defaultValue: false\n  }\n}\n\nconst lineSpecific: MetaData = {\n  description: genDescription('Line'),\n  coords: {\n    inputType: 'math',\n    defaultValue: '\\\\left[\\\\left[1,1,1\\\\right], \\\\left[-1,1,-1\\\\right]\\\\right]',\n    isPrimary: true\n  }\n}\n\nexport const lineMeta: MetaData = {\n  ...universal,\n  ...labeled,\n  ...lineLike,\n  ...lineSpecific\n}\n\n// ---------- Vector ---------- //\nconst vectorSpecific: MetaData = {\n  components: {\n    inputType: 'math',\n    defaultValue: '\\\\left[3,2,1\\\\right]',\n    isPrimary: true\n  },\n  tail: {\n    inputType: 'math',\n    defaultValue: '\\\\left[0,0,0\\\\right]'\n  },\n  end: {\n    inputType: 'boolean',\n    defaultValue: true\n  }\n}\n\nexport const vectorMeta: MetaData = {\n  ...universal,\n  ...labeled,\n  ...lineLike,\n  ...vectorSpecific\n}\n\n// ---------- ParametricCurve ---------- //\nconst parametricCurveSpecific: MetaData = {\n  expr: {\n    inputType: 'math',\n    defaultValue: '_f(t)=\\\\left[\\\\cos\\\\left(t\\\\right),\\\\ \\\\sin\\\\left(t\\\\right),\\\\ t\\\\right]',\n    isPrimary: true\n  },\n  range: {\n    inputType: 'math',\n    defaultValue: '\\\\left[-2\\\\pi,\\\\ 2\\\\pi\\\\right]',\n    isPrimary: true\n  },\n  samples: {\n    inputType: 'math',\n    defaultValue: '128'\n  }\n}\n\nexport const parametricCurveMeta: MetaData = {\n  ...universal,\n  ...lineLike,\n  ...parametricCurveSpecific\n}\n\n// ---------- ParametricSurface ---------- //\n\nconst surfaceLike: MetaData = {\n  shaded: {\n    inputType: 'boolean',\n    defaultValue: true\n  },\n  opacity: {\n    inputType: 'math',\n    defaultValue: '0.75'\n  }\n}\n\nfunction makeParametricSamplesAndGrid(labelU: string, labelV: string) {\n  return {\n    uSamples: {\n      inputType: 'math',\n      defaultValue: '64',\n      label: `${labelU} samples`\n    },\n    vSamples: {\n      inputType: 'math',\n      defaultValue: '64',\n      label: `${labelV} samples`\n    },\n    gridU: {\n      inputType: 'math',\n      defaultValue: '8',\n      label: `${labelU} gridlines`\n    },\n    gridV: {\n      inputType: 'math',\n      defaultValue: '8',\n      label: `${labelV} gridlines`\n    }\n  }\n}\n\nconst parametricSurfacaSpecific: MetaData = {\n  expr: {\n    inputType: 'math',\n    defaultValue: '_f(u,v)=\\\\left[v\\\\cdot\\\\cos\\\\left(u\\\\right),v\\\\cdot\\\\sin\\\\left(u\\\\right),v\\\\right]',\n    isPrimary: true\n  },\n  rangeU: {\n    inputType: 'math',\n    defaultValue: '\\\\left[-\\\\pi,\\\\ \\\\pi\\\\right]',\n    isPrimary: true\n  },\n  rangeV: {\n    inputType: 'math',\n    defaultValue: '\\\\left[-3, 3\\\\right]',\n    isPrimary: true\n  },\n  colorExpr: {\n    isPrimary: true,\n    inputType: 'math',\n    defaultValue: '_f(X, Y, Z, u, v)=mod(Z, 1)'\n  },\n  gridOpacity: {\n    inputType: 'math',\n    defaultValue: '0.5'\n  },\n  gridWidth: {\n    inputType: 'math',\n    defaultValue: '2'\n  },\n  ...makeParametricSamplesAndGrid('u', 'v')\n}\n\nexport const parametricSurfacaMeta: MetaData = {\n  ...universal,\n  ...surfaceLike,\n  ...parametricSurfacaSpecific\n}\n\n// ---------- Explicit Surface (Rectangular) ---------- //\n\nexport const explicitSurfaceMeta: MetaData = {\n  ...parametricSurfacaMeta,\n  ...makeParametricSamplesAndGrid('x', 'y'),\n  expr: {\n    inputType: 'math',\n    defaultValue: '_f(x,y)=x^2-y^2',\n    isPrimary: true\n  },\n  rangeU: {\n    inputType: 'math',\n    defaultValue: '\\\\left[-2,\\\\ 2\\\\right]',\n    isPrimary: true\n  },\n  rangeV: {\n    inputType: 'math',\n    defaultValue: '\\\\left[-2,\\\\ 2\\\\right]',\n    isPrimary: true\n  },\n  colorExpr: {\n    isPrimary: true,\n    inputType: 'math',\n    defaultValue: '_f(X, Y, Z, x, y)=mod(Z, 1)'\n  }\n}\n\n// ---------- ExplicitSurface Polar ---------- //\n\nexport const explicitSurfacePolarMeta: MetaData = {\n  ...parametricSurfacaMeta,\n  ...makeParametricSamplesAndGrid('r', '\\u03B8'), // \\u03B8 is lowercase theta\n  expr: {\n    inputType: 'math',\n    defaultValue: '_f(r,\\\\theta)=\\\\frac{1}{4}r^2\\\\cdot\\\\cos\\\\left(3\\\\theta\\\\right)',\n    isPrimary: true\n  },\n  rangeU: {\n    inputType: 'math',\n    defaultValue: '\\\\left[0,\\\\ 3\\\\right]',\n    isPrimary: true\n  },\n  rangeV: {\n    inputType: 'math',\n    defaultValue: '\\\\left[-\\\\pi,\\\\ \\\\pi\\\\right]',\n    isPrimary: true\n  },\n  colorExpr: {\n    isPrimary: true,\n    inputType: 'math',\n    defaultValue: '_f(X, Y, Z, r, \\\\theta)=mod(Z, 1)'\n  }\n}\n\n// ---------- Implicit Surface ---------- //\nconst implicitSurfaceSpecific: MetaData = {\n  lhs: {\n    inputType: 'math',\n    defaultValue: '_f(x,y,z)=x^2+y^2',\n    isPrimary: true\n  },\n  rhs: {\n    inputType: 'math',\n    defaultValue: '_f(x,y,z)=z^2+1',\n    isPrimary: true\n  },\n  samples: {\n    inputType: 'math',\n    defaultValue: '20'\n  },\n  opacity: {\n    inputType: 'math',\n    defaultValue: '1'\n  }\n}\n\nconst volumetricRange = {\n  rangeX: {\n    inputType: 'math',\n    defaultValue: '\\\\left[-5,\\\\ 5\\\\right]',\n    isPrimary: true\n  },\n  rangeY: {\n    inputType: 'math',\n    defaultValue: '\\\\left[-5,\\\\ 5\\\\right]',\n    isPrimary: true\n  },\n  rangeZ: {\n    inputType: 'math',\n    defaultValue: '\\\\left[-5,\\\\ 5\\\\right]',\n    isPrimary: true\n  }\n}\n\nexport const implicitSurfaceMeta: MetaData = {\n  ...universal,\n  ...surfaceLike,\n  ...volumetricRange,\n  ...implicitSurfaceSpecific\n}\n\n// ---------- Vector Field ---------- //\nconst vectorFieldSpecific: MetaData = {\n  expr: {\n    inputType: 'math',\n    defaultValue: '_f(x,y,z)=\\\\frac{[y,\\\\ -x,\\\\ 0]}{\\\\sqrt{x^2+y^2}}',\n    isPrimary: true\n  },\n  samples: {\n    inputType: 'math',\n    defaultValue: '[10, 10, 5]'\n  },\n  scale: {\n    inputType: 'math',\n    defaultValue: '1'\n  },\n  width: {\n    inputType: 'math',\n    defaultValue: '2'\n  },\n  end: {\n    inputType: 'boolean',\n    defaultValue: true\n  }\n}\n\nexport const vectorFieldMeta: MetaData = {\n  ...universal,\n  ...lineLike,\n  ...volumetricRange,\n  ...vectorFieldSpecific\n}\n\n// ---------- Camera ---------- //\nexport const cameraMeta: MetaData = {\n  isOrthographic: {\n    inputType: 'boolean',\n    defaultValue: false,\n    isPrimary: true\n  },\n  isPanEnabled: {\n    inputType: 'boolean',\n    defaultValue: false,\n    isPrimary: true\n  },\n  isZoomEnabled: {\n    inputType: 'boolean',\n    defaultValue: true,\n    isPrimary: true\n  },\n  isRotateEnabled: {\n    inputType: 'boolean',\n    defaultValue: true,\n    isPrimary: true\n  },\n  relativePosition: {\n    inputType: 'numericArray',\n    defaultValue: [0.5, -2.0, 0.5],\n    isPrimary: true\n  },\n  relativeLookAt: {\n    inputType: 'numericArray',\n    defaultValue: [0, 0, 0],\n    isPrimary: true\n  },\n  computedPosition: {\n    inputType: 'math',\n    defaultValue: '\\\\left[-6, -4, 2\\\\right]',\n    isPrimary: true\n  },\n  computedLookAt: {\n    inputType: 'math',\n    defaultValue: '\\\\left[0, 0, 0\\\\right]',\n    isPrimary: true\n  },\n  useComputed: {\n    inputType: 'boolean',\n    defaultValue: false,\n    isPrimary: true\n  }\n}\n","/* @flow */\nimport React, { PureComponent } from 'react'\nimport classNames from 'classnames'\n\nconst MQ = window.MathQuill.getInterface(2)\n\nexport type MQMathField = {\n  latex: (string => MQMathField) &\n    (() => string)\n}\n\ntype MathQuillProps = {\n  latex: string,\n  style?: Object,\n  className?: string,\n  // MQ Config:\n  spaceBehavesLikeTab?: boolean,\n  leftRightIntoCmdGoes?: string,\n  restrictMismatchedBrackets?: boolean,\n  sumStartsWithNEquals?: boolean,\n  supSubsRequireOperand?: boolean,\n  charsThatBreakOutOfSupSub?: string,\n  autoSubscriptNumerals?: boolean,\n  autoCommands?: string,\n  autoOperatorNames?: string,\n  substituteTextarea?: Function,\n  // MathQuill Config Event Handlers\n  // MathQuill actually names them handler.edit, handler.enter, etc\n  onEnter?: Function,\n  onEdit?: Function,\n  onMoveOutOf?: Function,\n  onDeleteOutOf?: Function,\n  onUpOutOf?: Function,\n  onSelectOutOf?: Function,\n  onDownOutOf?: Function,\n  // Extra React Event Handlers\n  onFocus?: Function,\n  onBlur?: Function,\n}\n\ntype MathQuillState = {\n  isFocused: boolean\n}\n\nexport default class MathQuill extends PureComponent\n  <MathQuillProps, MathQuillState> {\n\n  mathField: MQMathField\n  span: ?HTMLSpanElement\n  preventOnEdit: boolean\n\n  state = {\n    isFocused: false\n  }\n\n  static configKeys = [\n    'spaceBehavesLikeTab',\n    'leftRightIntoCmdGoes',\n    'restrictMismatchedBrackets',\n    'sumStartsWithNEquals',\n    'supSubsRequireOperand',\n    'charsThatBreakOutOfSupSub',\n    'autoSubscriptNumerals',\n    'autoCommands',\n    'autoOperatorNames',\n    'substituteTextarea'\n  ]\n\n  static handlerKeys = {\n    onEnter: 'enter',\n    // onEdit: 'edit', onEdit is handled separately\n    onMoveOutOf: 'moveOutOf',\n    onDeleteOutOf: 'deleteOutOf',\n    onUpOutOf: 'upOutOf',\n    onSelectOutOf: 'selectOutOf',\n    onDownOutOf: 'downOutOf'\n  }\n\n  getConfig(props: MathQuillProps) {\n\n    const config = MathQuill.configKeys\n      .filter(prop => props[prop] )\n      .reduce((theConfig, prop) => {\n        theConfig[prop] = props[prop]\n        return theConfig\n      }, {} )\n\n    config.handlers = { }\n    config.handlers.edit = this.onEdit\n\n    // Add remaining handlers and return\n    return Object.keys(MathQuill.handlerKeys)\n      .filter(prop => props[prop] )\n      .reduce((theConfig, prop) => {\n        const handlerKey = MathQuill.handlerKeys[prop]\n        theConfig.handlers[handlerKey] = props[prop]\n        return theConfig\n      }, config)\n  }\n\n  componentDidMount() {\n    const config = this.getConfig(this.props)\n    this.mathField = MQ.MathField(this.span, config)\n    this.setLatex(this.props.latex)\n  }\n\n  setLatex(latex: string) {\n    if (latex === this.mathField.latex()) {\n      return\n    }\n    // mathField.latex will trigger onEdit, so supress that.\n    this.preventOnEdit = true\n    this.mathField.latex(this.props.latex)\n    this.preventOnEdit = false\n  }\n\n  componentDidUpdate() {\n    this.setLatex(this.props.latex)\n  }\n\n  onEdit = (mathField: MQMathField) => {\n    const handler = this.props.onEdit\n\n    if (handler && !this.preventOnEdit) {\n      handler(mathField)\n    }\n\n  }\n\n  onFocus = () => {\n    this.setState( { isFocused: true } )\n    if (this.props.onFocus) {\n      this.props.onFocus()\n    }\n  }\n  onBlur = () => {\n    this.setState( { isFocused: false } )\n    if (this.props.onBlur) {\n      this.props.onBlur()\n    }\n  }\n\n  render() {\n    // Setting classes through react overrides the custom mathquill classes\n    // unless we also set the mq classes through react.\n    const mqClasses = classNames(this.props.className, {\n      'mq-editable-field': true,\n      'mq-math-mode': true,\n      'mq-focused': this.state.isFocused\n    } )\n    return (\n      <span\n        onFocus={this.onFocus}\n        onBlur={this.onBlur}\n        style={this.props.style}\n        className={mqClasses}\n        ref={ ref => { this.span = ref } }>\n      </span>\n    )\n  }\n\n}\n\ntype StaticMathProps = {\n  latex?: string,\n  style?: Object,\n  className?: string,\n};\n\ntype MQStaticMath = {\n  latex: Function\n}\n\nexport class StaticMath extends PureComponent<StaticMathProps> {\n\n  staticMath: MQStaticMath\n  span: ?HTMLSpanElement\n\n  componentDidMount() {\n    this.staticMath = MQ.StaticMath(this.span)\n  }\n\n  componentDidUpdate() {\n    if (this.props.latex !== this.staticMath.latex()) {\n      this.staticMath.latex(this.props.latex)\n    }\n  }\n\n  render() {\n    const mqClasses = classNames(this.props.className, {\n      'mq-math-mode': true\n    } )\n    return (\n      <span\n        style={this.props.style}\n        className={mqClasses}\n        ref={ ref => { this.span = ref } }>\n        {this.props.latex}\n      </span>\n    )\n  }\n\n}\n","// @flow\nimport MathQuill, { StaticMath } from 'components/MathQuill'\nimport styled, { css } from 'styled-components'\n\nconst borderStyling = css`\n  border-top none;\n  border-left: none;\n  border-right: none;\n  margin-bottom:1px;\n  border-bottom-width: 1px;\n  border-bottom-color: ${props => props.theme.gray[5]};\n  &.mq-focused {\n    box-shadow:none;\n    margin-bottom: 0px;\n    border-bottom-width: 2px;\n    border-bottom-color: ${props => props.theme.primary[4]}\n  };\n`\n\nconst errorStyling = css`\n  &, &.mq-focused {\n    border-bottom-color: red;\n  }\n`\n\nconst alignmentStyling = css`\n  align-self:stretch;\n  display: flex;\n  align-items:center;\n  padding:2px;\n`\n\nexport const MathQuillStyled = styled(MathQuill)`\n  &.mq-editable-field.mq-math-mode {\n    flex:1;\n    max-width: 100%;\n    font-size: ${props => props.size === 'small' ? '100%' : '125%'};\n    font-weight:bolder;\n    ${borderStyling};\n    ${props => props.hasError && errorStyling};\n    ${alignmentStyling};\n  }\n`\n// To help enzyme; finding by component reference not working\nMathQuillStyled.displayName = 'MathQuillStyled'\n\nexport const StaticMathStyled = styled(StaticMath)`\n  &.mq-math-mode {\n    max-width: calc(100% - 30px);\n    font-size: ${props => props.size === 'small' ? '100%' : '125%'};\n    font-weight:bolder;\n    ${alignmentStyling};\n  }\n`\n","// @flow\nimport math from 'utils/mathjs'\nimport type { Node } from 'utils/mathjs/types'\nimport memoizeOne from 'memoize-one'\n\nexport type PostProcessor = (Node) => void\nexport type PreProcessor = (expression: string) => string\nexport type Evaluated = number | Array<Evaluated> | (...Array<Evaluated>) => Evaluated\nexport type Scope = {\n  [symbol_name: string]: Evaluated\n}\n\n/**\n * Uses math.parse to parse a math expression into a tree. Holds the tree and\n * some helper information/methods.\n */\nexport default class MathExpression {\n\n  string: string\n  dependencies: Set<string> // direct dependencies!\n  tree: Node\n  eval: ((scope:Scope) => Array<Evaluated>) | ((scope:Scope) => Evaluated)\n  name = null\n\n  /**\n  * @param {string} expression to be parsed\n  * @param {array<function>} preprocessors array of functions mapping strings to strings. These functions are applied to expression before being parsed by mathjs.\n  * @param {array<function>} postprocessors array of functions called on the part tree's nodes. These functions are applied to expression before being parsed by mathjs.\n  *  - preprocessors is an array of function mapping strings to strings.\n  */\n  constructor(\n    expression: string,\n    preprocessors: Array<PreProcessor> = [],\n    postprocessors: Array<PostProcessor> = []\n  ) {\n    this.string = expression\n    this.tree = math.parse(this._preprocess(preprocessors))\n    this.name = this.tree.name ? this.tree.name : null\n    this._postprocess(postprocessors)\n\n    this.dependencies = this._getDependencies()\n\n    // $FlowFixMe memoizeOne expects itsequality function arguments to be of type mixed, but we specify that they are of type Scope\n    this.eval = memoizeOne(this._getEval(), this._getSubscopeEquality())\n  }\n\n  _preprocess(preprocessors: Array<PreProcessor>) {\n    return preprocessors.reduce((acc, f) => f(acc), this.string)\n  }\n\n  _postprocess(postprocessors: Array<PostProcessor>) {\n    postprocessors.forEach(f => {\n      this.tree.traverse(node => f(node))\n    } )\n  }\n\n  static _getRHS(node: Node) {\n    if (node.type === 'AssignmentNode') {\n      return node.value\n    }\n    if (node.type === 'FunctionAssignmentNode') {\n      return node.expr\n    }\n    return node\n  }\n\n  _getDependencies() {\n    const dependencies: Set<string> = new Set()\n    const isAssignmentNode = (this.tree.type === 'AssignmentNode')\n    const isFunctionAssignmentNode = (this.tree.type === 'FunctionAssignmentNode')\n\n    // In case of assignment, use right-hand-side as tree\n    const rhs = MathExpression._getRHS(this.tree)\n\n    const params = (this.tree.type === 'FunctionAssignmentNode')\n      ? this.tree.params\n      : []\n\n    rhs.traverse((node: Node) => {\n      if (node.type === 'SymbolNode' || node.type === 'FunctionNode') {\n        if (!params.includes(node.name)) {\n          dependencies.add(node.name)\n        }\n      }\n\n      if (isAssignmentNode || isFunctionAssignmentNode) {\n        if ( [...dependencies, ...params].includes(this.tree.name)) {\n          throw Error('Cyclic Assignment Error')\n        }\n      }\n    } )\n\n    return dependencies\n  }\n\n  _getEval() {\n    const compiled = this.tree.compile()\n\n    return (scope: Scope): Evaluated => {\n      const localScope = { ...scope }\n      const raw = compiled.eval(localScope)\n      if (raw instanceof math.type.DenseMatrix) {\n        return raw.toArray()\n      }\n      if (raw instanceof Function) {\n        const temp = (...args) => {\n          let result\n\n          if (raw.length > 1 && args.length === 1 && Array.isArray(args[0] )) {\n            // This allways for inputing a vector expression into a multivariable function\n            result = raw(...args[0] )\n          }\n          else {\n            result = raw(...args)\n          }\n\n          if (result instanceof math.type.DenseMatrix) {\n            return result.toArray()\n          }\n          return result\n        }\n        Object.defineProperty(temp, 'length', { value: raw.length } )\n        Object.defineProperty(temp, 'name', { value: raw.name } )\n        return temp\n      }\n      return raw\n    }\n  }\n\n  _getSubscopeEquality() {\n    const subscopeEquality = (newScope: Scope, oldScope: Scope) => {\n      for (const symbol of this.dependencies) {\n        if (newScope[symbol]===undefined && math[symbol]===undefined) {\n          return false\n        }\n        else if (newScope[symbol] !== oldScope[symbol] ) {\n          return false\n        }\n      }\n      return true\n    }\n    return subscopeEquality\n  }\n\n}\n","// @flow\n/**\n * Set union\n *\n * @param  {set} a\n * @param  {set} b\n * @return {set}   union of a and b\n */\nexport function union<A, B>(a: Set<A>, b: Set<B>): Set<A|B> {\n  return new Set( [...a, ...b] )\n}\n\n/**\n * Set intersection\n *\n * @param  {set} a\n * @param  {set} b\n * @return {set}   union of a and b\n */\nexport function intersect<A>(a: Set<A>, b: Set<A>): Set<A> {\n  return new Set( [...a].filter(item => b.has(item)))\n}\n\n/**\n * merge one set into another\n *\n * @param {set} target target set, mutated and returned\n * @param {set} source whose elements are merged into target\n */\nexport function setMergeInto<A, B>(target: Set<A|B>, source: Set<B>): Set<A|B> {\n  for (const item of source) {\n    target.add(item)\n  }\n  return target\n}\n","// @flow\nimport { escapeRegExp, replaceAll, findClosingBrace } from '../../helpers'\n\n/**\n * A preprocessor to be used before mathjs's math.parse function. Motivation:\n * For higher-order functions (HOFs) like differentiation, we want to write\n * diff(f)(x), where diff(f) evaluates to a function which is subsequently\n * evaluated at value x.\n *\n * But mathjs's parser can't handle this. It interprets diff(f)(x) as two\n * numbers, diff(f) and (x), implicitly multiplied. The alternative we've\n * settled for is expressions like diff(f, x).\n *\n * So this preprocessor turns user-facing syntax to mathjs-facing syntax:\n *\n * diff(f)(u,v) --> diff(f, u, v)\n *\n * Note that diff(f) without a subsequent evaluation remains unchanged, which\n * can show up second derivatives:\n *\n * diff( diff(f) )(u, v) --> diff( diff(f), u, v)\n *\n * @param  {array<string>} hofNames An array of higher-order function names\n */\nexport default function preprocessHOFs(hofNames: Array<string>) {\n  return (str: string) => hofNames.reduce((acc, c) => convertSingleHOF(acc, c), str)\n}\n\nexport function convertSingleHOF(expr: string, hofName: string) {\n  expr = normalizeHOFExpression(expr, hofName)\n\n  const hofStart = expr.indexOf(hofName)\n\n  if (hofStart < 0) {\n    return expr\n  }\n\n  const funcStart = hofStart + hofName.length\n  const funcClose = findClosingBrace(expr, funcStart)\n\n  // 'PLACEHOLDER' marks a hofName as finished. Brittle, I guess.\n  if (expr[funcClose + 1] !== '(') {\n    expr = expr.slice(0, hofStart) + 'PLACEHOLDER' + expr.slice(funcStart, expr.length)\n  }\n  else {\n    const argStart = funcClose + 1\n    expr = expr.slice(0, hofStart) + 'PLACEHOLDER' + expr.slice(funcStart, funcClose) + ',' + expr.slice(argStart + 1, expr.length)\n  }\n\n  // Test if any hofName remain\n  if (expr.indexOf(hofName) < 0) {\n    return replaceAll(expr, 'PLACEHOLDER', hofName)\n  }\n  else {\n    return convertSingleHOF(expr, hofName)\n  }\n}\n\n/**\n * Removes some whitespace:\n *  - between hofName and opening parenthesis\n *  - between closing and opening parentheses\n *\n * Example:\n *  diff  (f)  (u, v) --> diff(f)(u, v)\n */\nexport function normalizeHOFExpression(expr: string, hofName: string) {\n  return expr\n    .replace(new RegExp(`${escapeRegExp(hofName)}\\\\s+\\\\(`), `${hofName}(`)\n    .replace(/\\)\\s+\\(/g, ')(')\n}\n","// @flow\nimport MathExpression from './MathExpression'\nimport { preprocessHOFs, preprocessMathQuill } from './preprocessors'\nimport { reassignOperators } from './postprocessors'\nimport { setMergeInto } from 'utils/sets'\nimport type {\n  PreProcessor,\n  PostProcessor\n} from './MathExpression'\n\ntype ParserCache = {\n  [string]: {\n    parsed: MathExpression,\n    error: null\n  } | {\n    parsed: null,\n    error: Error\n  }\n}\n\nexport default class Parser {\n\n  _cache: ParserCache = {}\n  _preprocessors = []\n  _postprocessors = []\n\n  static _defaultPreprocessors = [\n    preprocessMathQuill,\n    preprocessHOFs( ['diff', 'unitT', 'unitN', 'unitB'] )\n  ]\n  static _defaultPostprocessors = [\n    reassignOperators( { '|': 'dot', '&': 'cross' } )\n  ]\n\n  constructor(\n    preprocessors: Array<PreProcessor> = Parser._defaultPreprocessors,\n    postprocessors: Array<PostProcessor> = Parser._defaultPostprocessors\n  ) {\n    this._preprocessors = preprocessors\n    this._postprocessors = postprocessors\n  }\n\n  parse(expresssion: string) {\n    if (this._cache[expresssion] === undefined) {\n      this.addToCache(expresssion)\n    }\n    const { parsed, error } = this._cache[expresssion]\n\n    if (parsed) {\n      return parsed\n    }\n    throw error\n  }\n\n  addToCache(expresssion: string) {\n    try {\n      this._cache[expresssion] = {\n        parsed: new MathExpression(expresssion, this._preprocessors, this._postprocessors),\n        error: null\n      }\n    }\n    catch (err) {\n      this._cache[expresssion] = {\n        parsed: null,\n        error: err\n      }\n    }\n  }\n\n}\n\n/**\n * returns which symbols are used in expressions\n *\n * @param  {Parser} parser Parser instance\n * @param  {string[]} expressions array of mathematical expression strings\n * @return {set} set of used symbols\n */\nexport function getUsedSymbols(\n  parser: Parser,\n  expressions: Array<string>\n): Set<string> {\n  return expressions.reduce((usedSymbols, expression) => {\n    return setMergeInto(usedSymbols, parser.parse(expression).dependencies)\n  }, new Set())\n}\n","// @flow\nimport { replaceAll, findClosingBrace } from '../../helpers'\n\n/**\n * Makes a series of replacements on MathQuill-generated LaTeX strings so that\n * they can be parsed by MathJS.\n *\n * Notes:\n *  1. This is pretty heuristic. Might discover updates needed.\n *  2. Much of this could be used to preprocess LaTeX generated by other means\n * (i.e., not MathQuill.) The main bit that is MathQuill-specific is probably\n * the operatorname replacements.\n *\n * @param  {string} fromMQ a MathQuill-generated LaTeX expression\n * @return {string} the input expression with LaTeX commands converted to mathjs\n */\nexport default function mathquillToMathJS(fromMQ: string) {\n  const replacements = [\n    { tex: '\\\\operatorname{diff}', mathjs: 'diff' },\n    { tex: '\\\\operatorname{pdiff}', mathjs: 'pdiff' },\n    { tex: '\\\\operatorname{curl}', mathjs: 'curl' },\n    { tex: '\\\\operatorname{div}', mathjs: 'div' },\n    { tex: '\\\\operatorname{norm}', mathjs: 'norm' },\n    { tex: '\\\\operatorname{mod}', mathjs: 'mod' },\n    { tex: '\\\\operatorname{abs}', mathjs: 'abs' },\n    { tex: '\\\\operatorname{unitT}', mathjs: 'unitT' },\n    { tex: '\\\\operatorname{unitN}', mathjs: 'unitN' },\n    { tex: '\\\\operatorname{unitB}', mathjs: 'unitB' },\n    { tex: '\\\\operatorname{arccosh}', mathjs: 'arccosh' },\n    { tex: '\\\\operatorname{arcsinh}', mathjs: 'arcsinh' },\n    { tex: '\\\\operatorname{arctanh}', mathjs: 'arctanh' },\n    { tex: '\\\\cdot', mathjs: ' * ' },\n    { tex: '\\\\left', mathjs: '' },\n    { tex: '\\\\right', mathjs: '' },\n    { tex: '{', mathjs: '(' },\n    { tex: '}', mathjs: ')' },\n    { tex: '~', mathjs: ' ' },\n    { tex: '\\\\', mathjs: ' ' }\n  ]\n\n  // remove fractions, then apply replacements\n  const noFrac = fracToDivision(fromMQ)\n  const noBraceSub = convertSubscript(noFrac)\n  return replacements.reduce(\n    (acc, r) => replaceAll(acc, r['tex'], r['mathjs'] ),\n    noBraceSub)\n}\n\n/**\n * Recursively removes braces from LaTeX subscripts\n *   - example: x_{12foo_{bar123_{evenlower}}} --> x_12foo_bar123_evenlower\n */\nexport function convertSubscript(expr: string) {\n  const sub = '_{'\n  const subStart = expr.indexOf(sub)\n\n  if (subStart < 0) { return expr }\n\n  const numStart = subStart + sub.length\n  const closingBrace = expr.indexOf('}', numStart)\n  const newExpr = expr.slice(0, subStart) +\n    '_' +\n    expr.slice(numStart, closingBrace) +\n    expr.slice(closingBrace + 1)\n\n  return convertSubscript(newExpr)\n}\n\n/**\n * Recursively replaces LaTeX fractions with normal divison\n *   - example: \\frac{a}{1 + \\frac{b}{c}} --> {a}/{1 + {b}/{c}}\n */\nexport function fracToDivision(expr: string) {\n  const frac = '\\\\frac'\n  const fracStart = expr.indexOf(frac)\n  const numStart = fracStart + frac.length\n\n  if (fracStart < 0) { return expr }\n\n  const divIdx = findClosingBrace(expr, numStart)\n  // Remove frac, and add \"/\"\n  const newExpr = expr.slice(0, fracStart) +\n    expr.slice(numStart, divIdx + 1) + '/' +\n    expr.slice(divIdx + 1)\n\n  return fracToDivision(newExpr)\n}\n","// @flow\nimport math from 'utils/mathjs'\nimport type { Node } from 'utils/mathjs/types'\n\n/**\n * Returns a node hander to be used as a mathjs's ExpressionTree.traverse callback\n *\n * @param  {Object} operatorFnMap maps old operator function names to new operator function names\n */\nexport default function reassignOperators(operatorFnMap: {[string]: string} ) {\n  for (let key of Object.keys(operatorFnMap)) {\n    const fnName = operatorFnMap[key]\n    if (!math.hasOwnProperty(fnName)) {\n      throw Error(`math['${fnName}'] does not exist. (ExpressionTree Operators can only be reassigned to functions within the math (mathjs) namespace.)`)\n    }\n  }\n\n  return (node: Node) => {\n    if (node.type === 'OperatorNode' && operatorFnMap.hasOwnProperty(node.op)) {\n      node.fn = operatorFnMap[node.op]\n    }\n  }\n}\n","// @flow\n\n/**\n * Functions for evaluating a serialized description of mathematical symbols.\n * This includes sorting the symbols into a valid evaluation order.\n *\n * As an example, consider the serialized symbol:values 'scope' below:\n *\n *     a = b/2 - c\n *     b = g(4) + c\n *     c = -1\n *     d = +1\n *     f(x, y) = a*x^2 - b*y\n *     g(t) = t^3 - 1\n *     p = c^2 + d^2\n *     z = 1\n *\n * These symbol definitions forms a directed graph where parents represent\n * evaluation dependencies and must be evaluated first.\n *\n * Note that 'x', 'y', and 't' are function arguments and do not appear in our\n * dependency graph.\n *\n * d ----------->--- p\n *          /\n * c -->-------\\\n *        \\     -->-- a -->--- f\n * g -->-- b --/              /\n *         \\                 /\n *         \\-------->-------\n *\n * z        (isolated node)\n *\n * This module has two main responsibilities:\n *   1. Generate an initial symbol:value mapping from a serialized description.\n *   2. Update an exisiting symbol:value mapping when some variable values have\n *      changed. For example, when a single variable value changes, we do not\n *      need to re-evaluate the entire mathscope. In the example above, if 'b'\n *      changes from 'g(4)' to 'g(3) + p' we only need to update b and its\n *      descendants.\n *\n *  Low-level functions are combined in the MathScope class, which provides\n *  caching for faster re-computation.\n */\n\nimport toposort from 'toposort'\nimport Graph from 'tarjan-graph'\nimport diff from 'shallow-diff'\nimport {\n  setMergeInto\n} from 'utils/sets'\nimport math from 'utils/mathjs'\nimport type Parser from './Parser'\nimport type { Scope } from './MathExpression'\n\nconst DEFAULT_SYMBOL_NAMES = new Set(Object.keys(math))\n\nexport type Symbols = {\n  [symbolName: string]: string\n}\ntype ScopeErrors = {\n  [symbolName: string]: Error\n}\ntype ChildMap = {\n  [nodeName: string]: Set<string>\n}\n\n/**\n * evaluates a serialized scope from scratch or updates an existing scope\n *\n * @param  {Parser} parser for evaluating mathematical expressions\n * @param  {Symbols} symbols, must be parseable!\n * @param  {?Scope} oldScope\n * @param {?array|set} changed which serialized symbol values have changed.\n *   Starting from oldScope, only update these symbols and their children\n *\n * Note: The optional arguments oldScope and changed should NOT be used if\n * deleting symbols from or adding symbols to the scope. These arguments are\n * intended to improve performance when changing a single symbol's very often,\n * e.g., when the symbol's value is changed by a slider\n *\n */\nexport function evalScope(\n  parser: Parser,\n  symbols: Symbols,\n  oldScope: Scope = {},\n  changed: ?(Set<string> | Array<string>) = null\n): {scope: Scope, errors: ScopeErrors} {\n  // Get the evaluation order and add symbols to scope\n  const childMap = getChildMap(symbols, parser)\n\n  const { evalOrder, cycles } = getEvalOrder(symbols, childMap, changed)\n  const errors: { [string]: Error } = Object.keys(cycles)\n    .reduce((acc, node) => {\n      const deps = cycles[node].join(', ')\n      acc[node] = Error(`Symbol ${node} has cyclic dependencies: ${deps}`)\n      return acc\n    }, {} )\n\n  const initial = {\n    scope: { ...oldScope }, // copy oldScope, not mutate\n    errors: errors\n  }\n\n  const rawResult = evalOrder.reduce((acc, symbolName) => {\n    try {\n      acc.scope[symbolName] = parser.parse(symbols[symbolName] ).eval(acc.scope)\n    }\n    catch (err) {\n      acc.errors[symbolName] = err\n    }\n    return acc\n  }, initial)\n\n  // rawResult.scope might include some functions that cannot actually be\n  // evaluated. For example,\n  // >>> evalScope(parser, { f: 'f()=x' } )\n  // adds a function f to scope that throws Undefined symbol upon evaluation.\n  return removeFunctionsWithMissingDeps(parser, symbols, evalOrder, rawResult)\n\n}\n\nfunction removeFunctionsWithMissingDeps(\n  parser: Parser,\n  symbols: Symbols,\n  evalOrder: Array<string>,\n  rawResult: {errors: ScopeErrors, scope: Scope}\n) {\n  const functions = evalOrder.filter(symbolName => {\n    return typeof rawResult.scope[symbolName] === 'function'\n  } )\n\n  return functions.reduce((acc, symbolName) => {\n    const directDependencies = parser.parse(symbols[symbolName] ).dependencies\n    const unmet = [...directDependencies].filter(dep => acc.scope[dep] === undefined)\n    if (unmet.length > 0) {\n      delete acc.scope[symbolName]\n      const names = unmet.join(', ')\n      acc.errors[symbolName] = Error(`Eval Error: Depends on undefined symbol(s) ${names}`)\n      // what to do with updated?\n    }\n    return acc\n  }, rawResult)\n}\n\n/**\n * Determines a valid evaluation order for symbols. If onlyTheseAndChildren is\n * supplied, only returns those nodes and their children.\n *\n * @param  {Symbols} symbols\n * @param  {ChildMap} childMap pre-calculated for symbols\n * @param  {?array|Set} onlyTheseAndChildren\n *\n * @returns {array} of symbol names, a valid evaluation order for symbols\n */\nexport function getEvalOrder(\n  symbols: Symbols,\n  childMap: ChildMap,\n  onlyTheseAndChildren: ?(Set<string> | Array<string>) = null\n): {\n  evalOrder: Array<string>,\n  cycles: { [nodeName: string]: Array<string> }\n} {\n  // construct dependency graph as array of nodes\n  const nodesToInclude = onlyTheseAndChildren\n    ? [...getDescendants(onlyTheseAndChildren, childMap)]\n    : Object.keys(childMap)\n\n  let sorted, isolated, edges, cycles, withoutCycles\n  try {\n    ( { edges, isolated } = getSubgraphEdges(childMap, nodesToInclude))\n    sorted = toposort(edges)\n    cycles = {}\n  }\n  catch (error) {\n    if (error.message.startsWith('Cyclic dependency')) {\n      ( { withoutCycles, cycles } = removeCycles(childMap));\n      ( { edges, isolated } = getSubgraphEdges(withoutCycles,\n        nodesToInclude.filter(node => !cycles.hasOwnProperty(node))\n      ))\n      sorted = toposort(edges)\n    }\n    else {\n      throw error\n    }\n  }\n\n  const evalOrder = [...sorted, ...isolated]\n\n  return { evalOrder, cycles }\n}\n\n// Gets edges and isolated nodes\nexport function getSubgraphEdges(\n  childMap: ChildMap,\n  nodesToInclude: Array<string>\n): {\n  edges: Array<[string, string]>,\n  isolated: Array<string>\n} {\n  // This set will hold nodes who have parents\n  const haveParents: Set<string> = new Set()\n  const { edges, childless } = nodesToInclude.reduce((acc, node) => {\n    if (childMap[node].size === 0) {\n      acc.childless.push(node)\n    }\n    for (const child of childMap[node] ) {\n      acc.edges.push( [node, child] )\n      haveParents.add(child)\n    }\n    return acc\n  }, { edges: [], childless: [] } )\n\n  // Isolated nodes are childless AND parentless\n  const isolated = childless.filter(node => !haveParents.has(node))\n\n  return { edges, isolated }\n}\n\nexport function removeCycles(childMap: ChildMap): {\n  withoutCycles: ChildMap,\n  cycles: {[string]: Array<string>}\n} {\n  const graph = new Graph()\n  for (const key of Object.keys(childMap)) {\n    graph.add(key, [...childMap[key]] )\n  }\n  // graph.getCycles does not include any strongly-connected components of\n  // length 1, even cycles of length 1\n  const connected = graph.getStronglyConnectedComponents().filter(scc => {\n    return scc.length > 1 || scc[0].successors.includes(scc[0] )\n  } )\n\n  // For each node involved in cycle, record which other nodes are involved in\n  // the same cycle\n  const cycles: {[string]: Array<string>} = {}\n  connected.forEach(scc => {\n    const nodeNames = scc.map(vertex => vertex.name)\n    nodeNames.sort()\n    scc.forEach(vertex => {\n      cycles[vertex.name] = nodeNames\n    } )\n  } )\n\n  const cyclicNodes = new Set(Object.keys(cycles))\n  const withoutCycles = Object.keys(childMap).reduce((acc, node) => {\n    if (cyclicNodes.has(node)) {\n      return acc\n    }\n    // get children not involved in cycles\n    const children = [...childMap[node]].filter(x => !cyclicNodes.has(x))\n    acc[node] = new Set(children)\n    return acc\n  }, {} )\n\n  return { withoutCycles, cycles }\n}\n\n/**\n * Detect direct children of all nodes and detect nodes with unmet dependencies\n *\n * @param  {Symbols} symbols\n * @param  {Parser} parser\n *\n * @returns {ChildMap}\n */\nexport function getChildMap(symbols: Symbols, parser: Parser): ChildMap {\n\n  const initial = Object.keys(symbols).reduce((acc, symbolName) => {\n    acc[symbolName] = new Set()\n    return acc\n  }, {} )\n\n  const childMap = Object.keys(symbols).reduce((childMap, symbolName) => {\n    const symbol = symbols[symbolName]\n    const dependencies = parser.parse(symbol).dependencies\n\n    // remove defaults from dependencies\n    dependencies.forEach(dep => {\n      const skip = DEFAULT_SYMBOL_NAMES.has(dep) && !symbols[dep]\n      skip && dependencies.delete(dep)\n    } )\n\n    dependencies.forEach(dep => {\n      childMap[dep] && childMap[dep].add(symbolName)\n    } )\n    return childMap\n  }, initial)\n\n  return childMap\n\n}\n\n/**\n * get all descendants of a single node in a directed graph\n *\n * @param  {ChildMap} childMap\n * @returns {set} the given node and all of its descendents\n */\nexport function getDescendantsOfNode(node: string, childMap: ChildMap) {\n  const descendants: Set<string> = new Set( [node] )\n\n  if (childMap[node].size === 0) {\n    return descendants\n  }\n\n  childMap[node].forEach(child => {\n    setMergeInto(descendants, getDescendantsOfNode(child, childMap))\n  } )\n\n  return descendants\n}\n\n/**\n * get all descendants of nodes in a directed graph\n *\n * @param  {set|array} nodes\n * @returns {set} the given nodes and all of their descendents\n */\nexport function getDescendants(\n  nodes: Set<string> | Array<string>,\n  childMap: ChildMap\n) {\n  const children: Set<string> = new Set()\n  nodes.forEach(node => {\n    setMergeInto(children, getDescendantsOfNode(node, childMap))\n  } )\n  return children\n}\n\ntype Diff = {\n  unchanged: Array<string>,\n  updated: Array<string>,\n  deleted: Array<string>,\n  added: Array<string>\n}\n\ntype Result = {\n  scope: Scope,\n  scopeDiff: Diff,\n  errors: ScopeErrors,\n  errorsDiff: Diff\n}\n\nexport class ScopeEvaluator {\n\n  _parser: Parser\n  _oldResult: Result = {\n    scope: {},\n    scopeDiff: {\n      unchanged: [],\n      updated: [],\n      added: [],\n      deleted: []\n    },\n    errors: {},\n    errorsDiff: {\n      unchanged: [],\n      updated: [],\n      added: [],\n      deleted: []\n    }\n  }\n  _oldSymbols: Symbols = {}\n\n  constructor(parser: Parser) {\n    this._parser = parser\n  }\n\n  evalScope(symbols: Symbols) {\n\n    if (symbols === this._oldSymbols) {\n      return this._oldResult\n    }\n\n    const { updatesOnly, changed } = ScopeEvaluator._detectChanges(symbols, this._oldSymbols)\n\n    const result = updatesOnly\n      ? this._patchScope(symbols, changed)\n      : this._recalculateScope(symbols)\n\n    this._updateState(symbols, result)\n    return result\n\n  }\n\n  static _detectChanges(newSymbols: Symbols, oldSymbols: Symbols) {\n    const { added, deleted, updated } = diff(newSymbols, oldSymbols)\n    return {\n      updatesOnly: added.length === 0 && deleted.length === 0,\n      changed: updated\n    }\n  }\n\n  _patchScope(symbols: Symbols, changed: Array<string>) {\n    const { scope, errors } = evalScope(this._parser, symbols, this._oldResult.scope, changed)\n\n    // errors only includes errors in changed symbols.\n    // Add back all the old errors, except the ones that are now in-scope or\n    // have a new error message.\n    const combinedErrors = Object.keys(this._oldResult.errors).filter(\n      symbolName => !scope[symbolName] && !errors[symbolName]\n    ).reduce((acc, symbolName) => {\n      acc[symbolName] = this._oldResult.errors[symbolName]\n      return acc\n    }, errors)\n\n    return {\n      scope: scope,\n      errors: combinedErrors,\n      scopeDiff: diff(this._oldResult.scope, scope),\n      errorsDiff: diff(this._oldResult.errors, combinedErrors)\n    }\n\n  }\n\n  _recalculateScope(symbols: Symbols) {\n    const { scope, errors } = evalScope(this._parser, symbols)\n    return {\n      scope,\n      errors,\n      scopeDiff: diff(this._oldResult.scope, scope),\n      errorsDiff: diff(this._oldResult.errors, errors)\n    }\n  }\n\n  _updateState(symbols: Symbols, result: Result) {\n    this._oldSymbols = symbols\n    this._oldResult = result\n  }\n\n}\n","// @flow\nimport {\n  Parser,\n  ScopeEvaluator\n} from 'utils/mathParsing'\n\nexport const parser = new Parser()\nexport const scopeEvaluator = new ScopeEvaluator(parser)\n\nwindow.parser=parser\n","import { ParseErrorData } from 'services/errors'\nconst charRegexp = /\\s\\(char.*\\)/g\n\nexport function isAssignmentRHS(parser, latex) {\n  // Try assigning this RHS to a variable.\n  // For now, fake variable name '__' is hard-coded. Not ideal...\n  try {\n    const tree = parser.parse(`__=${latex}`).tree\n    if (tree.type === 'AssignmentNode' || tree.type === 'FunctionAssignmentNode') {\n      return (tree.value.type === 'AssignmentNode' || tree.value.type === 'FunctionAssignmentNode')\n        ? new ParseErrorData('Parse Error: Unexpected assignment')\n        : new ParseErrorData(null)\n    }\n    return new ParseErrorData('Parse Error: Invalid right-hand side.')\n  }\n  catch (error) {\n    const message = `Parse Error: ${error.message.replace(charRegexp, '')}`\n    return new ParseErrorData(message)\n  }\n}\n\nexport function isAssignmentLHS(parser, latex) {\n  try {\n    const nodeType = parser.parse(`${latex}=1`).tree.type\n    if (nodeType === 'AssignmentNode' || nodeType === 'FunctionAssignmentNode') {\n      return new ParseErrorData(null)\n    }\n    return new ParseErrorData('Parse Error: invalid symbol name.')\n  }\n  catch (error) {\n    const message = `Parse Error: ${error.message.replace(charRegexp, '')}`\n    return new ParseErrorData(message)\n  }\n}\n\nexport function isValidName(parser, latex, { usedNames } ) {\n  const name = parser.parse(latex).name\n  if (name === undefined) {\n    throw Error(`Unexpected Error: Expression ${latex} does not have a name.`)\n  }\n  if (usedNames.has(name)) {\n    return new ParseErrorData(`Name Error: name '${name}' is used more than once.`)\n  }\n\n  return new ParseErrorData(null)\n}\n\n// This validates the overall assignment. Just because we had to make a choice,\n// we associate it with the LHS, and pass RHS as a validatorArgument.\n// This catches cyclic assignment errors that would not otherwise be caught.\n// Note: Expects a validated LHS\nexport function isAssignment(parser, latexLHS, { latexRHS } ) {\n  const { isValid: validRHS } = isAssignmentRHS(parser, latexRHS)\n  if (!validRHS) {\n    // The overall assignment is not valid, but it's not the LHS's fault\n    return new ParseErrorData(null)\n  }\n  try {\n    parser.parse(latexLHS + '=' + latexRHS)\n    return new ParseErrorData(null)\n  }\n  catch (error) {\n    const message = `Parse Error: ${error.message.replace(charRegexp, '')}`\n    return new ParseErrorData(message)\n  }\n}\n\nexport function isReal(parser, latex) {\n  if (isNaN(latex)) {\n    return new ParseErrorData(`Value Error: ${latex} is not a plain number`)\n  }\n  return new ParseErrorData(null)\n}\n","// @flow\nimport * as React from 'react'\nimport { parser } from 'constants/parsing'\nimport type { Parser } from 'utils/mathParsing'\nimport type { MQMathField } from 'components/MathQuill'\nimport { MathQuillStyled } from './MathQuillStyled'\nimport { isAssignmentRHS } from './validators'\nimport styled from 'styled-components'\nimport { timeout } from 'utils/functions'\nimport { Tooltip } from 'antd'\nimport { ParseErrorData } from 'services/errors'\n\nconst MathInputContainer = styled.div`\n  flex:1;\n  align-self:stretch;\n  display: flex;\n`\nconst ErrorContainer = styled.div`\n  min-height: 45px;\n  width: 250px;\n`\n\nexport type Validator = (parser: Parser, latex: string, validateAgainst: any) => ParseErrorData\ntype OnValidatorAndErrorChange = (ErrorData: ParseErrorData) => void\ntype OnValidatedTextChange = (latex: string, ErrorData: ParseErrorData) => void\n\nexport type OtherProps = {|\n  // These have defaults\n  parser: Parser,\n  validators: Array<Validator>,\n  size: 'small' | 'large',\n  prefix: string,\n  displayErrorDelay: number,\n  allowEmpty: boolean,\n  // These are optional\n  style?: InlineStyle,\n  className?: string,\n  validateAgainst?: any,\n  errorMsg?: string,\n|}\ntype Props = {\n  ...OtherProps,\n  latex: string,\n  onValidatorAndErrorChange: OnValidatorAndErrorChange,\n  onValidatedTextChange: OnValidatedTextChange\n}\n\ntype State = {\n  isFocused: boolean,\n  isPersistentError: boolean\n}\n\nexport default class MathInput extends React.PureComponent<Props, State> {\n\n  static defaultProps = {\n    parser: parser,\n    validators: [isAssignmentRHS],\n    displayErrorDelay: 1500,\n    size: 'large',\n    prefix: '',\n    allowEmpty: false\n  }\n\n  state = {\n    isFocused: false,\n    isPersistentError: false\n  }\n\n  // Internal Storage\n  _errorId: ?Symbol\n  _containerRef: { current: null | HTMLDivElement }\n\n  constructor(props: Props) {\n    super(props)\n    this._containerRef = React.createRef()\n\n    // $FlowFixMe\n    this.getContainerRef = this.getContainerRef.bind(this)\n    // $FlowFixMe\n    this.onEdit = this.onEdit.bind(this)\n    // $FlowFixMe\n    this.onFocus = this.onFocus.bind(this)\n    // $FlowFixMe\n    this.onBlur = this.onBlur.bind(this)\n  }\n\n  static validate(\n    validators: Array<Validator>,\n    parser: Parser,\n    latex: string,\n    validateAgainst: any,\n    allowEmpty: boolean=false\n  ) {\n    if (allowEmpty && latex.trim() === '') {\n      return new ParseErrorData(null)\n    }\n    for (const validator of validators) {\n      const parseErrorData = validator(parser, latex, validateAgainst)\n      if (parseErrorData.isError) {\n        return parseErrorData\n      }\n    }\n\n    return new ParseErrorData(null)\n\n  }\n\n  getContainerRef() {\n    // in rare cases, body can be null\n    if (document.body === null) {\n      throw new Error('document.body is null.')\n    }\n    // return body as default in case containing div hasn't rendered yet\n    return this._containerRef.current || document.body\n  }\n\n  onEdit(mq: MQMathField) {\n    const { prefix } = this.props\n    const latex = mq.latex()\n    const errorData = this.validateSelf(latex)\n    this.props.onValidatedTextChange(prefix + latex, errorData)\n  }\n  onFocus() {\n    this.setState( { isFocused: true } )\n  }\n  onBlur() {\n    this.setState( { isFocused: false } )\n  }\n\n  async handleErrorPersistence(errorMsg: ?string) {\n    if (!errorMsg) {\n      this.setState( { isPersistentError: false } )\n      this._errorId = null\n      return\n    }\n    if (this.state.isPersistentError) {\n      return\n    }\n    // Wait and see if error persists\n    const errorId = Symbol('Error Identifier')\n    this._errorId = errorId\n    await timeout(this.props.displayErrorDelay)\n    const sameError = errorId === this._errorId\n    if (sameError && this._errorId) {\n      this.setState( { isPersistentError: true } )\n    }\n  }\n  displayErrorNow(errorMsg: ?string) {\n    const isError = Boolean(errorMsg)\n    this._errorId = isError ? Symbol('Error Identifier') : null\n    this.setState( { isPersistentError: isError } )\n  }\n\n  validateSelf(latex: string) {\n    const { validators, validateAgainst, parser, allowEmpty } = this.props\n    return MathInput.validate(validators, parser, latex, validateAgainst, allowEmpty)\n  }\n\n  componentDidMount() {\n    const { latex } = this.props\n    const errorData = this.validateSelf(latex)\n    const changed = errorData.errorMsg !== this.props.errorMsg\n    if (changed) {\n      this.props.onValidatorAndErrorChange(errorData)\n      this.handleErrorPersistence(errorData.errorMsg)\n    }\n    if (errorData.errorMsg) {\n      this.displayErrorNow(errorData.errorMsg)\n    }\n    // force re-render after container has rendered\n    this.forceUpdate()\n  }\n\n  componentDidUpdate(prevProps: Props) {\n\n    const {\n      validators,\n      validateAgainst,\n      latex,\n      errorMsg\n    } = this.props\n\n    const validatorsChange = validators !== prevProps.validators ||\n      validateAgainst !== prevProps.validateAgainst\n\n    if (validatorsChange) {\n      const errorData = this.validateSelf(latex)\n      const changed = errorData.errorMsg !== this.props.errorMsg\n      if (changed) {\n        this.props.onValidatorAndErrorChange(errorData)\n        this.handleErrorPersistence(errorData.errorMsg)\n      }\n    }\n\n    const errorMsgChanged = errorMsg !== prevProps.errorMsg\n    if (errorMsgChanged) {\n      this.handleErrorPersistence(errorMsg)\n    }\n\n  }\n\n  render() {\n    const { isPersistentError, isFocused } = this.state\n    return (\n      <MathInputContainer\n        className={this.props.className}\n        style={this.props.style}\n        ref={this._containerRef}\n      >\n        <Tooltip\n          getPopupContainer={this.getContainerRef}\n          visible={isPersistentError && isFocused}\n          title={\n            <ErrorContainer>\n              {this.props.errorMsg}\n            </ErrorContainer>\n          }\n          trigger='click'\n          placement='topLeft'\n        />\n        <MathQuillStyled\n          onFocus={this.onFocus}\n          onBlur={this.onBlur}\n          style={this.props.style}\n          hasError={isPersistentError}\n          latex={this.props.latex}\n          onEdit={this.onEdit}\n          size={this.props.size}\n          autoCommands='sqrt pi theta phi'\n          autoOperatorNames='diff pdiff curl div unitT unitN unitB cosh sinh tanh arccosh arcsinh arctanh cos sin tan sec csc cot arcsin arccos arctan log ln exp mod abs norm max min'\n        />\n      </MathInputContainer>\n    )\n  }\n\n}\n","export function getErrorMsg(id, prop, ...errorsArray) {\n  // Loop over the errors in order we care about\n  for (const errors of errorsArray) {\n    if (errors[id] && errors[id][prop] ) {\n      return errors[id][prop]\n    }\n  }\n\n  // return a constant empty, so equal by reference\n  return undefined\n\n}\n","import createCachedSelector from 're-reselect'\n\nexport function getMathObjectProp(objectsArray, id, propName) {\n  for (const obj of objectsArray) {\n    if (obj[id] ) {\n      return obj[id][propName]\n    }\n  }\n  throw Error(`id ${id} not found in ${objectsArray}`)\n}\n\n/**\n * Given an object mapping id to name, get set of all names except name\n * corresponding to omittedId\n *\n * @param  {Parser} parser instance\n * @param  {object} mathSymbols\n * @param  {string} mathSymbols[id]\n * @param  {string} omittedId id to omit\n * @returns {set} of names\n */\nexport function calculateUsedNames(parser, mathSymbols, omittedId) {\n  return new Set(Object.keys(mathSymbols).filter(\n    id => id !== omittedId\n  ).map(\n    id => {\n      try { return parser.parse(mathSymbols[id].name).name }\n      catch (err) { return null }\n    }\n  ).filter(name => name !== null))\n}\n\n/**\n * getUsedSymbols: a memoized selector, returns set of symbols used as names in\n * mathObjects, but omitting id of object with id omittedId\n * @param {Parser} parser instance\n * @param {object} mathSymbols\n * @param {string} mathSymbols[id]\n * @param {string} id id of mathObject to omit\n * @returns {Set}\n */\nexport const getUsedNames = createCachedSelector(\n  (parser, mathSymbols, omittedId) => parser,\n  (parser, mathSymbols, omittedId) => mathSymbols,\n  (parser, mathSymbols, omittedId) => omittedId,\n  (parser, mathSymbols, omittedId) => calculateUsedNames(parser, mathSymbols, omittedId)\n)(\n  (parser, mathSymbols, omittedId) => omittedId\n)\n\nexport const getValidateNameAgainst = createCachedSelector(\n  (parser, mathSymbols, id) => parser,\n  (parser, mathSymbols, id) => mathSymbols,\n  (parser, mathSymbols, id) => id,\n  (parser, mathSymbols, id) => ( {\n    usedNames: getUsedNames(parser, mathSymbols, id),\n    latexRHS: mathSymbols[id].value\n  } )\n)(\n  (parser, mathSymbols, id) => id\n)\n","// @flow\nimport React, { PureComponent } from 'react'\nimport MathInput from './components/MathInput'\nimport { connect } from 'react-redux'\nimport { setPropertyAndError } from 'containers/MathObjects/actions'\nimport { parser } from 'constants/parsing'\nimport {\n  isAssignmentLHS,\n  isAssignment,\n  isValidName\n} from './components/validators'\nimport { setError } from 'services/errors'\nimport { getErrorMsg } from 'services/errors/selectors'\nimport { getValidateNameAgainst, getMathObjectProp } from './selectors'\n\nimport type { ErrorData } from 'services/errors'\nimport type { OtherProps } from './components/MathInput'\nimport type { Optionalize, OptionalizeSome } from 'utils/flow'\n\n/**\n * @module MathInputLHS defines a connected version of MathInput for left-hand-\n * side expressions.\n */\n\n type DefaultProps = {|\n   postProcessLaTeX: (string) => string,\n   field: string\n |}\n type OwnProps = {|\n   parentId: string,\n   latex?: string,\n   ...DefaultProps,\n   ...Optionalize<OtherProps>\n |}\nexport type StateProps = {|\n  type: string,\n  validateAgainst: {|\n    usedNames: Set<string>,\n    latexRHS: string\n  |},\n  errorMsg?: string\n|}\nexport type DispatchProps = {|\n  onValidatedTextChange: typeof setPropertyAndError,\n  onValidatorAndErrorChange: typeof setError,\n|}\n\nexport type Props = {|\n  ...OwnProps,\n  ...StateProps,\n  ...DispatchProps\n|}\n\nclass MathInputLHS extends PureComponent<Props> {\n\n  static style = { flex: 0 }\n\n  static validators = [\n    isAssignmentLHS,\n    isValidName,\n    isAssignment\n  ]\n\n  static defaultProps = {\n    postProcessLaTeX: (latex: string) => latex,\n    field: 'name'\n  }\n\n  constructor(props: Props) {\n    super(props)\n    // $FlowFixMe\n    this.onValidatedTextChange = this.onValidatedTextChange.bind(this)\n    // $FlowFixMe\n    this.onValidatorAndErrorChange = this.onValidatorAndErrorChange.bind(this)\n  }\n\n  onValidatedTextChange(latex: string, error: ErrorData) {\n    const { parentId, type, postProcessLaTeX, field } = this.props\n    const processedLaTeX = postProcessLaTeX(latex)\n    this.props.onValidatedTextChange(parentId, type, field, processedLaTeX, error)\n  }\n\n  onValidatorAndErrorChange(error: ErrorData) {\n    const { parentId, field } = this.props\n    this.props.onValidatorAndErrorChange(parentId, field, error)\n  }\n\n  render() {\n\n    const {\n      onValidatorAndErrorChange,\n      onValidatedTextChange,\n      parentId,\n      type,\n      field,\n      ...otherProps\n    } = this.props\n\n    return (\n      <MathInput\n        {...otherProps}\n        field={field}\n        style={MathInputLHS.style}\n        validators={MathInputLHS.validators}\n        onValidatedTextChange={this.onValidatedTextChange}\n        onValidatorAndErrorChange={this.onValidatorAndErrorChange}\n      />\n    )\n  }\n\n}\n\nconst mapStateToProps = ( { mathSymbols, parseErrors, evalErrors, renderErrors }, ownProps) => {\n  const { parentId } = ownProps\n  return {\n    type: getMathObjectProp( [mathSymbols], parentId, 'type'),\n    latex: ownProps.latex\n      ? ownProps.latex\n      : mathSymbols[parentId].name,\n    errorMsg: getErrorMsg(parentId, 'name', parseErrors, evalErrors, renderErrors),\n    validateAgainst: getValidateNameAgainst(parser, mathSymbols, parentId)\n  }\n}\n\nconst mapDispatchToProps = {\n  onValidatedTextChange: setPropertyAndError,\n  onValidatorAndErrorChange: setError\n}\n\ntype ConnectedOwnProps = OptionalizeSome<OwnProps, DefaultProps>\ntype ConnectedProps = OptionalizeSome<Props, DefaultProps>\nexport default connect<ConnectedProps, ConnectedOwnProps, _, _, _, _>(\n  mapStateToProps, mapDispatchToProps\n)(MathInputLHS)\n","// @flow\nimport * as React from 'react'\nimport MathInput from './components/MathInput'\nimport type { OtherProps } from './components/MathInput'\nimport type { Optionalize, OptionalizeSome } from 'utils/flow'\nimport { connect } from 'react-redux'\nimport { setPropertyAndError } from 'containers/MathObjects/actions'\nimport { setError } from 'services/errors'\nimport type { ErrorData } from 'services/errors'\nimport { getErrorMsg } from 'services/errors/selectors'\nimport { getMathObjectProp } from './selectors'\n\n/**\n * @module MathInputRHS defines a connected version of MathInput for right-hand-\n * side expressions.\n */\n\ntype DefaultProps = {|\n  postProcessLaTeX: (string) => string,\n|}\ntype OwnProps = {|\n  field: string,\n  parentId: string,\n  latex?: string,\n  ...DefaultProps,\n  ...Optionalize<OtherProps>\n|}\ntype StateProps = {|\n  type: string,\n  latex?: string,\n  errorMsg?: string\n|}\ntype DispatchProps = {|\n  onValidatedTextChange: typeof setPropertyAndError,\n  onValidatorAndErrorChange: typeof setError,\n|}\ntype Props = {|\n  ...OwnProps,\n  ...StateProps,\n  ...DispatchProps\n|}\n\nclass MathInputRHS extends React.PureComponent<Props> {\n\n  static defaultProps = {\n    postProcessLaTeX: (latex: string) => latex\n  }\n\n  constructor(props: Props) {\n    super(props)\n    // $FlowFixMe\n    this.onValidatedTextChange = this.onValidatedTextChange.bind(this)\n    // $FlowFixMe\n    this.onValidatorAndErrorChange = this.onValidatorAndErrorChange.bind(this)\n  }\n\n  onValidatedTextChange(latex: string, error: ErrorData) {\n    const { parentId, type, postProcessLaTeX, field } = this.props\n    const processedLaTeX = postProcessLaTeX(latex)\n    this.props.onValidatedTextChange(parentId, type, field, processedLaTeX, error)\n  }\n\n  onValidatorAndErrorChange(error: ErrorData) {\n    const { parentId, field } = this.props\n    this.props.onValidatorAndErrorChange(parentId, field, error)\n  }\n\n  render() {\n\n    const {\n      onValidatorAndErrorChange,\n      onValidatedTextChange,\n      parentId,\n      type,\n      ...otherProps\n    } = this.props\n\n    return (\n      <MathInput\n        {...otherProps}\n        onValidatedTextChange={this.onValidatedTextChange}\n        onValidatorAndErrorChange={this.onValidatorAndErrorChange}\n      />\n    )\n  }\n\n}\n\nconst mapStateToProps = ( { mathGraphics, mathSymbols, parseErrors, evalErrors, renderErrors }, ownProps) => {\n  const { parentId, field, prefix } = ownProps\n  const fullLatex: string = ownProps.latex\n    ? ownProps.latex\n    : getMathObjectProp( [mathGraphics, mathSymbols], parentId, field)\n  const latex = prefix && fullLatex.startsWith(prefix)\n    ? fullLatex.slice(prefix.length)\n    : fullLatex\n  return {\n    type: getMathObjectProp( [mathGraphics, mathSymbols], parentId, 'type'),\n    latex,\n    errorMsg: getErrorMsg(parentId, field, parseErrors, evalErrors, renderErrors)\n  }\n}\n\nconst mapDispatchToProps = {\n  onValidatedTextChange: setPropertyAndError,\n  onValidatorAndErrorChange: setError\n}\n\ntype ConnectedOwnProps = OptionalizeSome<OwnProps, DefaultProps>\ntype ConnectedProps = OptionalizeSome<Props, DefaultProps>\nexport default connect<ConnectedProps, ConnectedOwnProps, _, _, _, _>(\n  mapStateToProps, mapDispatchToProps\n)(MathInputRHS)\n","// @flow\nimport * as React from 'react'\nimport { connect } from 'react-redux'\nimport { StaticMathStyled } from './components/MathQuillStyled'\nimport { getMathObjectProp } from './selectors'\n\ntype Props = React.ElementConfig<typeof StaticMathStyled>\ntype OwnProps = {|\n  parentId: string,\n  field: string\n|}\n\nconst mapStateToProps = ( { mathSymbols, mathGraphics }, ownProps) => {\n  const { parentId, field } = ownProps\n  return {\n    latex: getMathObjectProp( [mathGraphics, mathSymbols], parentId, field)\n  }\n}\n\nexport default connect<Props, OwnProps, _, _, _, _>(mapStateToProps)(StaticMathStyled)\n","// @flow\nimport * as React from 'react'\nimport { Switch } from 'antd'\nimport { connect } from 'react-redux'\nimport { setProperty } from 'containers/MathObjects/actions'\nimport type { ExtractReturn } from 'utils/flow'\n\ntype SetProperty = typeof setProperty\n// SwitchProps is missing some props\ntype SwitchProps = {|\n  checkedChildren?: string | React.Node,\n  unCheckedChildren?: string | React.Node,\n  disabled?: boolean,\n  size?: 'default' | 'small'\n|}\ntype OwnProps = {|\n  field: string,\n  disabledField?: string,\n  parentId: string,\n  // Switch OwnProps\n  ...SwitchProps\n|}\ntype StateProps = {|\n  checked: boolean,\n  type: string\n|}\ntype DispatchProps = {|\n  setProperty: SetProperty\n|}\ntype Props = {|\n  ...OwnProps,\n  ...StateProps,\n  ...DispatchProps\n|}\n\nclass _ToggleSwitch extends React.PureComponent<Props> {\n\n  static defaultProps = {\n    disabled: false\n  }\n\n  onChange: (value: boolean) => ExtractReturn<SetProperty>\n\n  constructor(props: Props) {\n    super(props)\n    const { parentId, type, field } = props\n    this.onChange = this.props.setProperty.bind(this, parentId, type, field)\n  }\n\n  render() {\n    const { parentId, type, field, disabledField, setProperty, ...otherProps } = this.props\n    return (\n      <Switch\n        onChange={this.onChange}\n        {...otherProps}\n      />\n    )\n  }\n\n}\n\nconst mapStateToProps = ( { mathGraphics }: any, ownProps: OwnProps) => {\n  const { field, parentId, disabledField, disabled, ...otherProps } = ownProps\n  const inferDisabled = (typeof disabled === 'boolean')\n    ? disabled\n    : mathGraphics[parentId][disabledField]\n\n  return ( {\n    checked: mathGraphics[parentId][field],\n    type: mathGraphics[parentId].type,\n    disabled: inferDisabled,\n    ...otherProps\n  } )\n}\n\nconst mapDispatchToProps = { setProperty }\n\nexport default connect<Props, OwnProps, _, _, _, _>(mapStateToProps, mapDispatchToProps)(_ToggleSwitch)\n","import styled from 'styled-components'\n\nexport default styled.div`\n  position:relative;\n  display:flex;\n  align-items:stretch;\n`\n\nexport const Cell = styled.div`\n  display: flex;\n  flex: 1;\n  align-items:center;\n`\nexport const Label = styled.span`\n  padding-left:5px;\n  padding-right:5px;\n`\n","// @flow\nimport * as React from 'react'\nimport { Switch } from 'antd'\nimport { connect } from 'react-redux'\nimport { setProperty } from 'containers/MathObjects/actions'\n\ntype OwnProps = {|\n  parentId: string,\n|}\ntype StateProps = {|\n  checked: boolean,\n  type: string\n|}\n\ntype DispatchProps = {|\n  setProperty: typeof setProperty\n|}\n\ntype Props = {\n  ...OwnProps,\n  ...StateProps,\n  ...DispatchProps\n}\n\nclass _UseComputedToggle extends React.PureComponent<Props> {\n\n  onChange = (value: boolean) => {\n    const { parentId, type } = this.props\n    this.props.setProperty(parentId, type, 'isZoomEnabled', !value)\n    this.props.setProperty(parentId, type, 'isRotateEnabled', !value)\n    this.props.setProperty(parentId, type, 'isPanEnabled', false)\n    this.props.setProperty(parentId, type, 'useComputed', value)\n  }\n\n  render() {\n    const { parentId, type, setProperty, ...otherProps } = this.props\n    return (\n      <Switch\n        onChange={this.onChange}\n        {...otherProps}\n      />\n    )\n  }\n\n}\n\nconst mapStateToProps = ( { mathGraphics }: any, ownProps: OwnProps) => {\n  const { parentId, ...otherProps } = ownProps\n  return ( {\n    checked: mathGraphics[parentId].useComputed,\n    type: mathGraphics[parentId].type,\n    ...otherProps\n  } )\n}\n\nconst mapDispatchToProps = { setProperty }\n\nexport default connect<Props, OwnProps, _, _, _, _>(mapStateToProps, mapDispatchToProps)(_UseComputedToggle)\n","// @flow\nimport React, { PureComponent } from 'react'\nimport { Camera as CameraGraphic } from 'components/MathBox'\nimport MathGraphic from '../MathGraphic'\nimport MathObjectUI from 'containers/MathObjects/MathObjectUI'\nimport { cameraMeta } from '../metadata'\nimport { MathInputRHS } from 'containers/MathObjects/containers/MathInput'\nimport ToggleSwitch from 'containers/MathObjects/containers/ToggleSwitch'\nimport { MainRow, Cell, Label } from 'containers/MathObjects/components'\nimport UseComputedToggle from './UseComputedToggle'\nimport styled from 'styled-components'\nimport typeof { setProperty } from 'containers/MathObjects/actions'\n\nconst IndentedRow = styled(MainRow)`\n  padding-left:20px;\n  padding-right:30px;\n`\n\nexport const CAMERA = 'CAMERA'\n\ntype Props = {\n  id: string,\n  isRotateEnabled: boolean,\n  isZoomEnabled: boolean,\n  isPanEnabled: boolean,\n  useComputed: boolean,\n  setProperty: setProperty\n}\n\nexport class CameraUI extends PureComponent<Props> {\n\n  render() {\n    const { id } = this.props\n    return (\n      <MathObjectUI\n        type={CAMERA}\n        id={id}\n        metadata={cameraMeta}\n        isDeleteable={false}\n      >\n        <MainRow>\n          <Cell>\n            <Label>User-Controlled Camera:</Label>\n          </Cell>\n        </MainRow>\n        <IndentedRow>\n          <Cell>\n            <Label>Rotate:</Label>\n            <ToggleSwitch\n              parentId={id}\n              field='isRotateEnabled'\n              disabledField='useComputed'\n              size='small'\n              checkedChildren='on'\n              unCheckedChildren='off'\n            />\n          </Cell>\n          <Cell>\n            <Label>Zoom:</Label>\n            <ToggleSwitch\n              parentId={id}\n              field='isZoomEnabled'\n              disabledField='useComputed'\n              size='small'\n              checkedChildren='on'\n              unCheckedChildren='off'\n            />\n          </Cell>\n          <Cell>\n            <Label>Pan:</Label>\n            <ToggleSwitch\n              parentId={id}\n              field='isPanEnabled'\n              disabledField='useComputed'\n              size='small'\n              checkedChildren='on'\n              unCheckedChildren='off'\n            />\n          </Cell>\n        </IndentedRow>\n        <MainRow>\n          <Cell>\n            <Label>Computed Camera:</Label>\n            {/* $FlowFixMe trouble with connect */}\n            <UseComputedToggle\n              parentId={id}\n              size='small'\n              checkedChildren='on'\n              unCheckedChildren='off'\n            />\n          </Cell>\n        </MainRow>\n        <IndentedRow>\n          <Cell>\n            <Label>Position:</Label>\n            <MathInputRHS parentId={this.props.id} field='computedPosition'/>\n          </Cell>\n        </IndentedRow>\n        <IndentedRow>\n          <Cell>\n            <Label>Look At:</Label>\n            <MathInputRHS parentId={this.props.id} field='computedLookAt'/>\n          </Cell>\n        </IndentedRow>\n        <MainRow>\n          <Cell>\n            <Label>\n              Use Orthographic Projection:\n            </Label>\n            <ToggleSwitch\n              parentId={id}\n              field='isOrthographic'\n              size='small'\n              checkedChildren='on'\n              unCheckedChildren='off'\n            />\n          </Cell>\n        </MainRow>\n      </MathObjectUI>\n    )\n  }\n\n}\n\nexport default new MathGraphic( {\n  type: CAMERA,\n  metadata: cameraMeta,\n  uiComponent: CameraUI,\n  mathboxComponent: CameraGraphic\n} )\n","import React from 'react'\nimport PropType from 'prop-types'\n\nfunction eventToPosition(event) {\n  return {\n    x: event.clientX,\n    y: event.clientY\n  }\n}\n\nfunction distance(pointA, pointB) {\n  return Math.sqrt(\n    Math.pow(pointB.x - pointA.x, 2) + Math.pow(pointB.y - pointA.y, 2)\n  )\n}\n\nexport default class LongPressable extends React.PureComponent {\n\n  static propTypes = {\n    onLongPress: PropType.func.isRequired,\n    onShortPress: PropType.func,\n    longPressTime: PropType.number,\n    primaryMouseButtonOnly: PropType.bool,\n    // Maximum distance (pixels) user is allowed to drag before\n    // click is canceled\n    dragThreshold: PropType.number,\n    children: PropType.node\n  }\n\n  static defaultProps = {\n    longPressTime: 500,\n    primaryMouseButtonOnly: true,\n    dragThreshold: 100\n  }\n\n  isLongPressing = false\n  startingPosition = { x: 0, y: 0 }\n\n  onPointerUp = (e) => {\n    if (this.timerID) {\n      this.clearLongPressTimer()\n    }\n\n    const mousePosition = eventToPosition(e)\n\n    if (!this.isLongPressing &&\n        !this.exceedDragThreshold(mousePosition)) {\n      this.props.onShortPress()\n    }\n    else {\n      this.isLongPressing = false\n    }\n  }\n\n  onPointerDown = (e) => {\n    if (this.props.primaryMouseButtonOnly) {\n      if (e.pointerType === 'mouse' && e.button !== 0) {\n        return\n      }\n    }\n\n    this.startingPosition = eventToPosition(e)\n\n    this.timerID = setTimeout(() => {\n      this.isLongPressing = true\n      this.props.onLongPress()\n    }, this.props.longPressTime)\n  }\n\n  onPointerMove = (e) => {\n    const mousePosition = eventToPosition(e)\n    if (this.timerID && this.exceedDragThreshold(mousePosition)) {\n      this.clearLongPressTimer()\n    }\n  }\n\n  onPointerLeave = () => {\n    if (this.timerID) {\n      this.clearLongPressTimer()\n    }\n  }\n\n  clearLongPressTimer() {\n    clearTimeout(this.timerID)\n    this.timerID = null\n  }\n\n  exceedDragThreshold(point) {\n    return distance(this.startingPosition, point) > this.props.dragThreshold\n  }\n\n  // Safari doesn't support pointer events out of the box, and PEPjs\n  // seemed not to work with the longpress behavior desired here.\n  // So we use separate mouse/touch handlers, with touch events calling\n  // prevent default so that mouse events are not called additionally.\n\n  onTouchStart = (event) => {\n    this.onPointerDown(event)\n    event.preventDefault()\n  }\n\n  onTouchMove = (event) => {\n    this.onPointerMove(event)\n    // Don't preventDefault for this one, chrome implements it as passive\n  }\n\n  onTouchEnd = (event) => {\n    this.onPointerUp(event)\n    event.preventDefault()\n  }\n\n  render() {\n    return (\n      <div\n        onMouseUp={this.onPointerUp}\n        onMouseDown={this.onPointerDown}\n        onMouseMove={this.onPointerMove}\n        onMouseOut={this.onPointerLeave}\n        onTouchStart={this.onTouchStart}\n        onTouchEnd={this.onTouchEnd}\n        onTouchMove={this.onTouchMove}\n        className='math3d-longpressable'\n      >\n        {this.props.children}\n      </div>\n    )\n  }\n\n}\n","// @flow\nimport React from 'react'\nimport styled from 'styled-components'\nimport { colorMaps } from 'constants/colors'\n\nconst Color = styled.div`\n  ${props => colorMaps[props.color]\n    ? colorMaps[props.color].css\n    : `background-color: ${props.color}`\n};\n  background-color: ${props => props.color};\n  border-radius: 5px;\n  width: 30px;\n  height: 30px;\n  cursor: pointer;\n  &:hover {\n    border: 1px solid black;\n  }\n`\n\ntype Props = {\n  color: string,\n  style?: string,\n  className?: string,\n  onPickColor: (color: string) => void\n}\n\nexport default class ColorSquare extends React.PureComponent<Props> {\n\n  pickColor = () => {\n    this.props.onPickColor(this.props.color)\n  }\n\n  render() {\n    return (\n      <Color\n        style={this.props.style}\n        className={this.props.className}\n        color={this.props.color}\n        onClick={this.pickColor}\n      />\n    )\n  }\n\n}\n","// @flow\nimport React from 'react'\nimport styled from 'styled-components'\nimport ColorSquare from './ColorSquare'\nimport { colors } from 'constants/colors'\n\nconst Container = styled.div`\n  display: grid;\n  grid-template-columns: repeat(5, 30px);\n  grid-auto-rows: 30px;\n  grid-gap: 5px;\n`\n\ntype Props = {\n  colors: Array<string>,\n  onPickColor: (color: string) => void\n}\n\nexport default class ColorPicker extends React.Component<Props> {\n\n  static defaultProps = {\n    colors: colors\n  }\n\n  onPickColor = (color: string) => {\n    this.props.onPickColor(color)\n  }\n\n  render() {\n    return (\n      <Container>\n        {\n          this.props.colors.map(color =>\n            <ColorSquare\n              color={color}\n              onPickColor={this.onPickColor}\n              key={color}\n            />\n          )}\n      </Container>\n    )\n  }\n\n}\n","// @flow\nimport * as React from 'react'\nimport { Popover, Tabs } from 'antd'\nimport ColorPicker from './ColorPicker'\n\nconst TabPane = Tabs.TabPane\n\ntype Props = {\n  colors?: Array<string>,\n  visible: boolean,\n  onPickColor: (color: string) => void,\n  onHideColorPicker: () => void,\n  children: React.Node,\n  extraTabs?: React.Node\n}\n\nexport default class ColorPickerPopover extends React.Component<Props> {\n\n  _containerRef: { current: null | HTMLDivElement }\n\n  constructor(props: Props) {\n    super(props)\n    this._containerRef = React.createRef()\n    // $FlowFixMe\n    this.getContainerRef = this.getContainerRef.bind(this)\n  }\n\n  getContent() {\n    return this.props.extraTabs\n      ? (\n        <Tabs>\n          <TabPane tab='Colors' key='colors'>\n            <ColorPicker\n              colors={this.props.colors}\n              onPickColor={this.props.onPickColor}\n            />\n          </TabPane>\n          {this.props.extraTabs}\n        </Tabs>\n      )\n      : (\n        <ColorPicker\n          colors={this.props.colors}\n          onPickColor={this.props.onPickColor}\n        />\n      )\n  }\n\n  getContainerRef() {\n    // in rare cases, body can be null\n    if (document.body === null) {\n      throw new Error('document.body is null.')\n    }\n    // return body as default in case containing div hasn't rendered yet\n    return this._containerRef.current || document.body\n  }\n\n  handleVisibleChange = (visible: boolean) => {\n    if (!visible) {\n      this.props.onHideColorPicker()\n    }\n  }\n\n  render() {\n    return (\n      <div\n        style={{ position: 'relative' }}\n        ref={this._containerRef}\n      >\n        <Popover\n          placement='right'\n          trigger='click'\n          content={this.getContent()}\n          visible={this.props.visible}\n          onVisibleChange={this.handleVisibleChange}\n          getPopupContainer={this.getContainerRef}\n        >\n          {this.props.children}\n        </Popover>\n      </div>\n    )\n  }\n\n}\n","// @flow\nimport * as React from 'react'\nimport styled from 'styled-components'\nimport LongPressable from 'components/LongPressable'\nimport ColorPickerPopover from './components/ColorPickerPopover'\nimport { colorMaps } from 'constants/colors'\n\nconst Circle = styled.div`\n  width: 30px;\n  height: 30px;\n  border-radius:30px;\n  cursor: pointer;\n  display: flex;\n  justify-content: center;\n  align-items:center;\n  cursor: pointer;\n  background-color: ${props => props.color};\n  ${props => props.gradient};\n`\nconst InnerCircle = styled.div`\n  width: 26px;\n  height: 26px;\n  border-radius: 26px;\n  background-color: ${props => props.isFilled ? 'rgba(0, 0, 0, 0)' : 'white'};\n  display: flex;\n  justify-content: center;\n  align-items:center;\n  pointer-events:none;\n`\n\ntype Props = {\n  isFilled: boolean,\n  onToggleVisibility: () => void,\n  color: string,\n  onPickColor: (color: string) => void,\n  colors?: Array<string>,\n  extraTabs?: React.Node\n}\n\ntype State = {\n  displayColorPicker: boolean\n}\n\nexport default class StatusSymbol extends React.PureComponent<Props, State> {\n\n  state = {\n    displayColorPicker: false\n  }\n\n  showColorPicker = () => {\n    this.setState( { displayColorPicker: true } )\n  }\n\n  hideColorPicker = () => {\n    this.setState( { displayColorPicker: false } )\n  }\n\n  render() {\n    const { color } = this.props\n    const gradient = colorMaps[color] && colorMaps[color].css\n\n    return (\n      <ColorPickerPopover\n        extraTabs={this.props.extraTabs}\n        colors={this.props.colors}\n        color={color}\n        visible={this.state.displayColorPicker}\n        onPickColor={this.props.onPickColor}\n        onHideColorPicker={this.hideColorPicker}\n      >\n        <LongPressable\n          onLongPress={this.showColorPicker}\n          onShortPress={this.props.onToggleVisibility}\n        >\n          <Circle\n            color={color}\n            gradient={gradient}\n          >\n            <InnerCircle isFilled={this.props.isFilled}/>\n          </Circle>\n        </LongPressable>\n      </ColorPickerPopover>\n    )\n  }\n\n}\n","import React, { PureComponent } from 'react'\nimport PropTypes from 'prop-types'\nimport { ScopeEvaluator, Parser } from 'utils/mathParsing'\nimport { EvalErrorData } from 'services/errors'\n\nconst MathScopeContext = React.createContext()\n\nexport class MathScopeProvider extends PureComponent {\n\n  static propTypes = {\n    parser: PropTypes.instanceOf(Parser).isRequired,\n    scopeEvaluator: PropTypes.instanceOf(ScopeEvaluator).isRequired,\n    idsByName: PropTypes.objectOf(PropTypes.string).isRequired,\n    allSymbolIds: PropTypes.arrayOf(PropTypes.string).isRequired,\n    scope: PropTypes.object.isRequired,\n    scopeDiff: PropTypes.object.isRequired,\n    errors: PropTypes.object.isRequired,\n    errorsDiff: PropTypes.object.isRequired,\n    children: PropTypes.oneOfType( [\n      PropTypes.arrayOf(PropTypes.node),\n      PropTypes.node\n    ] ).isRequired,\n    setError: PropTypes.func.isRequired\n  }\n\n  componentDidUpdate(prevProps) {\n    const { errors, idsByName, setError, errorsDiff, allSymbolIds } = this.props\n    const symbolIds = new Set(allSymbolIds);\n    // delete old errors if no longer present\n    // Need to use previous idsByName prop in case\n    // the variable got deleted or its name has changed\n    // Note: if name changed, we might be re-adding the error below\n    // Note: idsByName only includes uniquely named symbol ids.\n    const prevIdsByName = prevProps.idsByName\n    errorsDiff.deleted\n      .filter(name => {\n        // check that the symbol still exists; if it was deleted, we do not need to unset the error\n        return symbolIds.has(prevIdsByName[name])\n      })\n      .forEach(name => {\n        const errorData = new EvalErrorData(null)\n        setError(prevIdsByName[name], 'value', errorData)\n      } )\n\n    // add in the new errors\n    const errorsToDispatch = [...errorsDiff.added, ...errorsDiff.updated]\n    errorsToDispatch.forEach(name => {\n      const errorData = new EvalErrorData(errors[name].message)\n      setError(idsByName[name], 'value', errorData)\n    } )\n\n  }\n\n  render() {\n    const { scope, scopeDiff } = this.props\n    return (\n      <MathScopeContext.Provider\n        value={{ scope, scopeDiff }}\n      >\n        {this.props.children}\n      </MathScopeContext.Provider>\n    )\n  }\n\n}\n\nexport const MathScopeConsumer = MathScopeContext.Consumer\n","export const VARIABLE_SLIDER = 'VARIABLE_SLIDER'\nexport const defaultValue = 0 // slider value, used by slider reducer\nexport const defaultSettings = {\n  type: VARIABLE_SLIDER,\n  name: 'T',\n  value: null, // used as valueText ... consider renaming this key\n  min: '-5',\n  max: '5',\n  description: 'Variable Slider',\n  isAnimating: false,\n  speedMultiplier: 1\n}\n","import React, { Fragment } from 'react'\nimport PropTypes from 'prop-types'\nimport {\n  MathInputLHS,\n  MathInputRHS,\n  StaticMathStyled\n} from 'containers/MathObjects/containers/MathInput'\n\nSliderValueDisplay.propTypes = {\n  parentId: PropTypes.string.isRequired,\n  valueText: PropTypes.string.isRequired\n}\n\nconst valueStyle = { flex: 0, width: '50px' }\n\nexport default function SliderValueDisplay(props) {\n  return (\n    <Fragment>\n      <MathInputLHS\n        parentId={props.parentId}\n      />\n      <StaticMathStyled\n        latex='='\n      />\n      <MathInputRHS\n        field='value'\n        style={valueStyle}\n        parentId={props.parentId}\n        latex={props.valueText}\n      />\n    </Fragment>\n  )\n}\n","// @flow\nimport { EvalErrorData, setError } from 'services/errors'\nimport type { Scope, Parser, Symbols } from 'utils/mathParsing'\ntype SetError = typeof setError\n\n// TODO test this\nexport function evalData(\n  parser: Parser,\n  data: Symbols,\n  scope: Scope\n) {\n  const initial = { evalErrors: {}, evaluated: {}, parseErrors: {} }\n  return Object.keys(data).reduce((acc, prop) => {\n    try {\n      const parsed = parser.parse(data[prop] )\n      try {\n        acc.evaluated[prop] = parsed.eval(scope)\n        return acc\n      }\n      catch (evalError) {\n        acc.evalErrors[prop] = evalError\n        return acc\n      }\n    }\n    catch (parseError) {\n      acc.parseErrors[prop] = parseError\n      return acc\n    }\n  }, initial)\n}\n\nexport function handleEvalErrors(\n  id: string,\n  newErrors: { [propName: string]: Error },\n  existingErrors: { [propName: string]: string },\n  setError: SetError\n) {\n  // Remove old errors\n  Object.keys(existingErrors).forEach((prop) => {\n    if (newErrors[prop]===undefined) {\n      setError(id, prop, new EvalErrorData(null))\n    }\n  } )\n  // Add new Errors\n  Object.keys(newErrors).forEach((prop) => {\n    const { message } = newErrors[prop]\n    setError(id, prop, new EvalErrorData(message))\n  } )\n}\n\nexport function filterObject(superObject: Object, keys: Array<string>) {\n  return keys.reduce((acc, key) => {\n    acc[key] = superObject[key]\n    return acc\n  }, {} )\n}\n","// @flow\nimport React, { PureComponent } from 'react'\nimport { Slider } from 'antd'\nimport type { Scope, Parser } from 'utils/mathParsing'\nimport {\n  evalData,\n  handleEvalErrors\n} from 'services/evalData'\nimport typeof { setError as SetError } from 'services/errors'\n\ntype Props = {\n  parentId: string,\n  value: string,\n  min: string,\n  max: string,\n  onSliderChange: (value: number) => void,\n  scope: Scope,\n  parser: Parser,\n  ownEvalErrors: { [prop: string]: string },\n  setError: SetError\n}\n\ntype State = {\n  min: number,\n  max: number,\n  value: number\n}\n\ntype NewErrors = {\n  min?: Error,\n  max?: Error,\n  value?: Error\n}\nexport default class EvaluatedSlider extends PureComponent<Props, State> {\n\n  // Stores the last valid evaluation result\n  state = {\n    min: -10,\n    max: -10,\n    value: 0\n  }\n\n  static computedProps = ['min', 'max', 'value']\n\n  static getDerivedStateFromProps(props: Props, state: State) {\n    const { parser, parentId, scope, ownEvalErrors, setError, min, max, value } = props\n    const needsEval = { min, max, value }\n    const result = evalData(parser, needsEval, scope)\n    const { evaluated } = result\n    const newErrors: NewErrors = result.evalErrors\n    Object.keys(evaluated).forEach(prop => {\n      if (typeof evaluated[prop] !== 'number') {\n        delete evaluated[prop]\n        newErrors[prop] = TypeError(`'${prop}' must be a number.`)\n      }\n    } )\n\n    // Validate some stuff\n    const newState = { ...state, ...evaluated }\n    if (newState.min > newState.max) {\n      newErrors.min = newErrors.min || TypeError(`Range Error: 'min' (${newState.min}) cannot be greater than  'max' (${newState.max})`)\n      newErrors.max = newErrors.max || TypeError(`Range Error: 'max' (${newState.max}) cannot be less than 'min' (${newState.min})`)\n      delete newState.min\n      delete newState.max\n    }\n    else if (newState.min === newState.max) {\n      newErrors.min = newErrors.min || TypeError(`Range Error: 'min' (${newState.min}) cannot equal 'max' (${newState.max})`)\n      newErrors.max = newErrors.max || TypeError(`Range Error: 'max' (${newState.max}) cannot equal 'min' (${newState.min})`)\n      delete newState.min\n      delete newState.max\n    }\n\n    handleEvalErrors(parentId, newErrors, ownEvalErrors, setError)\n    return newState\n  }\n\n  constructor(props: Props) {\n    super(props)\n    // $FlowFixMe\n    this.incrementByFraction = this.incrementByFraction.bind(this)\n  }\n\n  incrementByFraction(fraction: number) {\n    const { min, max, value } = this.state\n    const amount = value + (max - min) * fraction\n    if (amount < max) {\n      this.props.onSliderChange(amount)\n    }\n    else {\n      this.props.onSliderChange(min)\n    }\n  }\n\n  render() {\n    const { min, max, value } = this.state\n    const step = (max - min)/100\n    return (\n      <div style={ { flex: 1 } }>\n        <Slider\n          // if min>max, onChange can enter an infinite loop\n          min={min}\n          max={max}\n          tipFormatter={null}\n          value={value}\n          step={step}\n          onChange={this.props.onSliderChange}\n        />\n      </div>\n    )\n  }\n\n}\n","// @flow\nimport React, { PureComponent } from 'react'\nimport { Button, Icon } from 'antd'\nimport styled from 'styled-components'\n\nwindow.timers = {}\n\nconst AnimationControlsContainer = styled.div`\n  display: flex;\n  flex: 1;\n  align-items:center;\n  justify-content: space-around;\n`\n\nconst AnimationButton = styled(Button)`\n  border-color: ${props => props.theme.gray[2]};\n  color: ${props => props.theme.gray[5]};\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  & i {\n    color: ${props => props.theme.gray[5]};\n    font-size:100%;\n  }\n`\n\nconst speedDisplay = { cursor: 'default' }\n// weird bug: Button.Group seems to display differently in\n// development vs production build. why??\n// groupStyle seems to fix it.\nconst groupStyle = { display: 'flex' }\n\ntype Props = {\n  isAnimating: boolean,\n  baseAnimationDuration: number,\n  speedMultiplier: number,\n  fps: number,\n  incrementByFraction: (fraction: number) => void,\n  setProperty: (property: string, value: any) => void\n}\n\nconst speedValues = [\n  1/16,\n  1/8,\n  1/4,\n  1/2,\n  3/4,\n  1,\n  1.5,\n  2,\n  3,\n  4,\n  8\n]\nconst speedDisplays = {\n  [1/16]: '1/16',\n  [1/8]: '1/8',\n  [1/4]: '1/4',\n  [1/2]: '1/2',\n  [3/4]: '3/4',\n  '1': '1',\n  '1.5': '1.5',\n  '2': '2',\n  '3': '3',\n  '4': '4',\n  '8': '8'\n}\n\nexport default class AnimationControls extends PureComponent<Props> {\n\n  _interval: IntervalID // eslint-disable-line no-undef\n\n  static defaultProps = {\n    fps: 60,\n    baseAnimationDuration: 4\n  }\n\n  constructor(props: Props) {\n    super(props)\n    // $FlowFixMe\n    this.startAnimation = this.startAnimation.bind(this)\n    // $FlowFixMe\n    this.stopAnimation = this.stopAnimation.bind(this)\n    // $FlowFixMe\n    this.incrementSpeed = this.incrementSpeed.bind(this)\n    // $FlowFixMe\n    this.decrementSpeed = this.decrementSpeed.bind(this)\n  }\n\n  startAnimation() {\n    this.props.setProperty('isAnimating', true)\n    const { baseAnimationDuration, fps, speedMultiplier } = this.props\n    const duration = baseAnimationDuration/speedMultiplier\n    const delay = 1/fps // delay in SECONDS !\n    const delayMs = delay * 1000 // delay in ms\n    const fractionalStepSize = delay/duration // inverse of numSteps = duration/delay\n    const incrementByFraction = this.props.incrementByFraction\n    this._interval = setInterval(\n      () => incrementByFraction(fractionalStepSize),\n      delayMs\n    )\n  }\n\n  stopAnimation() {\n    this.props.setProperty('isAnimating', false)\n    clearInterval(this._interval)\n  }\n\n  canIncrement() {\n    return this.props.speedMultiplier !== speedValues[speedValues.length - 1]\n  }\n  incrementSpeed() {\n    const index = speedValues.indexOf(this.props.speedMultiplier)\n    const newIndex = Math.min(index + 1, speedValues.length)\n    const newSpeed = speedValues[newIndex]\n    this.props.setProperty('speedMultiplier', newSpeed)\n    if (this.props.isAnimating) {\n      this.stopAnimation()\n      this.startAnimation()\n    }\n  }\n\n  canDecrement() {\n    return this.props.speedMultiplier !== speedValues[0]\n  }\n  decrementSpeed() {\n    const index = speedValues.indexOf(this.props.speedMultiplier)\n    const newIndex = Math.max(index - 1, 0)\n    const newSpeed = speedValues[newIndex]\n    this.props.setProperty('speedMultiplier', newSpeed)\n    if (this.props.isAnimating) {\n      this.stopAnimation()\n      this.startAnimation()\n    }\n  }\n\n  componentDidMount() {\n    if (this.props.isAnimating) {\n      this.startAnimation()\n    }\n  }\n\n  componentWillUnmount() {\n    clearInterval(this._interval)\n  }\n\n  render() {\n    const { speedMultiplier } = this.props\n    return (\n      <AnimationControlsContainer>\n        <AnimationButton\n          shape='circle'\n          size='small'\n          value={this.props.isAnimating}\n          onClick={e => {\n            // e.target.value is a string, so convert to bool:\n            if (e.currentTarget.value === 'false') {\n              this.startAnimation()\n            }\n            else {\n              this.stopAnimation()\n            }\n          } }\n        >\n          <Icon type={\n            this.props.isAnimating\n              ? 'pause'\n              : 'caret-right'\n          } />\n        </AnimationButton>\n        <Button.Group size='small' style={groupStyle}>\n          <AnimationButton\n            onClick={this.decrementSpeed}\n            disabled={!this.canDecrement()}\n          >\n            <Icon type=\"backward\" />\n          </AnimationButton>\n          <AnimationButton disabled={true} style={speedDisplay}>\n            {speedDisplays[speedMultiplier]}\n            <Icon type=\"close\" style={ { fontSize: '75%' } } />\n          </AnimationButton>\n          <AnimationButton\n            onClick={this.incrementSpeed}\n            disabled={!this.canIncrement()}\n          >\n            <Icon type=\"forward\" />\n          </AnimationButton>\n        </Button.Group>\n        <Button.Group size='small' style={groupStyle}>\n          <AnimationButton\n            onClick={() => this.props.incrementByFraction(-0.01)}\n          >\n            <Icon type=\"minus\" />\n          </AnimationButton>\n          <AnimationButton\n            onClick={() => this.props.incrementByFraction(+0.01)}\n          >\n            <Icon type=\"plus\" />\n          </AnimationButton>\n        </Button.Group>\n      </AnimationControlsContainer>\n\n    )\n  }\n\n}\n","// @flow\nimport type { Scope } from 'utils/mathParsing/MathExpression'\nimport typeof { setError as SetError } from 'services/errors'\nimport React, { PureComponent } from 'react'\nimport MathObjectUI from 'containers/MathObjects/MathObjectUI'\nimport {\n  MainRow\n} from 'containers/MathObjects/components'\nimport { VARIABLE_SLIDER } from '../metadata'\nimport SliderValueDisplay from './SliderValueDisplay'\nimport EvaluatedSlider from './EvaluatedSlider'\nimport AnimationControls from './AnimationControls'\nimport { MathInputRHS } from 'containers/MathObjects/containers/MathInput'\nimport { MathScopeConsumer } from 'containers/MathScopeContext'\nimport { parser } from 'constants/parsing'\nimport typeof {\n  setProperty as SetProperty\n} from 'containers/MathObjects/actions'\n\nconst limitStyle = { flex: 0 }\n\ntype Props = {\n  setProperty: SetProperty,\n  id: string,\n  isAnimating: bool,\n  fps: number,\n  baseAnimationDuration: number,\n  speedMultiplier: number,\n  value: number,\n  manualValue?: string, // entered in MathQuill by user\n  min: string,\n  max: string,\n  setSliderValue: (id: string, value: number, previousValueIsManual: bool) => void,\n  ownEvalErrors: {},\n  setError: SetError\n}\n\nexport default class VariableSlider extends PureComponent<Props> {\n\n  _evaluatedSlider: ?EvaluatedSlider\n\n  static defaultProps = {\n    isAnimating: false,\n    fps: 30,\n    baseAnimationDuration: 4,\n    speedMultiplier: 1\n  }\n\n  constructor(props: Props) {\n    super(props)\n    // $FlowFixMe\n    this.setProperty = this.setProperty.bind(this)\n    // $FlowFixMe\n    this.onSliderChange = this.onSliderChange.bind(this)\n    // $FlowFixMe\n    this.renderSlider = this.renderSlider.bind(this)\n  }\n\n  setProperty(property: string, value: any) {\n    this.props.setProperty(this.props.id, VARIABLE_SLIDER, property, value)\n  }\n\n  onSliderChange(value: number) {\n    const { id, manualValue } = this.props\n    const previousValueIsManual = manualValue !== null\n    this.props.setSliderValue(id, value, previousValueIsManual)\n  }\n\n  componentDidMount() {\n    // Force re-render once this._evaluatedSlider has been assigned\n    this.forceUpdate()\n  }\n\n  static getLaTeX(manualValue: ?string, value: number, numDigits: ?number) {\n    if (manualValue !== null && manualValue !== undefined) {\n      return manualValue\n    }\n    return numDigits ? value.toFixed(numDigits) : value.toString()\n  }\n\n  render() {\n    const {\n      id,\n      value,\n      manualValue\n    } = this.props\n    const valueText = VariableSlider.getLaTeX(manualValue, value, 2)\n    return (\n      <MathObjectUI\n        id={id}\n        type={VARIABLE_SLIDER}\n      >\n        <MainRow>\n          <SliderValueDisplay\n            parentId={id}\n            valueText={valueText}\n          />\n          {this._evaluatedSlider &&\n            <AnimationControls\n              setProperty={this.setProperty}\n              isAnimating={this.props.isAnimating}\n              speedMultiplier={this.props.speedMultiplier}\n              incrementByFraction={this._evaluatedSlider.incrementByFraction}\n            />\n          }\n        </MainRow>\n        <MainRow>\n          <MathInputRHS\n            parentId={id}\n            style={limitStyle}\n            field='min'\n          />\n          <MathScopeConsumer>\n            {this.renderSlider}\n          </MathScopeConsumer>\n          <MathInputRHS\n            parentId={id}\n            style={limitStyle}\n            field='max'\n          />\n        </MainRow>\n      </MathObjectUI>\n    )\n  }\n\n  renderSlider( { scope }: { scope: Scope } ) {\n    const { manualValue, value } = this.props\n    const valueText = VariableSlider.getLaTeX(manualValue, value)\n\n    return (\n      <EvaluatedSlider\n        ref={ref => { this._evaluatedSlider = ref }}\n        parentId={this.props.id}\n        value={valueText}\n        min={this.props.min}\n        max={this.props.max}\n        onSliderChange={this.onSliderChange}\n        scope={scope}\n        parser={parser}\n        ownEvalErrors={this.props.ownEvalErrors}\n        setError={this.props.setError}\n      />\n    )\n  }\n\n}\n","// @flow\nimport type { Dispatch } from 'redux'\nimport { MathSymbol } from 'containers/MathObjects/MathObject'\nimport VariableSlider from './components/VariableSlider'\nimport { connect } from 'react-redux'\nimport { setPropertyAndError, setProperty } from 'containers/MathObjects/actions'\nimport { setSliderValue } from './actions'\nimport { ParseErrorData, setError } from 'services/errors'\nimport { defaultSettings, VARIABLE_SLIDER } from './metadata'\n\nconst mapStateToProps = ( { mathSymbols, sliderValues, evalErrors }, ownProps) => {\n  const { id } = ownProps\n  const mathSymbol = mathSymbols[id]\n  return {\n    name: mathSymbol.name,\n    value: sliderValues[id], // number\n    manualValue: mathSymbol.value, // nullable string\n    min: mathSymbol.min,\n    max: mathSymbol.max,\n    ownEvalErrors: evalErrors[id],\n    isAnimating: mathSymbol.isAnimating,\n    speedMultiplier: mathSymbol.speedMultiplier\n  }\n}\n\nconst mapDispatchToProps = (dispatch: Dispatch<*>) => ( {\n  setProperty: (id, type, property, value) => dispatch(setProperty(id, type, property, value)),\n  setError: (id, property, errorData) => dispatch(setError(id, property, errorData)),\n  setSliderValue: (id, value, previousValueIsManual) => {\n    // set the slider value\n    dispatch(setSliderValue(id, value))\n    // reset valueText and clear parse errors if necessary\n    if (previousValueIsManual) {\n      const error = new ParseErrorData()\n      dispatch(setPropertyAndError(id, VARIABLE_SLIDER, 'value', null, error))\n    }\n  }\n} )\n\nexport default new MathSymbol( {\n  type: VARIABLE_SLIDER,\n  defaultSettings: defaultSettings,\n  uiComponent: connect(mapStateToProps, mapDispatchToProps)(VariableSlider)\n} )\n\nexport { VARIABLE_SLIDER }\n","export const SET_SLIDER_VALUE = 'SET_SLIDER_VALUE'\n\nexport function setSliderValue(id, value) {\n  return {\n    type: SET_SLIDER_VALUE,\n    payload: { id, value }\n  }\n}\n","import VariableSlider from 'containers/MathObjects/MathSymbols/VariableSlider'\nimport memoizeOne from 'memoize-one'\n\nfunction _getParseableSymbols(parser, mathSymbols, sliderValues) {\n  const initial = {\n    symbols: {},\n    idsByName: {},\n    allSymbolIds: Object.keys(mathSymbols),\n  }\n  const seen = new Set()\n  return Object.keys(mathSymbols).reduce((acc, id) => {\n    const { name: lhs, value, type } = mathSymbols[id]\n    const expr = (value === null && type === VariableSlider.type)\n      ? `${lhs}=${sliderValues[id]}`\n      : `${lhs}=${value}`\n\n    // for functions, redux name is f(x) not f, we want f\n    // TODO: change redux key to lhs and rhs\n\n    let name\n    try { name = parser.parse(expr).name }\n    catch (err) { return acc /* handled in parseErrors already */ }\n\n    // we only want symbols with unique names\n    if (seen.has(name)) {\n      delete acc.symbols[name]\n      delete acc.idsByName[name]\n    }\n    else {\n      seen.add(name)\n      acc.symbols[name] = expr\n      acc.idsByName[name] = id\n    }\n    return acc\n\n  }, initial)\n\n}\n\nexport const getParseableSymbols = memoizeOne(_getParseableSymbols)\n","import { MathScopeProvider } from './components/MathScopeContext'\nimport { connect } from 'react-redux'\nimport { getParseableSymbols } from './selectors'\nimport { setError } from 'services/errors'\nexport { MathScopeConsumer } from './components/MathScopeContext'\n\n// TODO: This updates when it does not need to because of parseErrors\nconst mapStateToProps = ( { mathSymbols, sliderValues }, ownProps) => {\n  const { symbols, idsByName, allSymbolIds } = getParseableSymbols(ownProps.parser, mathSymbols, sliderValues)\n  const evaluationResult = ownProps.scopeEvaluator.evalScope(symbols)\n  window.evaluationResult = evaluationResult\n  return {\n    idsByName,\n    allSymbolIds,\n    ...evaluationResult\n  }\n}\n\nconst mapDispatchToProps = { setError }\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MathScopeProvider)\n","// @flow\nimport * as React from 'react'\nimport StatusSymbol from './StatusSymbol'\nimport type { Scope, Parser } from 'utils/mathParsing'\nimport { MathScopeConsumer } from 'containers/MathScopeContext'\nimport typeof {\n  toggleProperty,\n  setProperty\n} from 'containers/MathObjects/actions'\nimport { parser } from 'constants/parsing'\n\nexport type DefaultProps = {|\n  parser: Parser\n|}\nexport type OwnProps = {|\n  ...DefaultProps,\n  id: string,\n  extraTabs?: React.Node,\n  colors?: Array<string>,\n|}\ntype StateProps = {|\n  color: string,\n  visible: boolean,\n  useCalculatedVisibility: boolean,\n  type: string,\n  calculatedVisibility: string\n|}\ntype DispatchProps = {|\n  toggleProperty: toggleProperty,\n  setProperty: setProperty,\n|}\nexport type Props = {|\n  ...OwnProps,\n  ...StateProps,\n  ...DispatchProps,\n|}\n\nexport default class EvaluatedStatusSymbol extends React.PureComponent<Props> {\n\n  static defaultProps = { parser }\n\n  onToggleVisibility = () => {\n    const { id, type } = this.props\n    this.props.toggleProperty(id, type, 'visible')\n  }\n\n  onPickColor = (value: string) => {\n    const { id, type } = this.props\n    this.props.setProperty(id, type, 'color', value)\n  }\n\n  renderStatusSymbol = ( { scope }: { scope: Scope } ) => {\n    const {\n      calculatedVisibility,\n      useCalculatedVisibility,\n      visible,\n      parser\n    } = this.props\n    let trueVisibility\n    if (useCalculatedVisibility && calculatedVisibility !== '') {\n      try {\n        trueVisibility = Boolean(parser.parse(calculatedVisibility).eval(scope))\n      }\n      catch (err) {\n        trueVisibility = visible\n      }\n    }\n    else {\n      trueVisibility = visible\n    }\n    return (\n      <StatusSymbol\n        extraTabs={this.props.extraTabs}\n        colors={this.props.colors}\n        color={this.props.color}\n        isFilled={trueVisibility}\n        onToggleVisibility={this.onToggleVisibility}\n        onPickColor={this.onPickColor}\n      />\n    )\n  }\n\n  render() {\n    return (\n      <MathScopeConsumer>\n        {this.renderStatusSymbol}\n      </MathScopeConsumer>\n    )\n  }\n\n}\n","// @flow\nimport type { OptionalizeSome } from 'utils/flow'\nimport EvaluatedStatusSymbol from './components/EvaluatedStatusSymbol'\nimport type { Props, OwnProps, DefaultProps } from './components/EvaluatedStatusSymbol'\nimport {\n  toggleProperty,\n  setProperty\n} from 'containers/MathObjects/actions'\n\n// For connecting\nimport { connect } from 'react-redux'\n\nconst mapStateToProps = ( { mathGraphics }, ownProps) => {\n  const { id } = ownProps\n  const {\n    color,\n    visible,\n    useCalculatedVisibility,\n    calculatedVisibility,\n    type\n  } = mathGraphics[id]\n  return {\n    color,\n    visible,\n    useCalculatedVisibility,\n    calculatedVisibility,\n    type\n  }\n}\n\nconst mapDispatchToProps = {\n  toggleProperty,\n  setProperty\n}\n\ntype ConnectedProps = OptionalizeSome<Props, DefaultProps>\ntype ConnectedOwnProps = OptionalizeSome<OwnProps, DefaultProps>\n\nexport default connect<ConnectedProps, ConnectedOwnProps, _, _, _, _>(\n  mapStateToProps, mapDispatchToProps\n)(EvaluatedStatusSymbol)\n","import React from 'react'\nimport styled from 'styled-components'\nimport SubtleButton from 'components/SubtleButton'\nimport { Icon } from 'antd'\n\nconst StyledSettingsButton = styled(SubtleButton)`\n  width:30px;\n  height:30px;\n  display:flex;\n  justify-content:center;\n  align-items:center;\n  font-size:150%;\n  color: ${props => props.theme.gray[5]};\n`\n\nexport default function SettingsButton(props) {\n  return (\n    <StyledSettingsButton {...props}>\n      <Icon\n        type='setting'\n      />\n    </StyledSettingsButton>\n  )\n}\n","import React, { PureComponent } from 'react'\nimport SettingsButton from './SettingsButton'\nimport { Popover, Icon } from 'antd'\nimport PropTypes from 'prop-types'\nimport styled from 'styled-components'\nimport SubtleButton from 'components/SubtleButton'\nconst TitleBar = styled.div`\n  display: flex;\n  justify-content: space-between;\n`\nconst CloseButton = styled(SubtleButton)`\n  width:30px;\n  height:30px;\n`\n\nexport default class SettingsContainer extends PureComponent {\n\n  static propTypes = {\n    title: PropTypes.string.isRequired,\n    children: PropTypes.oneOfType( [\n      PropTypes.string,\n      PropTypes.node,\n      PropTypes.arrayOf(PropTypes.node)\n    ] ).isRequired\n  }\n\n  state = {\n    isVisible: false\n  }\n\n  handleVisibleChange = (isVisible) => {\n    this.setState( { isVisible } )\n  }\n\n  closePopover = () => {\n    this.setState( { isVisible: false } )\n  }\n\n  render() {\n    return (\n      <Popover\n        content={this.props.children}\n        title={\n          <TitleBar>\n            <h3>{this.props.title}</h3>\n            <CloseButton onClick={this.closePopover}>\n              <Icon type=\"close\" />\n            </CloseButton>\n          </TitleBar>\n        }\n        trigger='click'\n        placement='right'\n        visible={this.state.isVisible}\n        onVisibleChange={this.handleVisibleChange}\n      >\n        <SettingsButton />\n      </Popover>\n    )\n  }\n\n}\n","// @flow\nimport * as React from 'react'\nimport styled from 'styled-components'\nimport { MathInputRHS } from 'containers/MathObjects/containers/MathInput'\nimport { Input, Switch } from 'antd'\nimport type { InputType } from 'containers/MathObjects/MathGraphics/types'\n\nexport type FormRow = {\n  inputType: InputType,\n  property: string,\n  label: string,\n  allowEmpty?: boolean\n}\n\n// TODO: don't use any\ntype Props = {\n  parentId: string,\n  data: any,\n  settingsList: Array<FormRow>,\n  setProperty: (property: string, value: any) => void\n}\n\nconst Grid = styled.div`\n  display: grid;\n  grid-template-columns: minmax(100px, 1fr) minmax(100px, 1fr);\n  grid-gap: 10px;\n`\n\nconst Label = styled.span`\n  color: ${props => props.theme.gray[6]};\n  justify-self: end;\n  text-align: justify;\n  direction: rtl;\n`\n\nconst switchStyle = { width: 40 }\n\nexport default class SettingsContent extends React.PureComponent<Props> {\n\n  constructor(props: Props) {\n    super(props)\n    // $FlowFixMe\n    this.renderRow = this.renderRow.bind(this)\n    // $FlowFixMe\n    this.renderInput = this.renderInput.bind(this)\n  }\n\n  renderRow(formRow: FormRow) {\n    const { property, label, inputType, allowEmpty } = formRow\n\n    return (\n      <React.Fragment key={property}>\n        <Label>{label}</Label>\n        {this.renderInput(property, inputType, allowEmpty)}\n      </React.Fragment>\n    )\n  }\n\n  renderInput(property: string, inputType: InputType, allowEmpty?: boolean) {\n    switch (inputType) {\n\n      case 'text': {\n        return (\n          <Input\n            value={this.props.data[property]}\n            onChange={event => this.props.setProperty(property, event.currentTarget.value)}\n          />\n        )\n      }\n      case 'boolean': {\n        return (\n          <Switch\n            style={switchStyle}\n            size='small'\n            checked={this.props.data[property]}\n            onChange={value => this.props.setProperty(property, value)}\n          />\n        )\n      }\n      case 'math': {\n        return (\n          <MathInputRHS\n            size='small'\n            allowEmpty={allowEmpty}\n            parentId={this.props.parentId}\n            field={property}\n          />\n        )\n      }\n      default: {\n        throw Error(`Settings inputType: ${inputType} not recognized`)\n      }\n\n    }\n\n  }\n\n  render() {\n    return (\n      <Grid>\n        {this.props.settingsList.map(this.renderRow)}\n      </Grid>\n    )\n  }\n\n}\n","// @flow\nimport * as React from 'react'\nimport SettingsContainer from './SettingsContainer'\nimport SettingsContent from './SettingsContent'\nimport type { FormRow } from './SettingsContent'\nimport typeof {\n  setProperty\n} from 'containers/MathObjects/actions'\n\n// MathObjectData is heavily inexact; missing many props that vary by type\ntype MathObjectData = {\n  type: string\n}\nexport type OwnProps = {|\n  title: string,\n  parentId: string,\n  settingsList: Array<FormRow>\n|}\ntype StateProps = {|\n  data: MathObjectData\n|}\ntype DispatchProps = {|\n  setProperty: setProperty,\n|}\nexport type Props = {\n  ...OwnProps,\n  ...StateProps,\n  ...DispatchProps\n}\n\nexport default class Settings extends React.PureComponent<Props> {\n\n  constructor(props: Props) {\n    super(props)\n    // $FlowFixMe: https://github.com/facebook/flow/issues/1517\n    this.setProperty = this.setProperty.bind(this)\n  }\n\n  // TODO: remove explicit any type\n  setProperty(property: string, value: any) {\n    const { parentId } = this.props\n    const { type } = this.props.data\n    this.props.setProperty(parentId, type, property, value)\n  }\n\n  render() {\n    return (\n      <SettingsContainer title={this.props.title}>\n        <SettingsContent\n          settingsList={this.props.settingsList}\n          data={this.props.data}\n          parentId={this.props.parentId}\n          setProperty={this.setProperty}\n        />\n      </SettingsContainer>\n    )\n  }\n\n}\n","// @flow\nimport { connect } from 'react-redux'\nimport Settings from './components/Settings'\nimport type { OwnProps, Props } from './components/Settings'\nimport {\n  setProperty\n} from 'containers/MathObjects/actions'\n\nconst mapStateToProps = ( { mathGraphics, mathSymbols }, ownProps) => {\n  const { parentId: id } = ownProps\n  const data = mathGraphics[id] ? mathGraphics[id] : mathSymbols[id]\n  return { data }\n}\n\nconst mapDispatchToProps = {\n  setProperty\n}\n\nexport default connect<Props, OwnProps, _, _, _, _>(mapStateToProps, mapDispatchToProps)(Settings)\n","// @flow\nimport * as React from 'react'\nimport MathObjectUI from 'containers/MathObjects/MathObjectUI'\nimport { MainRow } from 'containers/MathObjects/components'\nimport EvaluatedStatusSymbol from 'containers/MathObjects/MathGraphics/containers/EvaluatedStatusSymbol'\nimport Settings from 'containers/MathObjects/containers/Settings'\nimport { capitalize } from 'utils/helpers'\nimport type { MetaData } from 'containers/MathObjects/MathGraphics/types'\nimport styled from 'styled-components'\n\ntype Props = {\n  id: string,\n  type: string,\n  children: React.Node,\n  metadata: MetaData,\n  settingsTitle?: string,\n  isActive: boolean,\n  isDeleteable?: boolean,\n  sidePanelContent?: React.Node\n}\n\nfunction getSettingsFormSpec(metadata: MetaData) {\n  return Object.keys(metadata)\n    .filter(property => !metadata[property].isPrimary)\n    .sort()\n    .map(property => {\n      const { inputType, label = property, allowEmpty } = metadata[property]\n      return { property, inputType, label, allowEmpty }\n    } )\n}\n\nconst LeftOfSettings = styled.div`\n  /* guarantee that settings has room to display */\n  max-width: calc(100% - 30px);\n  overflow-x: ${props => props.showOverflow ? 'visible' : 'hidden'};\n  flex: 1;\n`\n\nexport default class MathGraphicUI extends React.PureComponent<Props> {\n\n  render() {\n    const settingsTitle = this.props.settingsTitle === undefined\n      ? `${capitalize(this.props.type)} Settings`\n      : this.props.settingsTitle\n\n    const sidePanelContent = this.props.sidePanelContent || (\n      <EvaluatedStatusSymbol id={this.props.id} />\n    )\n\n    return (\n      <MathObjectUI\n        isDeleteable={this.props.isDeleteable}\n        id={this.props.id}\n        type={this.props.type}\n        sidePanelContent={sidePanelContent}\n      >\n        <MainRow>\n          <LeftOfSettings showOverflow={this.props.isActive}>\n            {this.props.children}\n          </LeftOfSettings>\n          <Settings\n            title={settingsTitle}\n            parentId={this.props.id}\n            settingsList={getSettingsFormSpec(this.props.metadata)}\n          />\n        </MainRow>\n      </MathObjectUI>\n    )\n  }\n\n}\n","import MathGraphicUI from './components/MathGraphicUI'\nimport { connect } from 'react-redux'\nimport {\n  toggleProperty,\n  setProperty\n} from 'containers/MathObjects/actions'\n\nconst mapStateToProps = ( { activeObject, mathGraphics, parseErrors, evalErrors }, ownProps) => {\n  const { id } = ownProps\n  return {\n    color: mathGraphics[id].color, // I do not think this is used, since EvalautedStatusSymbol is connected\n    visible: mathGraphics[id].visible, // I do not think this is used, since EvalautedStatusSymbol is connected\n    isActive: activeObject === id\n  }\n}\n\nconst mapDispatchToProps = {\n  toggleProperty,\n  setProperty\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MathGraphicUI)\n","// @flow\nimport React, { PureComponent } from 'react'\nimport { Point as PointGraphic } from 'components/MathBox'\nimport MathGraphic from '../MathGraphic'\nimport MathGraphicUI from '../containers/MathGraphicUI'\nimport { pointMeta } from '../metadata'\nimport { MainRow } from 'containers/MathObjects/components'\nimport { MathInputRHS } from 'containers/MathObjects/containers/MathInput'\n\nexport const POINT = 'POINT'\n\ntype Props = {\n  id: string\n}\n\nexport class PointUI extends PureComponent<Props> {\n\n  render() {\n    return (\n      <MathGraphicUI\n        type={POINT}\n        id={this.props.id}\n        metadata={pointMeta}>\n        <MainRow>\n          <MathInputRHS parentId={this.props.id} field='coords'/>\n        </MainRow>\n      </MathGraphicUI>\n    )\n  }\n\n}\n\nexport default new MathGraphic( {\n  type: POINT,\n  metadata: pointMeta,\n  uiComponent: PointUI,\n  mathboxComponent: PointGraphic\n} )\n","// @flow\nimport React, { PureComponent } from 'react'\nimport { Line as LineGraphic } from 'components/MathBox'\nimport MathGraphic from '../MathGraphic'\nimport MathGraphicUI from '../containers/MathGraphicUI'\nimport { lineMeta } from '../metadata'\nimport { MainRow } from 'containers/MathObjects/components'\nimport { MathInputRHS } from 'containers/MathObjects/containers/MathInput'\n\nexport const LINE = 'LINE'\n\ntype Props = {\n  id: string\n}\n\nexport class LineUI extends PureComponent<Props> {\n\n  render() {\n    return (\n      <MathGraphicUI\n        type={LINE}\n        id={this.props.id}\n        metadata={lineMeta}>\n        <MainRow>\n          <MathInputRHS parentId={this.props.id} field='coords'/>\n        </MainRow>\n      </MathGraphicUI>\n    )\n  }\n\n}\n\nexport default new MathGraphic( {\n  type: LINE,\n  metadata: lineMeta,\n  uiComponent: LineUI,\n  mathboxComponent: LineGraphic\n} )\n","// @flow\nimport React, { PureComponent } from 'react'\nimport { Vector as VectorGraphic } from 'components/MathBox'\nimport MathGraphic from '../MathGraphic'\nimport MathGraphicUI from '../containers/MathGraphicUI'\nimport { vectorMeta } from '../metadata'\nimport { MainRow } from 'containers/MathObjects/components'\nimport { MathInputRHS } from 'containers/MathObjects/containers/MathInput'\n\nexport const VECTOR = 'VECTOR'\n\ntype Props = {\n  id: string\n}\n\nexport class VectorUI extends PureComponent<Props> {\n\n  render() {\n    return (\n      <MathGraphicUI\n        type={VECTOR}\n        id={this.props.id}\n        metadata={vectorMeta}>\n        <MainRow>\n          <MathInputRHS parentId={this.props.id} field='components'/>\n        </MainRow>\n      </MathGraphicUI>\n    )\n  }\n\n}\n\nexport default new MathGraphic( {\n  type: VECTOR,\n  metadata: vectorMeta,\n  uiComponent: VectorUI,\n  mathboxComponent: VectorGraphic\n} )\n","// @flow\nimport React, { PureComponent } from 'react'\nimport { Axis as AxisGraphic } from 'components/MathBox'\nimport MathGraphic from '../MathGraphic'\nimport MathGraphicUI from '../containers/MathGraphicUI'\nimport { axisMeta } from '../metadata'\nimport {\n  MathInputRHS,\n  ConnectedStaticMath\n} from 'containers/MathObjects/containers/MathInput'\nimport { MainRow, Cell, Label } from 'containers/MathObjects/components'\n\nexport const AXIS = 'AXIS'\n\ntype Props = {\n  id: string\n}\n\nconst noFlex = {\n  flex: 0\n}\n\nexport class AxisUI extends PureComponent<Props> {\n\n  render() {\n    return (\n      <MathGraphicUI\n        type={AXIS}\n        id={this.props.id}\n        metadata={axisMeta}\n        isDeleteable={false}\n      >\n        <MainRow>\n          <Cell>\n            <Label>Direction:</Label>\n            <ConnectedStaticMath parentId={this.props.id} field='axis' />\n          </Cell>\n          <Cell>\n            <Label>Min:</Label>\n            <MathInputRHS field='min' parentId={this.props.id} style={noFlex}/>\n          </Cell>\n          <Cell>\n            <Label>Max:</Label>\n            <MathInputRHS field='max' parentId={this.props.id} style={noFlex} />\n          </Cell>\n        </MainRow>\n      </MathGraphicUI>\n    )\n  }\n\n}\n\nexport default new MathGraphic( {\n  type: AXIS,\n  metadata: axisMeta,\n  uiComponent: AxisUI,\n  mathboxComponent: AxisGraphic\n} )\n","// @flow\nimport React, { PureComponent } from 'react'\nimport { Grid as GridGraphic } from 'components/MathBox'\nimport MathGraphic from '../MathGraphic'\nimport MathGraphicUI from '../containers/MathGraphicUI'\nimport { gridMeta } from '../metadata'\nimport {\n  ConnectedStaticMath\n} from 'containers/MathObjects/containers/MathInput'\nimport styled from 'styled-components'\nimport { MainRow } from 'containers/MathObjects/components'\n\nexport const GRID = 'GRID'\n\ntype Props = {\n  id: string\n}\n\nconst Cell = styled.div`\n  display: flex;\n  flex: 1;\n  align-items:center;\n`\nconst Label = styled.span`\n  padding-left:5px;\n  padding-right:5px;\n`\n\nexport class GridUI extends PureComponent<Props> {\n\n  render() {\n    return (\n      <MathGraphicUI\n        type={GRID}\n        id={this.props.id}\n        metadata={gridMeta}\n        isDeleteable={false}\n      >\n        <MainRow>\n          <Cell>\n            <Label>Axes:</Label>\n            <ConnectedStaticMath parentId={this.props.id} field='axes' />\n          </Cell>\n        </MainRow>\n      </MathGraphicUI>\n    )\n  }\n\n}\n\nexport default new MathGraphic( {\n  type: GRID,\n  metadata: gridMeta,\n  uiComponent: GridUI,\n  mathboxComponent: GridGraphic\n} )\n","// @flow\nimport React, { PureComponent } from 'react'\nimport { ParametricCurve as ParametricCurveGraphic } from 'components/MathBox'\nimport MathGraphic from '../MathGraphic'\nimport MathGraphicUI from '../containers/MathGraphicUI'\nimport { parametricCurveMeta } from '../metadata'\nimport { MainRow } from 'containers/MathObjects/components'\nimport {\n  MathInputRHS,\n  StaticMathStyled\n} from 'containers/MathObjects/containers/MathInput'\n\nexport const PARAMETRIC_CURVE = 'PARAMETRIC_CURVE'\n\ntype Props = {\n  id: string\n}\n\nconst justifyRight = {\n  justifyContent: 'flex-end'\n}\nconst rangeStyle = {\n  flex: 0\n}\n\nexport class ParemetricCurveUI extends PureComponent<Props> {\n\n  render() {\n    return (\n      <MathGraphicUI\n        type={PARAMETRIC_CURVE}\n        id={this.props.id}\n        metadata={parametricCurveMeta}>\n        <MainRow>\n          <MathInputRHS\n            field='expr'\n            prefix='_f(t)='\n            parentId={this.props.id}\n          />\n        </MainRow>\n        <MainRow style={justifyRight}>\n          <StaticMathStyled latex='t\\in' size='small'/>\n          <MathInputRHS\n            size='small'\n            parentId={this.props.id}\n            field='range'\n            style={rangeStyle}\n          />\n        </MainRow>\n      </MathGraphicUI>\n    )\n  }\n\n}\n\nexport default new MathGraphic( {\n  type: PARAMETRIC_CURVE,\n  description: 'Parametric Curve',\n  metadata: parametricCurveMeta,\n  uiComponent: ParemetricCurveUI,\n  mathboxComponent: ParametricCurveGraphic\n} )\n","// @flow\nimport React from 'react'\nimport { StaticMathStyled } from 'containers/MathObjects/containers/MathInput'\nimport styled from 'styled-components'\nimport { colorMaps } from 'constants/colors'\n\nconst ScaleContainer = styled.div`\n  display:flex;\n  align-items:center;\n  margin:4px;\n`\nconst ColorBar = styled.div`\n  flex:1;\n  ${props => props.gradient};\n  background-color: ${props => props.color};\n  height:10px;\n`\n\ntype Props = {\n  color: string\n}\n\nexport function ColorScale(props: Props) {\n  const { color } = props\n  const gradient = colorMaps[color] && colorMaps[color].css\n  return (\n    <ScaleContainer>\n      <StaticMathStyled latex='0'/>\n      <ColorBar gradient={gradient} color={color}/>\n      <StaticMathStyled latex='1'/>\n    </ScaleContainer>\n  )\n}\n","// @flow\nimport React from 'react'\nimport { connect } from 'react-redux'\nimport EvaluatedStatusSymbol from 'containers/MathObjects/MathGraphics/containers/EvaluatedStatusSymbol'\nimport { colors, colorMaps } from 'constants/colors'\nimport { Tabs } from 'antd'\nimport {\n  StaticMathStyled,\n  MathInputRHS\n} from 'containers/MathObjects/containers/MathInput'\nimport { ColorScale } from './components/ColorScale'\n\nconst TabPane = Tabs.TabPane\n\nconst extendedColors = [...colors, ...Object.keys(colorMaps)]\n\ntype OwnProps = {|\n  id: string,\n  labelU: string,\n  labelV: string\n|}\ntype StateProps = {|\n  color: string\n|}\ntype Props = {\n  ...OwnProps,\n  ...StateProps\n}\n\nfunction _ParametricSurfaceStatus(props: Props) {\n  const { id, color, labelU, labelV } = props\n  return (\n    <EvaluatedStatusSymbol\n      colors={extendedColors}\n      id={id}\n      extraTabs={\n        <TabPane tab='Color Map' key='colorMap'>\n          <ColorScale color={color}/>\n          <p>\n            <StaticMathStyled latex={`f(X, Y, Z, ${labelU}, ${labelV})=`}/>\n          </p>\n          <MathInputRHS\n            parentId={id}\n            field='colorExpr'\n            prefix={`_f(X, Y, Z, ${labelU}, ${labelV})=`}\n          />\n          <p>Note: The values <strong>capital</strong> X, Y, Z represent scaled axis coordinates, and range from 0 to 1.</p>\n\n          <p><em>Color maps may look better with <code>shaded=false</code>.</em></p>\n        </TabPane>\n      }\n    />\n  )\n}\n\nconst mapStateToProps = ( { mathGraphics }, ownProps) => ( {\n  color: mathGraphics[ownProps.id].color\n} )\n\nexport default connect<Props, OwnProps, _, _, _, _>(mapStateToProps)(_ParametricSurfaceStatus)\n","// @flow\nimport React, { PureComponent } from 'react'\nimport {\n  ParametricSurface as ParametricSurfaceGraphic,\n  ExplicitSurface as ExplicitSurfaceGraphic,\n  ExplicitSurfacePolar as ExplicitSurfacePolarGraphic\n} from 'components/MathBox'\nimport MathGraphic from '../MathGraphic'\nimport MathGraphicUI from '../containers/MathGraphicUI'\nimport ParametricSurfaceStatus from './containers/ParametricSurfaceStatus'\nimport {\n  parametricSurfacaMeta,\n  explicitSurfaceMeta,\n  explicitSurfacePolarMeta\n} from '../metadata'\nimport type { MetaData } from '../types'\nimport { MainRow } from 'containers/MathObjects/components'\nimport {\n  MathInputRHS,\n  StaticMathStyled\n} from 'containers/MathObjects/containers/MathInput'\nimport { parser } from 'constants/parsing'\n\ntype Props = {\n  id: string\n}\n\nconst justifyRight = {\n  justifyContent: 'flex-end'\n}\nconst rangeStyle = {\n  flex: 0\n}\n\nfunction makeStripFuncPrefix(varname: string) {\n  const prefixLength = `_f(${varname})=`.length\n  return function stripFuncPrefixIfPossible(latex: string): string {\n    try {\n      const full = parser.parse(latex)\n      if (full.tree.type !== 'FunctionAssignmentNode') {\n        return latex\n      }\n      const varname = full.tree.params[0]\n      const texRHS = latex.slice(prefixLength)\n      const rhs = parser.parse(texRHS)\n      return rhs.dependencies.has(varname) ? latex : texRHS\n    }\n    catch (error) {\n      return latex\n    }\n  }\n}\n\nfunction makeSurfaceComponent(type: string, meta: MetaData, labelU: string, labelV: string) {\n\n  const stripFuncPrefixIfPossibleU = makeStripFuncPrefix(labelU)\n  const stripFuncPrefixIfPossibleV = makeStripFuncPrefix(labelV)\n\n  return class ParametricSurfaceUI extends PureComponent<Props> {\n\n    render() {\n      const { id } = this.props\n      return (\n        <MathGraphicUI\n          type={type}\n          id={id}\n          metadata={meta}\n          sidePanelContent={\n            <ParametricSurfaceStatus\n              id={id}\n              labelU={labelU}\n              labelV={labelV}\n            />\n          }\n        >\n          <MainRow>\n            <MathInputRHS\n              field='expr'\n              prefix={`_f(${labelU},${labelV})=`}\n              parentId={id}\n            />\n          </MainRow>\n          <MainRow style={justifyRight}>\n            <StaticMathStyled latex={`${labelU}\\\\in`} size='small'/>\n            <MathInputRHS\n              size='small'\n              parentId={id}\n              prefix={`_f(${labelV})=`}\n              postProcessLaTeX={stripFuncPrefixIfPossibleV}\n              field='rangeU'\n              style={rangeStyle}\n            />\n          </MainRow>\n          <MainRow style={justifyRight}>\n            <StaticMathStyled latex={`${labelV}\\\\in`} size='small'/>\n            <MathInputRHS\n              size='small'\n              parentId={id}\n              prefix={`_f(${labelU})=`}\n              postProcessLaTeX={stripFuncPrefixIfPossibleU}\n              field='rangeV'\n              style={rangeStyle}\n            />\n          </MainRow>\n        </MathGraphicUI>\n      )\n    }\n\n  }\n}\n\nexport const PARAMETRIC_SURFACE = 'PARAMETRIC_SURFACE'\nexport const EXPLICIT_SURFACE = 'EXPLICIT_SURFACE'\nexport const EXPLICIT_SURFACE_POLAR = 'EXPLICIT_SURFACE_POLAR'\n\nexport const ParametricSurface = new MathGraphic( {\n  type: PARAMETRIC_SURFACE,\n  description: 'Parametric Surface',\n  metadata: parametricSurfacaMeta,\n  uiComponent: makeSurfaceComponent(PARAMETRIC_SURFACE, parametricSurfacaMeta, 'u', 'v'),\n  mathboxComponent: ParametricSurfaceGraphic\n} )\n\nexport const ExplicitSurface = new MathGraphic( {\n  type: EXPLICIT_SURFACE,\n  description: 'Explicit Surface',\n  metadata: explicitSurfaceMeta,\n  uiComponent: makeSurfaceComponent(EXPLICIT_SURFACE, explicitSurfaceMeta, 'x', 'y'),\n  mathboxComponent: ExplicitSurfaceGraphic\n} )\n\nexport const ExplicitSurfacePolar = new MathGraphic( {\n  type: EXPLICIT_SURFACE_POLAR,\n  description: 'Explicit Surface (Polar)',\n  metadata: explicitSurfacePolarMeta,\n  uiComponent: makeSurfaceComponent(EXPLICIT_SURFACE_POLAR, explicitSurfacePolarMeta, 'r', '\\\\theta'),\n  mathboxComponent: ExplicitSurfacePolarGraphic\n} )\n","// @flow\nimport React, { PureComponent } from 'react'\nimport { ImplicitSurface as ImplicitSurfaceGraphic } from 'components/MathBox'\nimport MathGraphic from '../MathGraphic'\nimport MathGraphicUI from '../containers/MathGraphicUI'\nimport { implicitSurfaceMeta } from '../metadata'\nimport { MainRow } from 'containers/MathObjects/components'\nimport {\n  MathInputRHS,\n  StaticMathStyled\n} from 'containers/MathObjects/containers/MathInput'\n\nexport const IMPLICIT_SURFACE = 'IMPLICIT_SURFACE'\n\ntype Props = {\n  id: string\n}\n\nconst justifyRight = {\n  justifyContent: 'flex-end'\n}\nconst rangeStyle = {\n  flex: 0\n}\n\nexport class ImplicitSurfaceUI extends PureComponent<Props> {\n\n  render() {\n    return (\n      <MathGraphicUI\n        type={IMPLICIT_SURFACE}\n        id={this.props.id}\n        metadata={implicitSurfaceMeta}>\n        <MainRow>\n          <MathInputRHS\n            field='lhs'\n            prefix='_f(x,y,z)='\n            parentId={this.props.id}\n          />\n          <StaticMathStyled latex='='/>\n          <MathInputRHS\n            field='rhs'\n            // that lhs and rhs have same prefix name is irrelevant.\n            // So far we've used f(...) as a function prefix everywhere.\n            prefix='_f(x,y,z)='\n            parentId={this.props.id}\n          />\n        </MainRow>\n        {/* Maybe better to put all of the ranges on one row.  */}\n        <MainRow style={justifyRight}>\n          <StaticMathStyled latex='x\\in' size='small'/>\n          <MathInputRHS\n            size='small'\n            parentId={this.props.id}\n            field='rangeX'\n            style={rangeStyle}\n          />\n        </MainRow>\n        <MainRow style={justifyRight}>\n          <StaticMathStyled latex='y\\in' size='small'/>\n          <MathInputRHS\n            size='small'\n            parentId={this.props.id}\n            field='rangeY'\n            style={rangeStyle}\n          />\n        </MainRow>\n        <MainRow style={justifyRight}>\n          <StaticMathStyled latex='z\\in' size='small'/>\n          <MathInputRHS\n            size='small'\n            parentId={this.props.id}\n            field='rangeZ'\n            style={rangeStyle}\n          />\n        </MainRow>\n      </MathGraphicUI>\n    )\n  }\n\n}\n\nexport default new MathGraphic( {\n  type: IMPLICIT_SURFACE,\n  description: 'Implicit Surface',\n  metadata: implicitSurfaceMeta,\n  uiComponent: ImplicitSurfaceUI,\n  mathboxComponent: ImplicitSurfaceGraphic,\n  support: 'experimental'\n} )\n","// @flow\nimport React, { PureComponent } from 'react'\nimport { VectorField as VectorFieldGraphic } from 'components/MathBox'\nimport MathGraphic from '../MathGraphic'\nimport MathGraphicUI from '../containers/MathGraphicUI'\nimport { vectorFieldMeta } from '../metadata'\nimport { MainRow } from 'containers/MathObjects/components'\nimport {\n  MathInputRHS,\n  StaticMathStyled\n} from 'containers/MathObjects/containers/MathInput'\n\nexport const VECTOR_FIELD = 'VECTOR_FIELD'\n\ntype Props = {\n  id: string\n}\n\nconst justifyRight = {\n  justifyContent: 'flex-end'\n}\nconst rangeStyle = {\n  flex: 0\n}\n\nexport class VectorFieldUI extends PureComponent<Props> {\n\n  render() {\n    return (\n      <MathGraphicUI\n        type={VECTOR_FIELD}\n        id={this.props.id}\n        metadata={vectorFieldMeta}>\n        <MainRow>\n          <MathInputRHS\n            field='expr'\n            prefix='_f(x,y,z)='\n            parentId={this.props.id}\n          />\n        </MainRow>\n        <MainRow style={justifyRight}>\n          <StaticMathStyled latex='x\\in' size='small'/>\n          <MathInputRHS\n            size='small'\n            parentId={this.props.id}\n            field='rangeX'\n            style={rangeStyle}\n          />\n        </MainRow>\n        <MainRow style={justifyRight}>\n          <StaticMathStyled latex='y\\in' size='small'/>\n          <MathInputRHS\n            size='small'\n            parentId={this.props.id}\n            field='rangeY'\n            style={rangeStyle}\n          />\n        </MainRow>\n        <MainRow style={justifyRight}>\n          <StaticMathStyled latex='z\\in' size='small'/>\n          <MathInputRHS\n            size='small'\n            parentId={this.props.id}\n            field='rangeZ'\n            style={rangeStyle}\n          />\n        </MainRow>\n      </MathGraphicUI>\n    )\n  }\n\n}\n\nexport default new MathGraphic( {\n  type: VECTOR_FIELD,\n  description: 'Vector Field',\n  metadata: vectorFieldMeta,\n  uiComponent: VectorFieldUI,\n  mathboxComponent: VectorFieldGraphic\n} )\n","// @flow\nimport type MathGraphic from './MathGraphic'\nimport Camera from './Camera'\nimport Point from './Point'\nimport Line from './Line'\nimport Vector from './Vector'\nimport Axis from './Axis'\nimport Grid from './Grid'\nimport ParametricCurve from './ParametricCurve'\nimport {\n  ParametricSurface,\n  ExplicitSurface,\n  ExplicitSurfacePolar\n} from './ParametricSurface'\nimport ImplicitSurface from './ImplicitSurface'\nimport VectorField from './VectorField'\n\nfunction makeExports(mathGraphics: Array<MathGraphic>) {\n  return mathGraphics.reduce((acc, obj) => {\n    acc[obj.type] = obj\n    return acc\n  }, {} )\n}\n\nexport default makeExports( [\n  Camera,\n  Axis,\n  Grid,\n  Point,\n  Line,\n  Vector,\n  ParametricCurve,\n  ParametricSurface,\n  ExplicitSurface,\n  ExplicitSurfacePolar,\n  ImplicitSurface,\n  VectorField\n] )\n\nexport { CAMERA } from './Camera'\nexport { AXIS } from './Axis'\nexport { GRID } from './Grid'\nexport { POINT } from './Point'\nexport { LINE } from './Line'\nexport { VECTOR } from './Vector'\nexport { PARAMETRIC_CURVE } from './ParametricCurve'\nexport {\n  PARAMETRIC_SURFACE,\n  EXPLICIT_SURFACE,\n  EXPLICIT_SURFACE_POLAR\n} from './ParametricSurface'\nexport { IMPLICIT_SURFACE } from './ImplicitSurface'\nexport { VECTOR_FIELD } from './VectorField'\n","// @flow\nimport { MathSymbol } from 'containers/MathObjects/MathObject'\nimport Variable from './components/Variable'\nimport { VARIABLE, defaultSettings } from './metadata'\n\nexport default new MathSymbol( {\n  type: VARIABLE,\n  defaultSettings: defaultSettings,\n  uiComponent: Variable\n} )\n\nexport { VARIABLE }\n","export const VARIABLE = 'VARIABLE'\n\nexport const defaultSettings = {\n  type: VARIABLE,\n  name: 'f(x)',\n  value: 'e^x',\n  description: 'Variable or Function'\n}\n","import React, { PureComponent } from 'react'\nimport PropTypes from 'prop-types'\nimport MathObjectUI from 'containers/MathObjects/MathObjectUI'\nimport { MainRow } from 'containers/MathObjects/components'\nimport {\n  MathInputLHS,\n  MathInputRHS,\n  StaticMathStyled\n} from 'containers/MathObjects/containers/MathInput'\nimport { VARIABLE } from '../metadata'\n\nexport default class Variable extends PureComponent {\n\n  static propTypes = {\n    id: PropTypes.string.isRequired\n  }\n\n  render() {\n    return (\n      <MathObjectUI\n        id={this.props.id}\n        type={VARIABLE}\n      >\n        <MainRow>\n          <MathInputLHS\n            parentId={this.props.id}\n          />\n          <StaticMathStyled\n            latex='='\n          />\n          <MathInputRHS\n            field='value'\n            parentId={this.props.id}\n          />\n        </MainRow>\n      </MathObjectUI>\n    )\n  }\n\n}\n","export const BOOLEAN_VARIABLE = 'BOOLEAN_VARIABLE'\n\nexport const defaultSettings = {\n  type: BOOLEAN_VARIABLE,\n  name: 'switch',\n  value: true,\n  description: 'Toggle Switch'\n}\n","// @flow\nimport React, { PureComponent } from 'react'\nimport { Switch } from 'antd'\nimport MathObjectUI from 'containers/MathObjects/MathObjectUI'\nimport { MainRow, Cell, Label } from 'containers/MathObjects/components'\nimport {\n  MathInputLHS\n} from 'containers/MathObjects/containers/MathInput'\nimport { BOOLEAN_VARIABLE } from '../metadata'\nimport typeof { setProperty } from 'containers/MathObjects/actions'\n\ntype Props = {\n  id: string,\n  setProperty: setProperty,\n  value: bool\n}\n\nexport default class BooleanVariable extends PureComponent<Props> {\n\n  onChange = (value: bool) => {\n    this.props.setProperty(this.props.id, BOOLEAN_VARIABLE, 'value', value)\n  }\n\n  render() {\n    return (\n      <MathObjectUI\n        id={this.props.id}\n        type={BOOLEAN_VARIABLE}\n      >\n        <MainRow>\n          <Cell>\n            <Label>\n              Name:\n            </Label>\n            <MathInputLHS\n              parentId={this.props.id}\n            />\n          </Cell>\n          <Cell>\n            <Label>\n              Value:\n            </Label>\n            <Switch\n              checkedChildren='On'\n              unCheckedChildren='Off'\n              checked={this.props.value}\n              onChange={this.onChange}\n            />\n          </Cell>\n        </MainRow>\n      </MathObjectUI>\n    )\n  }\n\n}\n","import { BOOLEAN_VARIABLE, defaultSettings } from './metadata'\nimport { connect } from 'react-redux'\nimport { MathSymbol } from 'containers/MathObjects/MathObject'\nimport { setProperty } from 'containers/MathObjects/actions'\nimport BooleanVariable from './components/BooleanVariable'\n\nconst mapStateToProps = ( { mathSymbols }, ownProps) => ( {\n  value: mathSymbols[ownProps.id].value\n} )\n\nconst mapDispatchToProps = {\n  setProperty\n}\n\nexport default new MathSymbol( {\n  type: BOOLEAN_VARIABLE,\n  defaultSettings: defaultSettings,\n  uiComponent: connect(mapStateToProps, mapDispatchToProps)(BooleanVariable)\n} )\n\nexport { BOOLEAN_VARIABLE }\n","// @flow\nimport Variable, { VARIABLE } from './Variable'\nimport BooleanVariable, { BOOLEAN_VARIABLE } from './BooleanVariable'\nimport VariableSlider, { VARIABLE_SLIDER } from './VariableSlider'\n\nexport default {\n  [Variable.type]: Variable,\n  [VariableSlider.type]: VariableSlider,\n  [BooleanVariable.type]: BooleanVariable\n}\n\nexport { VARIABLE, VARIABLE_SLIDER, BOOLEAN_VARIABLE }\n","import React from 'react'\nimport { Icon } from 'antd'\nimport styled from 'styled-components'\nimport PropTypes from 'prop-types'\nimport SubtleButton from 'components/SubtleButton'\nimport { theme } from 'constants/theme'\n\nconst CollapseIndicatorButton = styled(SubtleButton)`\n  padding-left: 2px;\n  padding-right: 2px;\n  width:28px;\n  height:28px;\n`\n\nconst RotatingSpan = styled.span`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition-duration: ${props => `${props.animationSpeed}ms`};\n  &.collapsed {\n    transform: rotate(-90deg);\n  }\n`\n\nCollapsedIndicator.propTypes = {\n  onToggleContentCollapsed: PropTypes.func.isRequired,\n  isCollapsed: PropTypes.bool.isRequired,\n  animationSpeed: PropTypes.number.isRequired,\n  lightenOnHover: PropTypes.bool.isRequired,\n  backgroundColor: PropTypes.string.isRequired\n}\n\nexport default function CollapsedIndicator(props) {\n  const className = props.isCollapsed ? 'collapsed' : ''\n  return (\n    <CollapseIndicatorButton\n      onClick={props.onToggleContentCollapsed}\n      lightenOnHover={props.lightenOnHover}\n      backgroundColor={props.backgroundColor}\n      focusColor={theme.gray[6]}\n    >\n      <RotatingSpan\n        className={className}\n        animationSpeed={props.animationSpeed}\n      >\n        <Icon\n          type=\"down\"\n        />\n      </RotatingSpan>\n\n    </CollapseIndicatorButton>\n  )\n}\n","import React, { PureComponent } from 'react'\nimport SortableList from 'components/SortableList'\nimport MathGraphics from 'containers/MathObjects/MathGraphics'\nimport MathSymbols from 'containers/MathObjects/MathSymbols'\nimport CollapsedIndicator from './CollapsedIndicator'\nimport Collapsible from 'react-collapsible'\nimport PropTypes from 'prop-types'\nimport MathObjectUI from 'containers/MathObjects/MathObjectUI'\nimport theme from 'constants/theme'\nimport { FOLDER } from '../metadata'\n\nexport default class Folder extends PureComponent {\n\n  static propTypes = {\n    // Provided by ownProps\n    id: PropTypes.string.isRequired,\n    animationSpeed: PropTypes.number.isRequired, // has default\n    // Provided by mapStateToProps / mapDispatchToProps\n    isCollapsed: PropTypes.bool.isRequired,\n    onToggleContentCollapsed: PropTypes.func.isRequired,\n    items: PropTypes.arrayOf(PropTypes.object).isRequired,\n    isActive: PropTypes.bool.isRequired\n  }\n\n  static defaultProps = {\n    animationSpeed: 200,\n    isDropDisabled: false\n  }\n\n  constructor(props) {\n    super(props)\n    this.onToggleContentCollapsed = this.props.onToggleContentCollapsed.bind(this, this.props.id)\n  }\n\n  render() {\n    const props = this.props\n    const listClassName = props.isCollapsed ? 'collapsed' : ''\n    return (\n      <MathObjectUI\n        id={props.id}\n        type={FOLDER}\n        isFolder={true}\n        sidePanelContent={\n          <CollapsedIndicator\n            isCollapsed={props.isCollapsed}\n            onToggleContentCollapsed={this.onToggleContentCollapsed}\n            animationSpeed={props.animationSpeed}\n            lightenOnHover={props.isActive}\n            backgroundColor={props.isActive ? theme.primary[1] : 'white'}\n          />\n        }\n      >\n        <Collapsible\n          open={!props.isCollapsed}\n          transitionTime={props.animationSpeed}\n          overflowWhenOpen='visible'\n        >\n          <SortableList\n            className={listClassName}\n            droppableType='FOLDER_ITEM'\n            draggableType='FOLDER_ITEM'\n            // this prevents dropping into collapsed folders\n            isDropDisabled={props.isCollapsed || props.isDropDisabled}\n            droppableId={props.id}\n            items={props.items}\n            renderItem={renderItem}\n          />\n        </Collapsible>\n      </MathObjectUI>\n    )\n  }\n\n}\n\nconst FolderContents = { ...MathSymbols, ...MathGraphics }\nfunction renderItem( { id, type } ) {\n  const SpecificMathObject = FolderContents[type].uiComponent\n  return <SpecificMathObject id={id }/>\n}\n","import {\n  AXIS,\n  GRID\n} from 'containers/MathObjects/MathGraphics'\nimport createCachedSelector from 're-reselect'\nfunction getType(mathGraphics, mathSymbols, id) {\n  if (mathGraphics[id] ) {\n    return mathGraphics[id].type\n  }\n  else if (mathSymbols[id] ) {\n    return mathSymbols[id].type\n  }\n  else {\n    throw Error(`Folder child item ${id} is not a mathGraphic or mathSymbols variable`)\n  }\n}\n\nconst DRAG_DISABLED = new Set( [AXIS, GRID] )\n\nexport const getItems = createCachedSelector(\n  (state, folderId) => state.mathGraphics,\n  (state, folderId) => state.mathSymbols,\n  (state, folderId) => state.sortableTree[folderId], // itemIds\n  (mathGraphics, mathSymbols, itemIds) => itemIds.map(\n    id => {\n      const type = getType(mathGraphics, mathSymbols, id)\n      return { id, type, isDragDisabled: DRAG_DISABLED.has(type) }\n    }\n  )\n)(\n  (state, folderId) => folderId\n)\n","// @flow\nimport { MathFolder } from '../MathObject'\nimport Folder from './components/Folder'\nimport { connect } from 'react-redux'\nimport { toggleContentCollapsed } from './actions'\nimport { getItems } from './selectors'\nimport { FOLDER, defaultSettings } from './metadata'\n\nconst mapStateToProps = (state, ownProps) => ( {\n  items: getItems(state, ownProps.id),\n  isCollapsed: state.folders[ownProps.id].isCollapsed,\n  isActive: state.activeObject === ownProps.id,\n  isDropDisabled: state.folders[ownProps.id].isDropDisabled\n} )\n\nconst mapDispatchToProps = {\n  onToggleContentCollapsed: toggleContentCollapsed\n}\n\nexport default new MathFolder( {\n  type: FOLDER,\n  defaultSettings: defaultSettings,\n  uiComponent: connect(mapStateToProps, mapDispatchToProps)(Folder)\n} )\nexport { FOLDER }\n","import {\n  toggleProperty,\n  setProperty\n} from 'containers/MathObjects/actions'\nimport { FOLDER } from './metadata'\n\nexport const setContentCollapsed = (id, value) => {\n  return setProperty(id, FOLDER, 'isCollapsed', value)\n}\n\nexport const toggleContentCollapsed = (id) => {\n  return toggleProperty(id, FOLDER, 'isCollapsed')\n}\n","// @flow\nimport Folder from './Folder'\nimport MathGraphics from './MathGraphics'\nimport MathSymbols from './MathSymbols'\nimport type { MathObjectWrapper } from './MathObject'\n\nexport { Folder, MathGraphics, MathSymbols }\n\nconst mathObjects : { [string]: MathObjectWrapper } = {\n  [Folder.type]: Folder,\n  ...MathSymbols,\n  ...MathGraphics\n}\n\nexport default mathObjects\n\nexport { FOLDER } from './Folder'\nexport { VARIABLE, VARIABLE_SLIDER, BOOLEAN_VARIABLE } from './MathSymbols'\nexport {\n  CAMERA,\n  AXIS,\n  GRID,\n  POINT,\n  LINE,\n  VECTOR,\n  PARAMETRIC_CURVE,\n  IMPLICIT_SURFACE,\n  VECTOR_FIELD\n} from './MathGraphics'\n\nwindow.MathObjects = mathObjects\n","import {\n  REORDER_WITHIN_DROPPABLE,\n  DRAG_TO_NEW_DROPPABLE\n}\n  from './actions'\nimport { CREATE_MATH_OBJECT, DELETE_MATH_OBJECT } from '../MathObjects/actions'\nimport { Folder } from 'containers/MathObjects'\nimport update from 'immutability-helper'\n\nexport function reOrder(list, sourceIndex, destinationIndex) {\n  const result = [...list]\n  const [removed] = result.splice(sourceIndex, 1)\n  result.splice(destinationIndex, 0, removed)\n  return result\n}\n\nupdate.extend('$reOrder', (sourceDestIndexes, list) => (\n  reOrder(list, ...sourceDestIndexes)\n))\n\nconst initialState = {\n  root: []\n}\n\nexport default (state = initialState, { type, payload, name } ) => {\n  switch (type) {\n\n    case REORDER_WITHIN_DROPPABLE: {\n\n      const { source, destination } = payload\n      return update(state,\n        {\n          [source.droppableId]: { $reOrder: [source.index, destination.index] }\n        } )\n\n    }\n\n    case DRAG_TO_NEW_DROPPABLE: {\n\n      const { source, destination, draggableId } = payload\n      return update(state,\n        {\n          [source.droppableId]: { $splice: [[source.index, 1]] },\n          [destination.droppableId]: { $splice: [[destination.index, 0, draggableId]] }\n        } )\n\n    }\n\n    case DELETE_MATH_OBJECT: {\n      const { parentId, positionInParent } = payload\n      return update(state,\n        {\n          [parentId]: { $splice: [[positionInParent, 1]] }\n        } )\n    }\n\n    case CREATE_MATH_OBJECT: {\n      const { parentFolderId, positionInFolder, id } = payload\n      const extraMerge = name === Folder.type\n        ? { $merge: { [id]: [] } }\n        : {}\n      return update(state,\n        {\n          [parentFolderId]: { $splice: [[positionInFolder, 0, id]] },\n          ...extraMerge\n        } )\n    }\n\n    default:\n      return state\n\n  }\n}\n","import { VARIABLE_SLIDER, defaultValue } from './metadata'\nimport { CREATE_MATH_OBJECT } from 'containers/MathObjects/actions'\nimport { SET_SLIDER_VALUE } from './actions'\nconst initialState = {}\n\nexport default function sliderValues(state = initialState, action) {\n  const { type, payload } = action\n  switch (type) {\n\n    case SET_SLIDER_VALUE: {\n      const { id, value } = payload\n      return { ...state, [id]: value }\n    }\n\n    case CREATE_MATH_OBJECT: {\n      if (action.name !== VARIABLE_SLIDER) { return state }\n      const { id } = payload\n      return { ...state, [id]: defaultValue }\n    }\n\n    default:\n      return state\n\n  }\n\n}\n","// @flow\nimport {\n  SET_CREATION_DATE, typeof setCreationDate,\n  SET_TITLE, typeof setTitle\n} from './actions'\nimport type { ExtractReturn } from 'utils/flow'\n\ntype State = {\n  title: string,\n  versionAtCreation: ?string,\n  creationDate: string\n}\n\ntype Action = ExtractReturn<setTitle> | ExtractReturn<setCreationDate>\n\nexport const initialState: State = {\n  title: 'Untitled',\n  versionAtCreation: process.env.REACT_APP_VERSION,\n  creationDate: JSON.stringify(new Date())\n}\n\nexport default function(state: State = initialState, action: Action) {\n\n  switch (action.type) {\n\n    case SET_TITLE: {\n      const title = action.payload.title\n      return { ...state, title }\n    }\n\n    case SET_CREATION_DATE: {\n      const creationDate = action.payload.creationDate\n      return { ...state, creationDate }\n    }\n\n    default: {\n      return state\n    }\n\n  }\n\n}\n","import update from 'immutability-helper'\nimport {\n  TOGGLE_PROPERTY,\n  SET_PROPERTY,\n  UNSET_PROPERTY,\n  SET_PROPERTY_AND_ERROR,\n  CREATE_MATH_OBJECT,\n  DELETE_MATH_OBJECT\n} from './actions'\nimport MathObjects, {\n  Folder,\n  MathSymbols,\n  MathGraphics,\n  BOOLEAN_VARIABLE\n} from './index'\n\nconst initialState = {}\n\n/**\n * creates a reducer\n *\n * @param  {Set} mathObjectNames names of mathObjects handled by this reducer\n * @return {function}\n */\nexport function createReducer(mathObjectNames) {\n\n  return (state = initialState, action) => {\n\n    const { name, type, payload } = action\n    if (!mathObjectNames.has(name)) return state\n\n    switch (type) {\n\n      case CREATE_MATH_OBJECT: {\n        const settings = { ...MathObjects[name].defaultSettings, ...payload.settings }\n        return update(state, {\n          $merge: { [payload.id]: settings }\n        } )\n      }\n      case DELETE_MATH_OBJECT:\n        return update(state, {\n          $unset: [ payload.id ]\n        } )\n      case TOGGLE_PROPERTY:\n        return update(state, {\n          [payload.id]: { $toggle: [payload.property] }\n        } )\n      case SET_PROPERTY_AND_ERROR: // falls through to SET_PROPERTY\n      case SET_PROPERTY:\n        return update(state, {\n          [payload.id]: { [payload.property]: { $set: payload.value } }\n        } )\n      case UNSET_PROPERTY:\n        return update(state, {\n          [payload.id]: { $unset: [payload.property] }\n        } )\n      default:\n        return state\n\n    }\n  }\n}\n\nexport const folders = createReducer(new Set( [Folder.type] ))\nexport const mathSymbols = createReducer(new Set(Object.keys(MathSymbols)))\nconst mathGraphicsRaw = createReducer(new Set(Object.keys(MathGraphics)))\n\n// Add in some custom logic for handling calculatedVisibility.\n// sets `useCalculatedVisibility` to:\n//    false, whenever object's visibility is set\n//    true, whenever a toggle variable is edited\n//    true, whenever calculatedVisibility is edited\n// In most cases, just defer to mathGraphicsRaw\nexport function mathGraphics(state, action) {\n  const { name, type, payload } = action\n  const partialUpdate = mathGraphicsRaw(state, action)\n  if (type !== SET_PROPERTY && type !== TOGGLE_PROPERTY) {\n    return partialUpdate\n  }\n  const { property } = payload\n  if (property === 'visible') {\n    return update(partialUpdate, {\n      [payload.id]: { useCalculatedVisibility: { $set: false } }\n    } )\n  }\n  else if (property === 'calculatedVisibility') {\n    return update(partialUpdate, {\n      [payload.id]: { useCalculatedVisibility: { $set: true } }\n    } )\n  }\n  else if (name === BOOLEAN_VARIABLE) {\n    // mutation is ok here because partialUpdate is a copy of the previous state.\n    for (const id of Object.keys(partialUpdate)) {\n      if (partialUpdate[id].calculatedVisibility !== 'null') {\n        partialUpdate[id].useCalculatedVisibility = true\n      }\n    }\n    return partialUpdate\n  }\n  else {\n    return partialUpdate\n  }\n}\n","// @flow\nclass SequentialIdGenerator {\n\n  _lastId = 0\n\n  next() {\n    this._lastId += 1\n    return String(this._lastId)\n  }\n\n  setNextId(id: number) {\n    this._lastId = id - 1\n  }\n\n}\n\nconst idGenerator = new SequentialIdGenerator()\n\nexport default idGenerator\n","// These are \"fixed\" in the sense that they cannot be sorted (dragged/dropped)\nconst sortableTreeFixedPortion = {\n  'setup': [\n    'cameraFolder',\n    'axes'\n  ],\n  'cameraFolder': ['camera'],\n  'axes': [\n    'axis-x',\n    'axis-y',\n    'axis-z',\n    'grid-xy',\n    'grid-yz',\n    'grid-zx'\n  ]\n}\n\nconst initialState = {\n  metaData: {},\n  sortableTree: {\n    ...sortableTreeFixedPortion,\n    root: ['mainFolder'],\n    mainFolder: []\n  },\n  folders: {\n    'cameraFolder': {\n      'isCollapsed': true,\n      'isDropDisabled': true,\n      'isDragDisabled': true,\n      'description': 'Camera Controls'\n    },\n    'axes': {\n      'isCollapsed': false,\n      'isDropDisabled': true,\n      'isDragDisabled': true,\n      'description': 'Axes and Grids'\n    },\n    'mainFolder': {\n      'description': 'A Folder'\n    }\n  },\n  mathSymbols: {},\n  mathGraphics: {\n    'camera': {\n      type: 'CAMERA'\n    },\n    'axis-x': {\n      'type': 'AXIS',\n      'label': 'x'\n    },\n    'axis-y': {\n      'type': 'AXIS',\n      'label': 'y',\n      'axis': 'y'\n    },\n    'axis-z': {\n      'type': 'AXIS',\n      'label': 'z',\n      'axis': 'z',\n      'scale': '1/2'\n    },\n    'grid-xy': {\n      'type': 'GRID',\n      'axes': 'xy'\n    },\n    'grid-yz': {\n      'type': 'GRID',\n      'visible': false,\n      'axes': 'yz'\n    },\n    'grid-zx': {\n      'type': 'GRID',\n      'visible': false,\n      'axes': 'zx'\n    }\n  },\n  sliders: {}\n}\n\nconst demoState = JSON.parse(JSON.stringify(initialState))\ndemoState.mathGraphics['1'] = {\n  'type': 'EXPLICIT_SURFACE',\n  'color': 'rainbow'\n}\ndemoState.sortableTree.mainFolder.push('1')\n\nexport { sortableTreeFixedPortion, demoState }\nexport default initialState\n","import MathObjects, { FOLDER } from 'containers/MathObjects'\nimport idGenerator from 'constants/idGenerator'\nimport initialState, { sortableTreeFixedPortion } from './initialState'\nimport { initialState as metadataInitial } from 'services/metadata/reducer'\n\nfunction isEmpty(obj) {\n  return Object.keys(obj).length === 0 && obj.constructor === Object\n}\n\n// difference in obj1 and obj2\n// ASSUMING obj1 keys are superset of obj2\n// GOAL: { ...obj2, ...simpleDiff(obj1, obj2) } == obj1\nfunction simpleDiff(obj1, obj2, keep = new Set()) {\n  return Object.keys(obj1).reduce((acc, key) => {\n    if (obj1[key] !== obj2[key] || keep.has(key)) {\n      acc[key] = obj1[key]\n    }\n    return acc\n  }, {} )\n}\n\n/**\n *  Diff each mathObject in subStore with its initail value. For items that\n *  exist in initialState, initialValue is taken from initialState. For new\n *  items, initialValue means defaultValue.\n *\n * @param  {object} subStore either mathGraphics, mathSymbols, or folders\n * @param  {object} initialStore initialState of the substore\n * @param  {boolean} isFolders whether the subStore is folders\n * @param  {[type]} subStore either mathGraphics, mathSymbols, or folders\n * @return {[type]}          subStore where each item has been diff'd with\n * item-level defaults\n */\nfunction dehydrateMathObjects(subStore, initialStore, isFolders=false) {\n  const keep = new Set( ['type'] )\n  return Object.keys(subStore).reduce((acc, key) => {\n    const item = subStore[key]\n    const itemType = isFolders ? FOLDER : item.type\n    const defaultSettings = MathObjects[itemType].defaultSettings\n    const diffAgainst = initialStore[key]\n      ? { ...defaultSettings, ...initialStore[key] }\n      : defaultSettings\n    const diff = simpleDiff(item, diffAgainst, keep)\n\n    const differsFromInitial = isFolders\n      ? Object.keys(diff).length > 0\n      : Object.keys(diff).length > 1\n    if (initialStore[key] === undefined || differsFromInitial) {\n      acc[key] = diff\n    }\n\n    return acc\n  }, {} )\n}\n\nfunction rehydrateMathObjects(dehydrated, initialStore, isFolders=false) {\n  const withInitial = { ...initialStore, ...dehydrated }\n  return Object.keys(withInitial).reduce((acc, key) => {\n    const item = withInitial[key]\n    const itemType = isFolders ? FOLDER : item.type\n    const defaultSettings = MathObjects[itemType].defaultSettings\n    const diffAgainst = initialStore[key]\n      ? { ...defaultSettings, ...initialStore[key] }\n      : defaultSettings\n    acc[key] = { ...diffAgainst, ...item }\n    return acc\n  }, {} )\n}\n\nfunction dehydrateFolders(folders, initialFolders) {\n  const partial = dehydrateMathObjects(folders, initialState.folders, true)\n  return Object.fromEntries(\n    Object.entries(partial).filter(([key, value]) => !isEmpty(value))\n  )\n}\n\nfunction rehydrateFolders(sortableTree, folders, initialFolders) {\n  const { root } = sortableTree\n  const emptyFolders = Object.fromEntries(root.map(id => [id, {}]))\n  const toRehydrate = { ...emptyFolders, ...folders }\n  return rehydrateMathObjects(toRehydrate, initialState.folders, true)\n}\n\n/**\n * Take current state and:\n *  - drop drawers\n *  - drop activeObject\n *  - drop fixed portion from sortableTree\n *\n * Now deal with MathObjects (foldres, mathSymbols, mathGraphics)\n *  - diff each MathObject settings with defaultSettings\n *  - for each of [pareErrors, evalErrors, renderErrors]:\n *    diff each entry with defaults, {}\n *    remove if entry = default\n *  - save sliderValues\n */\nexport function dehydrate(state) {\n  const {\n    metadata,\n    sortableTree,\n    folders,\n    mathSymbols,\n    mathGraphics,\n    sliderValues\n  } = state\n\n  const sortableTreeWithoutFixed = Object.keys(sortableTree).reduce((acc, key) => {\n    if (sortableTreeFixedPortion[key] === undefined) {\n      acc[key] = sortableTree[key]\n    }\n    return acc\n  }, { } )\n\n  const keepMeta = new Set( ['versionAtCreation'] )\n  const dehydrated = {\n    metadata: simpleDiff(metadata, metadataInitial, keepMeta),\n    sortableTree: sortableTreeWithoutFixed,\n    folders: dehydrateFolders(folders, initialState.folders),\n    mathSymbols: dehydrateMathObjects(mathSymbols, initialState.mathSymbols),\n    mathGraphics: dehydrateMathObjects(mathGraphics, initialState.mathGraphics),\n    sliderValues\n  }\n\n  const withoutEmpty = Object.fromEntries(\n    Object.entries(dehydrated).filter(([key, value]) => !isEmpty(value))\n  )\n\n  return withoutEmpty\n\n}\n\nexport function rehydrate(dehydrated) {\n  const {\n    metadata,\n    sortableTree: sortableTreeWithoutFixed,\n    folders,\n    mathSymbols,\n    mathGraphics,\n    sliderValues\n  } = dehydrated\n\n  const sortableTree = { ...sortableTreeFixedPortion, ...sortableTreeWithoutFixed }\n  const rehydratedFolders = rehydrateFolders(sortableTree, folders, initialState.folders)\n  const rehydratedSymbols = rehydrateMathObjects(mathSymbols, initialState.mathSymbols)\n  const rehydratedGraphics = rehydrateMathObjects(mathGraphics, initialState.mathGraphics)\n\n  const rehydrated = {\n    activeObject: null,\n    metadata: { ...metadataInitial, ...metadata },\n    sortableTree,\n    sliderValues,\n    folders: rehydratedFolders,\n    mathSymbols: rehydratedSymbols,\n    mathGraphics: rehydratedGraphics,\n    parseErrors: {}, // populated below\n    evalErrors: {}, // populated below\n    renderErrors: {} // populated below\n  }\n\n  // Add in the error-holders\n  Object.keys(rehydratedSymbols)\n    .concat(Object.keys(rehydratedGraphics)).forEach(key => {\n      rehydrated.parseErrors[key] = {}\n      rehydrated.evalErrors[key] = {}\n      rehydrated.renderErrors[key] = {}\n    } )\n\n  const maxId = getMaxId(sortableTree)\n  idGenerator.setNextId(maxId + 1)\n\n  return rehydrated\n\n}\n\nfunction getMaxId(sortableTree) {\n  let maxId = 0\n  sortableTree.root.forEach(folderId => {\n    const folderIdasNumber = parseInt(folderId, 10)\n    if (folderIdasNumber > maxId) {\n      maxId = folderIdasNumber\n    }\n    sortableTree[folderId].forEach(id => {\n      const asNumber = parseInt(id, 10)\n      if (asNumber > maxId) {\n        maxId = asNumber\n      }\n    } )\n  } )\n\n  return maxId\n}\n","import { rehydrate } from './hydration'\nexport const LOAD_STATE = 'LOAD_STATE'\n\nexport function loadDehydratedState(dehydrated) {\n  return {\n    type: LOAD_STATE,\n    payload: {\n      state: rehydrate(dehydrated)\n    }\n  }\n}","import { SET_SAVED_STATE } from './actions';\n\nconst initialState = {\n  state: {},\n}\n\nexport default (state = initialState, action) => {\n  const { type, payload } = action\n  switch (type ) {\n    case SET_SAVED_STATE:\n      return payload.state\n    default:\n      return state\n  }\n}","import update from 'immutability-helper'\nimport { FOLDER } from 'containers/MathObjects'\nimport {\n  PARSE_ERROR,\n  EVAL_ERROR,\n  RENDER_ERROR\n} from './ErrorData'\nimport { SET_ERROR, UNSET_ERROR } from './actions'\nimport {\n  CREATE_MATH_OBJECT,\n  DELETE_MATH_OBJECT\n} from 'containers/MathObjects/actions'\n\nconst initialState = {}\n\nexport function createErrorReducer(errorTypes) {\n  return (state = initialState, action) => {\n\n    const { type, payload, name } = action\n\n    switch (type) {\n\n      case SET_ERROR: {\n        const { id, property } = payload\n        const { type: errorType, errorMsg } = payload.errorData\n\n        return errorTypes.has(errorType)\n          ? update(state, {\n            [id]: { [property]: { $set: errorMsg } }\n          } )\n          : state\n      }\n\n      case UNSET_ERROR: {\n        const { id, property } = payload\n        const { type: errorType } = payload.errorData\n        return errorTypes.has(errorType)\n          ? update(state, {\n            [id]: { $unset: [property] }\n          } )\n          : state\n      }\n\n      case CREATE_MATH_OBJECT: {\n        const { id } = payload\n        // Folders don't have any math-input fields, so they will\n        // never contain errors\n        if (name === FOLDER) {\n          return state\n        }\n        return update(state, { [id]: { $set: {} } } )\n      }\n\n      case DELETE_MATH_OBJECT: {\n        const { id } = payload\n        return update(state, { $unset: [id] } )\n      }\n\n      default:\n        return state\n\n    }\n\n  }\n}\n\nexport const parseErrors = createErrorReducer(new Set( [PARSE_ERROR] ))\nexport const evalErrors = createErrorReducer(new Set( [EVAL_ERROR] ))\nexport const renderErrors = createErrorReducer(new Set( [RENDER_ERROR] ))\n","import cloneDeep from 'clone-deep'\nimport { combineReducers } from 'redux'\nimport drawers from 'containers/Drawer/reducer'\nimport tabs from 'containers/ControlledTabs/reducer'\nimport sortableTree from 'containers/SortableTree/reducer'\nimport sliderValues from 'containers/MathObjects/MathSymbols/VariableSlider/reducer'\nimport activeObject from 'containers/MathObjects/services/activeObject/reducer'\nimport metadata from 'services/metadata/reducer'\nimport {\n  folders,\n  mathGraphics,\n  mathSymbols\n} from 'containers/MathObjects/reducer'\nimport { LOAD_STATE } from './actions'\nimport lastSavedState from 'services/lastSavedState/reducer'\n\nimport {\n  parseErrors,\n  evalErrors,\n  renderErrors\n} from 'services/errors/reducer'\n\nconst combinedReducer = combineReducers( {\n  metadata,\n  drawers,\n  tabs,\n  sortableTree,\n  folders,\n  mathGraphics,\n  mathSymbols,\n  parseErrors,\n  evalErrors,\n  renderErrors,\n  sliderValues,\n  activeObject,\n  lastSavedState\n} )\n\nexport default function rootReducer(state, action) {\n  if (action.type === LOAD_STATE) {\n    const { lastSavedState: previousLastSavedState, ...oldState } = state\n    const newState = { ...oldState, ...action.payload.state }\n    const lastSavedState = cloneDeep(newState)\n    return { ...newState, lastSavedState }\n  }\n  return combinedReducer(state, action)\n}\n","// @flow\nexport const SET_TITLE = 'SET_TITLE'\n\nexport function setTitle(title: string) {\n  return {\n    type: SET_TITLE,\n    payload: { title }\n  }\n}\n\nexport const SET_CREATION_DATE = 'SET_CREATION_DATE'\n\nexport function setCreationDate() {\n  return {\n    type: SET_CREATION_DATE,\n    payload: { creationDate: JSON.stringify(new Date()) }\n  }\n}\n","export const SET_ACTIVE_TAB = 'SET_ACTIVE_TAB'\n\nexport function setActiveTab(id, activeTab) {\n  return {\n    type: SET_ACTIVE_TAB,\n    payload: { activeTab, id }\n  }\n}\n","export const EDIT_FOLDER_TITLE = 'EDIT_FOLDER_TITLE'\nexport const ADD_FOLDER = 'ADD_FOLDER'\nexport const ADD_FOLDER_ITEM = 'ADD_FOLDER_ITEM'\nexport const DRAG_TO_NEW_DROPPABLE = 'DRAG_TO_NEW_DROPPABLE'\nexport const REORDER_WITHIN_DROPPABLE = 'REORDER_WITHIN_DROPPABLE'\n\n/**\n * action creator for reordering draggables. The argument object is essentially\n * a react-beautiful-dnd DropResult object.\n *\n * @param  {object} source      [description]\n * @param  {string} source.droppableId\n * @param  {number} source.index position in source list\n * @param  {object} destination [description]\n * @param  {string} destination.droppableId\n * @param  {number} destination.index position in destination list\n * @param  {string} draggableId\n */\nexport const dragToNewDroppable = ( { source, destination, draggableId } ) => ( {\n  type: DRAG_TO_NEW_DROPPABLE,\n  payload: {\n    source,\n    destination,\n    draggableId\n  }\n} )\n\nexport const reorderWithinDroppable = ( { source, destination, draggableId } ) => ( {\n  type: REORDER_WITHIN_DROPPABLE,\n  payload: {\n    source,\n    destination,\n    draggableId\n  }\n} )\n","import { SET_ACTIVE_OBJECT } from './actions'\n\nconst initialState = null\n\nexport default function(state = initialState, { type, payload } ) {\n  switch (type) {\n\n    case SET_ACTIVE_OBJECT:\n      return payload.id\n    default:\n      return state\n\n  }\n}\n","import cloneDeep from 'clone-deep'\nexport const SET_SAVED_STATE = 'SET_SAVED_STATE';\n\nfunction setLastSavedStateAs(state) {\n  return {\n    type: SET_SAVED_STATE,\n    payload: { state },\n  }\n}\n\nexport function setLastSavedState() {\n  return (dispatch, getStore) => {\n    const clonedStore = cloneDeep(getStore());\n    return dispatch(setLastSavedStateAs(clonedStore))\n  }\n}","// import React from 'react' // used by why-did-you-update\nimport { createStore, applyMiddleware, compose } from 'redux'\nimport rootReducer from './reducer'\nimport thunk from 'redux-thunk'\nimport { enableBatching } from 'redux-batched-actions'\nimport { demoState } from './initialState'\nimport { rehydrate } from './hydration'\n\nconst enhancers = []\nconst middleware = [thunk]\n\nif (process.env.NODE_ENV === 'development') {\n  const devToolsExtension = window.__REDUX_DEVTOOLS_EXTENSION__\n\n  if (typeof devToolsExtension === 'function') {\n    enhancers.push(devToolsExtension())\n  }\n\n  // const { whyDidYouUpdate } = require('why-did-you-update')\n  // whyDidYouUpdate(React) // logs potentially unnecessary re-renders\n\n}\n\nconst composedEnhancers = compose(\n  applyMiddleware(...middleware),\n  ...enhancers\n)\n\nconst store = createStore(\n  enableBatching(rootReducer),\n  rehydrate(demoState),\n  composedEnhancers\n)\n\nexport default store\n","import styled from 'styled-components'\n\nexport default styled.div`\n  display:flex;\n  height:100%;\n`\n","import Drawer from './components/Drawer'\nimport { connect } from 'react-redux'\nimport { openDrawer, closeDrawer } from './actions'\n\nconst mapStateToProps = ( { drawers }, ownProps) => ( {\n  isOpen: drawers[ownProps.id].isVisible,\n  isAnimating: drawers[ownProps.id].isAnimating,\n  width: drawers[ownProps.id].width\n} )\n\nconst mapDispatchToProps = {\n  onOpen: openDrawer,\n  onClose: closeDrawer\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Drawer)\n","import React from 'react'\nimport { DragDropContext } from 'react-beautiful-dnd'\nimport SortableList from 'components/SortableList'\nimport Folder from 'containers/MathObjects/Folder'\nimport styled from 'styled-components'\nimport PropTypes from 'prop-types'\n\nconst FolderComponent = Folder.uiComponent\n\nconst SortableListOfFolders = styled(SortableList)`\n  width:100%;\n  border-bottom: 1px solid ${props => props.theme.gray[5]};\n`\n\nMathTree.propTypes = {\n  onDragEnd: PropTypes.func.isRequired,\n  items: PropTypes.arrayOf(PropTypes.object.isRequired).isRequired\n}\n\nexport default function MathTree(props) {\n  return (\n    <DragDropContext onDragEnd={props.onDragEnd}>\n      <SortableListOfFolders\n        droppableType='FOLDER'\n        draggableType='FOLDER'\n        droppableId={'root'}\n        items={props.items}\n        renderItem={(item) => <FolderComponent id={item.id} /> }\n      />\n    </DragDropContext>\n  )\n}\n","import { connect } from 'react-redux'\nimport {\n  reorderWithinDroppable,\n  dragToNewDroppable\n} from './actions'\nimport MathTree from './components/MathTree'\n\nfunction getItems(itemIds, folders) {\n  return itemIds.map(id => ( {\n    id,\n    isDragDisabled: folders[id].isDragDisabled\n  } ))\n}\n\nconst mapStateToProps = ( { sortableTree, folders }, ownProps) => ( {\n  items: getItems(sortableTree[ownProps.root], folders)\n} )\n\nconst mapDispatchToProps = (dispatch) => ( {\n  onDragEnd: (dropResult) => {\n    if (!dropResult.destination) {\n      return\n    }\n    else if (dropResult.destination.droppableId === dropResult.source.droppableId) {\n      return dispatch(reorderWithinDroppable(dropResult))\n    }\n    return dispatch(dragToNewDroppable(dropResult))\n\n  }\n} )\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MathTree)\n","// @flow\nimport * as React from 'react'\nimport styled from 'styled-components'\nimport { Menu, Dropdown, Button, Icon } from 'antd'\nimport idGenerator from 'constants/idGenerator'\nimport typeof {\n  createMathObject as CreateMathObject\n} from 'containers/MathObjects/actions'\nimport { FOLDER } from 'containers/MathObjects/Folder/metadata'\nimport type { Support } from 'containers/MathObjects/MathObject'\n\nconst NewObjectButton = styled(Button)`\n  font-weight: bold;\n  &.ant-btn, &.ant-btn:hover, &.ant-btn:focus {\n    padding-left: 20px;\n    padding-right:20px;\n    background-color:rgba(0,0,0,0);\n  }\n`\n\nconst GradientDiv = styled.div`\n  display:inline-block;\n  border-radius:4px; /*Same as ant-d*/\n  background: linear-gradient(\n    ${props => props.theme.gray[1]},\n    ${props => props.theme.gray[4]}\n    );\n  &.ant-dropdown-trigger {\n    line-height: 1.5;\n    margin-top:16px;\n    margin-bottom:16px;\n    margin-right:16px;\n  };\n`\n\nconst WarningSpan = styled.span`\n  color: ${props => props.theme.gray[5]}\n`\n\ntype MenuItem = {\n  type: string,\n  description: string,\n  support: Support\n}\n\nexport type OwnProps = {|\n  menuItems: Array<MenuItem>\n|}\ntype StateProps = {|\n  targetFolder: string,\n  newFolderIndex: number,\n  newItemIndex: number,\n|}\ntype DispatchProps = {|\n  setActiveObject: (string) => void,\n  setContentCollapsed: (string, boolean) => void,\n  createMathObject: CreateMathObject\n|}\nexport type Props = {|\n  ...OwnProps,\n  ...StateProps,\n  ...DispatchProps\n|}\n\nexport default class ControllerHeader extends React.PureComponent<Props> {\n\n  handleMenuClick = ( { key }: { key: string } ) => {\n    const id = idGenerator.next()\n    const parentFolderId = key === FOLDER\n      ? 'root'\n      : this.props.targetFolder\n    const positionInFolder = key === FOLDER\n      ? this.props.newFolderIndex\n      : this.props.newItemIndex\n\n    this.props.createMathObject(id, key, parentFolderId, positionInFolder)\n\n    if (key !== FOLDER) {\n      this.props.setContentCollapsed(this.props.targetFolder, false)\n    }\n\n    this.props.setActiveObject(id)\n\n  }\n\n  renderMenuItem = ( { type, description, support }: MenuItem) => {\n    return (\n      <Menu.Item key={type}>\n        {description}\n        {support === 'experimental' && (\n          <WarningSpan>\n            {' '}( <Icon type=\"experiment\" /> Unstable Feature)\n          </WarningSpan>\n        )}\n      </Menu.Item>\n    )\n  }\n\n  renderMenu = () => {\n    return (\n      <Menu onClick={this.handleMenuClick}>\n        {this.props.menuItems.map(this.renderMenuItem)}\n      </Menu>\n    )\n  }\n\n  render() {\n    return (\n      <Dropdown\n        overlay={this.renderMenu()}\n        trigger={['click']}\n      >\n        <GradientDiv>\n          <NewObjectButton>\n            <Icon type=\"plus\" />\n            Add Object\n          </NewObjectButton>\n        </GradientDiv>\n      </Dropdown>\n    )\n  }\n\n}\n","import { getParent } from 'containers/MathObjects/selectors'\n\nconst FORBIDDEN_INSERT_FOLDERS = new Set( [\n  'axes',\n  'cameraFolder'\n] )\n\n/**\n * gets the folder corresponding to activeObject, which is:\n * - the id of the folder containing activeObject if activeObject\n * - null if activeObject is null\n *\n * @param  {Object} tree maps folderIds to objectIds\n * @param  {?string} activeObject id of activeObject\n * @return {?string} string of folder corresponding to activeObject\n */\nexport function getActiveFolder(tree, activeObject) {\n  if (activeObject === null) {\n    return null\n  }\n  if (tree[activeObject] ) {\n    return FORBIDDEN_INSERT_FOLDERS.has(activeObject) ? null : activeObject\n  }\n  // getParent will throw an error if no parent or multiple parents\n  const parent = getParent(tree, activeObject)\n\n  return FORBIDDEN_INSERT_FOLDERS.has(parent) ? null : parent\n}\n","// @flow\nimport ControllerHeader from './components/ControllerHeader'\nimport type { Props, OwnProps } from './components/ControllerHeader'\nimport { connect } from 'react-redux'\nimport { getActiveFolder } from './selectors'\nimport { createMathObject } from 'containers/MathObjects/actions'\nimport { setActiveObject } from 'containers/MathObjects/services/activeObject/actions'\nimport { setContentCollapsed } from 'containers/MathObjects/Folder/actions'\n\nconst mapStateToProps = ( { activeObject, sortableTree } ) => {\n  const treeRoot = sortableTree.root\n  const activeFolder = getActiveFolder(sortableTree, activeObject)\n\n  if (Object.keys(treeRoot).length === 0) {\n    throw Error('root folder requires at least 1 child')\n  }\n\n  // If no active folder, insert new items into last folder\n  const targetFolder = activeFolder || treeRoot[treeRoot.length - 1]\n  const newFolderIndex = treeRoot.indexOf(targetFolder) + 1\n\n  const newItemIndex = sortableTree[targetFolder].includes(activeObject)\n    ? sortableTree[targetFolder].indexOf(activeObject) + 1\n    : 0\n\n  return {\n    targetFolder,\n    newFolderIndex,\n    newItemIndex\n  }\n}\n\nconst mapDispatchToProps = ( {\n  createMathObject,\n  setActiveObject,\n  setContentCollapsed\n} )\n\nexport default connect<Props, OwnProps, _, _, _, _>(\n  mapStateToProps, mapDispatchToProps\n)(ControllerHeader)\n","// @flow\nimport * as React from 'react'\nimport styled from 'styled-components'\n\n/**\n * ScrollWithOverflow is a component intended to allow scrolling in the\n * y-direction and overflow in the x-direction.\n *\n * Naively, this would just be achieved by setting\n *    overflow-x: visible;\n *    overflow-y: scroll;\n * on whatever div you want. But that doesn't work:\n *    https://stackoverflow.com/questions/6421966/css-overflow-x-visible-and-overflow-y-hidden-causing-scrollbar-issue\n * This component solves the problem by adding positive padding and\n * negative margin:\n *  padding-right: 100vw;\n *  margin-right: -100vw;\n * so that children can appear to overflow without actually overflowing.\n *\n * This approach has a few downsides:\n *  1. Other elements covered by the padding region do not emit pointer events.\n *  2. The scrollbar disappears (pushed by padding)\n *\n * To resolve #1, we use event handlers to forward events to the covered up\n * mathbox canvas element. Note: this works for because only 1 element is\n * covered. If multiple elements were covered, we'd have trouble\n *\n * I currently have not good solution for #2.\n *\n */\n\nconst ScrollingDiv = styled.div`\n  display:flex;\n  overflow-y: scroll;\n  padding-right: 100vw;\n  margin-right: -100vw;\n  height: 100%;\n`\n\nconst ScrollingDivInner = styled.div`\n  overflow-x:visible;\n  height:100%;\n  pointer-events: auto;\n  flex-grow: 0;\n  flex-shrink: 0;\n  flex-basis: 1;\n  width:100%;\n  /* The z-index means that elements overflowing from ScrollingDivInner into\n  PaddingCover still trigger the current pointer events within their\n  overflowing region */\n  z-index:10;\n`\n\n/**\n * This is absolutely positioned so that when the left control panel scrolls,\n * the padding cover stays in place.\n * Ruins the generality of this component, but works fine for our use case =/\n * \n * + 400px is for the sidebar width, so padding cover covers the whole screen\n * when sidebar is slide left.\n * \n */\nconst PaddingCover = styled.div`\n  flex-grow: 0;\n  flex-shrink: 0;\n  flex-basis: 0;\n  max-width:0px;\n  padding-right: calc(100vw + 400px);\n  margin-right: -100vw;\n  position: absolute;\n  bottom:0;\n  top: 65px;\n`\n\nfunction forwardEventToElement(domElement: HTMLElement, event: Event) {\n  event.stopPropagation()\n  event.preventDefault()\n  // $FlowFixMe\n  const syntheticEvent = new event.constructor(event.type, event)\n  domElement.dispatchEvent(syntheticEvent)\n}\n\ntype Props = {\n  children?: React.Node\n}\n\ntype State = {\n  isScrollEnabled: boolean\n}\n\nexport default class ScrollWithOverflow extends React.PureComponent<Props, State> {\n\n  coverRef: { current: null | HTMLDivElement }\n\n  eventNames = [\n    'mousedown', 'mousemove', 'mouseup', 'wheel',\n    'touchstart', 'touchmove', 'touchend'\n  ]\n\n  domElement = window.mathbox.three.controls.domElement\n\n  constructor(props: Props) {\n    super(props)\n    this.coverRef = React.createRef()\n  }\n\n  forwardEvent = (event: Event) => {\n    forwardEventToElement(this.domElement, event)\n  }\n\n  componentDidMount() {\n    const { current } = this.coverRef\n    if (current === null) { return }\n    const options = { passive: false }\n    this.eventNames.forEach(eventName => {\n      current.addEventListener(eventName, this.forwardEvent, options)\n    } )\n  }\n\n  componentWillUnmount() {\n    const { current } = this.coverRef\n    if (current === null) { return }\n    this.eventNames.forEach(eventName => {\n      current.removeEventListener(eventName, this.forwardEvent)\n    } )\n  }\n\n  render() {\n    return (\n      <ScrollingDiv>\n        <ScrollingDivInner>\n          {this.props.children}\n        </ScrollingDivInner>\n        <PaddingCover ref={this.coverRef} />\n      </ScrollingDiv>\n    )\n  }\n\n}\n","// @flow\nimport * as React from 'react'\nimport { connect } from 'react-redux'\nimport { setActiveTab } from './actions'\nimport { Tabs } from 'antd'\n\n// TabProps is missing some props\ntype TabProps = {|\n  activeKey: string\n|}\ntype OwnProps = {|\n  id: string,\n  ...TabProps\n|}\ntype DispatchProps = {|\n  setActiveTab: (id: string, activeKey: string) => void\n|}\ntype Props = {\n  ...OwnProps,\n  ...DispatchProps\n}\n\nclass _ControlledTabs extends React.PureComponent<Props> {\n\n  onChange = (activeKey: string) => {\n    this.props.setActiveTab(this.props.id, activeKey)\n  }\n\n  render() {\n    const { id, ...otherProps } = this.props\n    return (\n      <Tabs {...otherProps} onChange={this.onChange} />\n    )\n  }\n\n}\n\nconst mapStateToProps = ( { tabs }, ownProps) => ( {\n  activeKey: tabs[ownProps.id].activeTab\n} )\n\nconst mapDispatchToProps = { setActiveTab }\n\nexport default connect<Props, OwnProps, _, _, _, _>(mapStateToProps, mapDispatchToProps)(_ControlledTabs)\nexport const TabPane = Tabs.TabPane\n","import React from 'react'\nimport Drawer from 'containers/Drawer'\nimport SortableTree from 'containers/SortableTree'\nimport ControllerHeader from 'containers/ControllerHeader'\nimport ScrollWithOverflow from 'components/ScrollWithOverflow'\nimport { HEADER_HEIGHT_PX } from '../../../../constants'\nimport MathObjects, {\n  Folder,\n  MathSymbols,\n  MathGraphics,\n  AXIS, GRID, CAMERA\n} from 'containers/MathObjects'\nimport ControlledTabs, { TabPane } from 'containers/ControlledTabs'\nimport styled from 'styled-components'\n\n// First sort the MathObject keys in the order we want, then extract the\n// data relevant to ControllerHeader\nconst omit = new Set( [AXIS, GRID, CAMERA] )\nconst menuItems = [\n  Folder.type,\n  ...Object.keys(MathGraphics).filter(x => !omit.has(x)).sort(),\n  ...Object.keys(MathSymbols).sort()\n].map(type => ( {\n  type,\n  description: MathObjects[type].defaultSettings.description,\n  support: MathObjects[type].support\n} ))\n\nconst StyledControlledTabs = styled(ControlledTabs)`\n  &.ant-tabs {\n    overflow: visible;\n    height: calc(100% - ${ HEADER_HEIGHT_PX }px);\n  }\n  & .ant-tabs-bar {\n    height: 65px;\n    margin-bottom: 0px;\n  }\n  & > .ant-tabs-content {\n    height: calc(100% - 65px);\n  }\n  & > .ant-tabs-content > ant-tabs-tabpane {\n    height: 100%;\n  }\n`\n\nconst ControlsDrawer = () => {\n  return (\n    <Drawer id='main'>\n      <StyledControlledTabs\n        id='controls'\n        tabBarExtraContent={<ControllerHeader menuItems={menuItems}/>}\n      >\n        <TabPane tab='Main' key='1'>\n          <ScrollWithOverflow>\n            <SortableTree root='root' />\n          </ScrollWithOverflow>\n        </TabPane>\n        <TabPane tab={<span> Axes & <br/> Camera</span>} key='2'>\n          <ScrollWithOverflow>\n            <SortableTree root='setup' />\n          </ScrollWithOverflow>\n        </TabPane>\n      </StyledControlledTabs>\n    </Drawer>\n  )\n}\n\nexport default ControlsDrawer\n","export const HEADER_HEIGHT_PX = 48;","// @flow\nimport React from 'react'\nimport { connect } from 'react-redux'\nimport withSizes from 'react-sizes'\nimport { closeDrawer, openDrawer, setWidth } from './actions'\nimport { DEFAULT_WIDTH } from './reducer'\nimport { MOBILE_BREAKPOINT } from 'constants/theme'\n\ntype DispatchProps = {|\n  openDrawer: string => void,\n  closeDrawer: string => void,\n  setWidth: (id: string, width: string) => void,\n|}\ntype OwnProps = {|\n  isSmall: boolean,\n  id: string\n|}\ntype Props = {|\n  ...DispatchProps,\n  ...OwnProps\n|}\n\nclass ScreenSizeDrawerManager extends React.PureComponent<Props> {\n\n  resize() {\n    const { id, isSmall, closeDrawer, openDrawer, setWidth } = this.props\n    if (isSmall) {\n      closeDrawer(id)\n      setWidth(id, '290px')\n    }\n    else {\n      openDrawer(id)\n      setWidth(id, DEFAULT_WIDTH)\n    }\n  }\n\n  componentDidUpdate() {\n    this.resize()\n  }\n\n  componentDidMount() {\n    this.resize()\n  }\n\n  render() {\n    return null\n  }\n\n}\n\nconst mapSizesToProps = ( { width } ) => ( { isSmall: width < MOBILE_BREAKPOINT } )\nconst mapDispatchToProps = { openDrawer, closeDrawer, setWidth }\n\nexport default connect<Props, OwnProps, _, _, _, _>(null, mapDispatchToProps)(\n  withSizes(mapSizesToProps)(ScreenSizeDrawerManager)\n)\n","import React, { Fragment } from 'react'\nimport ControlsDrawer from './components/ControlsDrawer'\nimport ScreenSizeDrawerManager from 'containers/Drawer/ScreenSizeDrawerManager'\n\nexport default function UserControls() {\n  return (\n    <Fragment>\n      <ControlsDrawer />\n      <ScreenSizeDrawerManager id='main'/>\n    </Fragment>\n  )\n}\n","import React, { PureComponent } from 'react'\nimport styled, { css } from 'styled-components'\nimport PropTypes from 'prop-types'\n\nconst MathBoxOuterDiv = styled.div`\n  width: 100%;\n  transform: translateX(${props => props.leftOffset});\n  transition-duration: 1s;\n  & ${props => !props.isAnimating && css`\n    transition-duration: 0s;\n  `}\n`\n\n/**\n * This is a wrapper around the MathBox div with a few props to influence\n * positioning.\n *\n * @type {PureComponent}\n */\n\nexport default class MathBoxContainer extends PureComponent {\n\n  static propTypes = {\n    leftOffset: PropTypes.string.isRequired,\n    mathboxElement: PropTypes.instanceOf(Element),\n    children: PropTypes.oneOfType( [\n      PropTypes.arrayOf(PropTypes.node),\n      PropTypes.node\n    ] )\n  }\n\n  assignRef = ref => {\n    this.ref = ref\n  }\n\n  componentDidMount() {\n    const mathboxElement = this.props.mathboxElement\n    mathboxElement.parentNode.removeChild(mathboxElement)\n    this.ref.appendChild(mathboxElement)\n  }\n\n  render() {\n    return (\n      <MathBoxOuterDiv\n        leftOffset={this.props.leftOffset}\n        ref={this.assignRef}>\n        {this.props.children}\n      </MathBoxOuterDiv>\n    )\n  }\n\n}\n","import { connect } from 'react-redux'\nimport MathBoxContainer from './components/MathBoxContainer'\n\nfunction getLeftAnimationStatus(state) {\n  return state.drawers.main.isAnimating\n}\n\nfunction getLeftOffset(state) {\n  const width = 400\n  const { isVisible } = state.drawers.main\n  return isVisible ? `${-width / 2}px` : '0px'\n}\n\nconst mapStateToProps = (state, ownProps) => ( {\n  leftOffset: getLeftOffset(state),\n  isAnimating: getLeftAnimationStatus(state)\n} )\n\nexport default connect(mapStateToProps)(MathBoxContainer)\n","// @flow\nimport type {\n  HandledProps as GraphicHandledProps,\n  ErrorMap\n} from 'components/MathBox/MathBoxComponents'\nimport React, { PureComponent } from 'react'\nimport { MathBox, Cartesian } from 'components/MathBox'\nimport { MathScopeConsumer } from 'containers/MathScopeContext'\nimport { MathGraphics } from 'containers/MathObjects'\nimport PropTypes from 'prop-types'\nimport { parser } from 'constants/parsing'\nimport { RenderErrorData, setError } from 'services/errors'\nimport {\n  evalData,\n  handleEvalErrors,\n  filterObject\n} from 'services/evalData'\ntype SetError = typeof setError\n\ntype ErrorState = {\n  [id: string]: { [propName: string]: string }\n}\ntype Props = {\n  order: Array<string>,\n  mathGraphics: { [id: string]: Object },\n  evalErrors: ErrorState,\n  renderErrors: ErrorState,\n  setError: SetError\n}\nexport default class MathBoxScene extends PureComponent<Props> {\n\n  static propTypes = {\n    order: PropTypes.array.isRequired,\n    mathGraphics: PropTypes.object.isRequired,\n    evalErrors: PropTypes.object.isRequired,\n    renderErrors: PropTypes.object.isRequired,\n    setError: PropTypes.func.isRequired\n  }\n\n  constructor(props: Props) {\n    super(props)\n    // $FlowFixMe\n    this.handleRenderErrors = this.handleRenderErrors.bind(this)\n  }\n\n  handleRenderErrors(errors: ErrorMap, id: string, updatedProps: GraphicHandledProps) {\n    const setError = this.props.setError\n    // dispatch new errors\n    Object.keys(errors)\n      // error[prop] === null represents errors that should be removed. We\n      // deal with this case separately below so as not to dispatch error\n      // removal unless the error previously existed\n      .filter(prop => errors[prop] !== null)\n      .forEach(prop => {\n        // $FlowFixMe Flow is having trouble with object filter refinements\n        const errMsg: string = errors[prop].message\n        setError(id, prop, new RenderErrorData(errMsg))\n      } )\n\n    const oldErrors = this.props.renderErrors\n    // clear old errors that are no longer present\n    Object.keys(oldErrors[id] )\n      .filter(prop => updatedProps.hasOwnProperty(prop)) // make sure the prop was updated\n      .filter(prop => !errors.hasOwnProperty(prop)) // make sure updated prop does not have error\n      .forEach(prop => { // clear the error\n        setError(id, prop, new RenderErrorData())\n      } )\n\n    // clear old errors that were explicitly removed\n    Object.keys(errors)\n      .filter(prop => oldErrors[id].hasOwnProperty(prop)) // prop previously had error\n      .filter(prop => errors[prop] === null) // prop no longer has error\n      .forEach(prop => { // clear the error\n        setError(id, prop, new RenderErrorData())\n      } )\n  }\n\n  // TODO: this causes some unnecessary re-renders when tryEval returns an array\n  // that is numerically equal but not triple=\n  renderGraphic(id: string, data: Object) {\n    const Graphic = MathGraphics[data.type].mathboxComponent\n\n    // Fractional zOrder seems to behave strangely sometimes, hence *100\n    const zOrder = typeof data.opacity === 'number'\n      ? (1 - data.opacity)*100\n      : 0\n    return (\n      <Graphic\n        id={id}\n        key={id}\n        zOrder={zOrder}\n        {...data}\n        handleErrors={this.handleRenderErrors}\n      />\n    )\n  }\n\n  render() {\n    const { mathGraphics, evalErrors, setError } = this.props\n    return (\n      <MathScopeConsumer>\n        {( { scope, scopeDiff } ) => {\n          return (\n            <MathBox mathbox={window.mathbox}>\n              <Cartesian id='rootCartesian'>\n                {this.props.order.map(id => {\n                  const settings = mathGraphics[id]\n                  const existingErrors = evalErrors[id]\n                  const computedProps = MathGraphics[settings.type].computedProps\n                  const toEvaluate = filterObject(settings, computedProps)\n                  const {\n                    evaluated,\n                    evalErrors: newErrors\n                  } = evalData(parser, toEvaluate, scope)\n                  handleEvalErrors(id, newErrors, existingErrors, setError)\n                  return this.renderGraphic(id, { ...settings, ...evaluated } )\n                } )\n                }\n              </Cartesian>\n            </MathBox>\n          )\n        }}\n      </MathScopeConsumer>\n    )\n  }\n\n}\n","import MathBoxScene from './components/MathBoxScene'\nimport { connect } from 'react-redux'\nimport { setError } from 'services/errors'\n\nconst mapStateToProps = ( { mathGraphics, evalErrors, renderErrors } ) => ( {\n  mathGraphics,\n  evalErrors,\n  renderErrors,\n  order: Object.keys(mathGraphics)\n} )\n\nconst mapDispatchToProps = {\n  setError\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MathBoxScene)\n","import React, { PureComponent } from 'react'\nimport MathBoxContainer from 'containers/MathBoxContainer'\nimport MathBoxScene from 'containers/MathBoxScene'\nimport styled from 'styled-components'\n\nconst SceneBoundary = styled.div`\n  display:flex;\n  height:100%;\n  overflow: hidden;\n  flex: 1;\n`\n\nexport default class Math3dScene extends PureComponent {\n\n  render() {\n    return (\n      <SceneBoundary>\n        <MathBoxContainer mathboxElement={window.mathboxElement}>\n          <MathBoxScene />\n        </MathBoxContainer>\n      </SceneBoundary>\n    )\n  }\n\n}\n","// @flow\nimport React from 'react'\nimport type { Examples, ExampleItem } from './data'\nimport { NavLink } from 'react-router-dom'\n\ntype Props = {\n  data: Examples\n}\n\nexport default function ExamplesList(props: Props) {\n  const { data } = props\n  return (\n    <ul>\n      {\n        data.map((example: ExampleItem, index: number) => {\n          return (\n            <li key={index}>\n              <NavLink to={`/${example.id}`}>\n                {example.title}\n              </NavLink>\n              {example.description}\n            </li>\n          )\n        } )\n      }\n    </ul>\n  )\n}\n","// @flow\n\nexport type ExampleItem = {\n  id: string,\n  title: string,\n  description?: string\n}\n\nexport type Examples = Array<ExampleItem>\n\nexport const featureDemos: Examples = [\n  {\n    id: 'sliders_intro',\n    title: 'Using Variable Sliders'\n  },\n  {\n    id: 'sliders_plotrange',\n    title: 'Using Sliders to Animate Plot Range'\n  },\n  {\n    id: 'color_and_visibility',\n    title: 'Color and Visibility'\n  },\n  {\n    id: 'vectors',\n    title: 'Vectors and Vector Tails'\n  },\n  {\n    id: 'labels',\n    title: 'Labeling Points, Vectors, and Lines'\n  },\n  {\n    id: 'functions',\n    title: 'Using Functions'\n  },\n  {\n    id: 'derivatives',\n    title: 'diff: Using Derivatives'\n  },\n  {\n    id: 'calculated_visibility',\n    title: 'Controlling Multiple Object Visibility with Toggles'\n  },\n  {\n    id: 'z_bias',\n    title: 'Fine-tuning Visibility with z-bias'\n  },\n  {\n    id: 'tnb',\n    title: 'The TNB Vectors for Parametric Curves'\n  },\n  {\n    id: 'animate_camera',\n    title: 'Animating the Camera Position'\n  }\n]\n\nexport const neatExamples: Examples = [\n  {\n    id: 'motion',\n    title: 'Motion: Velocity and Acceleration'\n  },\n  {\n    id: 'ruled_hyperboloid',\n    title: 'Ruled Hyperboloid'\n  },\n  {\n    id: 'horizontal_revolution_washer',\n    title: 'Surface of Revolution: Washer Method (Horizontal Axis)'\n  },\n  {\n    id: 'vertical_revolution_shell_method',\n    title: 'Surface of Revolution: Shell Method (Vertical Axis)'\n  },\n  {\n    id: 'sphere_colormap',\n    title: 'Color Maps on a Sphere'\n  },\n  {\n    id: 'osculating_circle',\n    title: 'Osculating Circle'\n  }\n]\n","import React from 'react'\nimport Drawer from 'containers/Drawer'\nimport ControlledTabs, { TabPane } from 'containers/ControlledTabs'\nimport ExamplesList from './ExamplesList'\nimport { neatExamples, featureDemos } from './data'\n\nconst Examples = (props) => {\n  return (\n    <Drawer id='examples' slideTo='right'>\n      <ControlledTabs id='examples'>\n        <TabPane key='1' tab='Feature Demos'>\n          <ExamplesList data={featureDemos}/>\n        </TabPane>\n        <TabPane key='2' tab='Neat Examples'>\n          <ExamplesList data={neatExamples}/>\n        </TabPane>\n      </ControlledTabs>\n    </Drawer>\n  )\n}\n\nexport default Examples\n","// @flow\nimport * as React from 'react'\nimport { Popover, Modal, Button } from 'antd'\nimport withSizes from 'react-sizes'\n\ntype Props = {\n  useModal: boolean,\n  children: React.Node,\n  popoverPlacement: ('top'\n    | 'left'\n    | 'right'\n    | 'bottom'\n    | 'topLeft'\n    | 'topRight'\n    | 'bottomLeft'\n    | 'bottomRight'\n    | 'leftTop'\n    | 'leftBottom'\n    | 'rightTop'\n    | 'rightBottom'\n  ),\n  popoverMaxWidth: string,\n  title: string,\n  source: React.Node,\n  onVisibleChange?: (visible: boolean) => void\n}\n\n_PopModal.defaultProps = {\n  popoverPlacement: 'bottomRight',\n  popoverMaxWidth: '300px'\n}\n\n/**\n * PopModal:\n * Displays as a modal overlay on small screens, and a popover on large screens.\n * Threshhold is currently 570px.\n */\nfunction _PopModal(props: Props) {\n  const [visible, _setVisible] = React.useState(false)\n  function setVisible(visible: boolean) {\n    _setVisible(visible)\n    if (props.onVisibleChange) {\n      props.onVisibleChange(visible)\n    }\n  }\n\n  return props.useModal\n    ? (\n      <>\n        <Modal\n          title={props.title}\n          visible={visible}\n          onCancel={() => setVisible(!visible)}\n          maskClosable={true}\n          style={ { maxWidth: props.popoverMaxWidth } }\n          footer={[\n            <Button key='ok' onClick={() => setVisible(!visible)}>\n              OK\n            </Button>\n          ]}\n        >\n          {props.children}\n        </Modal>\n        <span onClick={() => setVisible(!visible)}>\n          {props.source}\n        </span>\n      </>\n    )\n    : (\n      <Popover\n        placement={props.popoverPlacement}\n        overlayStyle={ { maxWidth: props.popoverMaxWidth } }\n        title={props.title}\n        content={props.children}\n        onVisibleChange={() => setVisible(!visible)}\n        trigger='click'\n      >\n        {props.source}\n      </Popover>\n    )\n\n}\n\nconst mapSizesToProps = ( { width } ) => ( { useModal: width < 570 } )\n\nexport default withSizes(mapSizesToProps)(_PopModal)\n","// Example api call:\n\nexport const getGraph = async (id) => fetch(`api/graph/${id}`, {\n  method: 'GET',\n  headers: {}\n} ).then(res => res.json())\n\nexport const saveGraph = async (id, dehydrated) => {\n  const body = {\n    urlKey: id,\n    dehydrated\n  }\n  return fetch(`/api/graph`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(body)\n  } ).then(res => res.json())\n}\n","// @flow\nexport default function() {\n  const position: Array<number> = window.mathbox.three.camera.position.toArray()\n  const lookAt: Array<number> = window.mathbox.three.controls.center.toArray()\n  return { position, lookAt }\n}\n","// @flow\nimport React, { PureComponent } from 'react'\nimport { Button, Icon, Input } from 'antd'\nimport PopModal from 'components/PopModal'\nimport { saveGraph } from 'services/api'\nimport { dehydrate } from 'store/hydration'\nimport randomstring from 'randomstring'\nimport { CopyToClipboard } from 'react-copy-to-clipboard'\nimport typeof { setProperty as SetProperty } from 'containers/MathObjects/actions'\nimport typeof { setCreationDate as SetCreationDate } from 'services/metadata/actions'\nimport getCameraData from 'services/getCameraData'\nimport { CAMERA } from 'containers/MathObjects'\nimport styled, { keyframes } from 'styled-components'\n\nconst SharePopoverContainer = styled.div`\n  max-width: 300px;\n  display: flex;\n  align-items: center;\n  flex-direction:column;\n`\n\nconst CopyContainer = styled.div`\n  display: flex;\n  align-items: center;\n`\n\nconst fadeIn = keyframes`\n  from { opacity: 0 }\n  to { opacity: 1 }\n`\nconst CopyStatus = styled.div`\n  font-size: 125%;\n  width: 75px;\n  margin: 10px;\n  color: ${props => props.theme.primary[4]};\n  font-weight: strong;\n  visibility: ${props => props.isVisible ? 'visible' : 'hidden'};\n  animation: ${props => props.isVisible ? fadeIn : ''} 100ms linear;\n`\n\nconst copyButtonStyle = { margin: '10px' }\n\ntype Props = {\n  onClick: () => void,\n  // We need access to state, but no need to rerender on ever state change.\n  // So pass getState instead.\n  getState: () => {},\n  setProperty: SetProperty,\n  setCreationDate: SetCreationDate\n}\ntype State = {\n  id: ?string,\n  isCopied: boolean\n}\n\nconst URL_FRONT = process.env.NODE_ENV === 'development'\n  ? 'http://localhost:3000'\n  : 'https://www.math3d.org'\n\nexport default class ShareButton extends PureComponent<Props, State> {\n\n  state = {\n    id: null,\n    isCopied: false\n  }\n\n  dehydratedJson: ?string\n\n  getId() {\n    return randomstring.generate(8)\n  }\n\n  saveCameraData = () => {\n    const { position, lookAt } = getCameraData()\n    const id = 'camera'\n    const type = CAMERA\n    this.props.setProperty(id, type, 'relativePosition', position)\n    this.props.setProperty(id, type, 'relativeLookAt', lookAt)\n  }\n\n  saveGraph = () => {\n    this.saveCameraData()\n    this.props.setCreationDate()\n    const state = this.props.getState()\n    const dehydrated = dehydrate(state)\n    const id = this.getId()\n    saveGraph(id, dehydrated)\n    this.setState( { id } )\n    this.dehydratedJson = JSON.stringify(dehydrated)\n  }\n\n  onCopy = () => {\n    this.setState( { isCopied: true } )\n  }\n\n  onVisibleChange = (visible: boolean) => {\n    if (!visible) {\n      this.setState( { isCopied: false } )\n    }\n  }\n\n  renderContent() {\n    const url = this.state.id && `${URL_FRONT}/${this.state.id}`\n    return (\n      <SharePopoverContainer>\n        <Input readOnly={true} value={url}/>\n        <CopyContainer>\n          <CopyToClipboard text={url} onCopy={this.onCopy}>\n            <Button type='primary' style={copyButtonStyle} >Copy</Button>\n          </CopyToClipboard>\n          <CopyStatus isVisible={this.state.isCopied}>\n            Copied!\n          </CopyStatus>\n        </CopyContainer>\n        {\n          process.env.NODE_ENV === 'development' && (\n            <CopyToClipboard text={this.dehydratedJson}>\n              <Button type='danger'>Copy Dehydrated State (Dev Only)</Button>\n            </CopyToClipboard>\n          )\n        }\n\n      </SharePopoverContainer>\n    )\n  }\n\n  render() {\n    return (\n      <PopModal\n        title={'Share your scene'}\n        onVisibleChange={this.onVisibleChange}\n        source={\n          <span\n            onPointerDown={this.saveCameraData}\n            onClick={this.saveGraph}\n          >\n            <Icon type='cloud' style={ { paddingRight: '4px' } } />\n            Share\n          </span>\n        }\n      >\n        {this.renderContent()}\n      </PopModal>\n    )\n  }\n\n}\n","import { connect } from 'react-redux'\nimport ShareButton from './components/ShareButton'\nimport { setProperty } from 'containers/MathObjects/actions'\nimport { setCreationDate } from 'services/metadata/actions'\n\nconst mapStateToProps = null\nconst mapDispatchToState = { setProperty, setCreationDate }\n\nexport default connect(mapStateToProps, mapDispatchToState)(ShareButton)\n","// @flow\nimport styled from 'styled-components'\n\nexport default styled.span`\n  color: ${props => props.theme.gray[5]};\n  font-size: ${props => props.type === 'brand' ? '130%' : '115%'};\n  font-weight: ${props => props.type === 'brand' ? 900 : 'default'};\n`\n","// @flow\nimport React from 'react'\nimport EditableDescription from 'components/EditableDescription'\nimport { setTitle } from 'services/metadata/actions'\nimport { connect } from 'react-redux'\nimport styled from 'styled-components'\n\nconst StyledInput = styled(EditableDescription)`\n  background-color: rgba(0, 0, 0, 0);\n  margin-left:8px;\n  font-weight:bold;\n  padding-top:4px;\n`\n\ntype OwnProps = {||}\ntype StateProps = {|\n  title: string\n|}\ntype DispatchProps = {|\n  setTitle: (title: string) => void\n|}\ntype Props = {|\n  ...OwnProps,\n  ...StateProps,\n  ...DispatchProps\n|}\n\nfunction _TitleInput(props: Props) {\n  return (\n    <StyledInput\n      value={props.title}\n      onChange={props.setTitle}\n    />\n  )\n}\n\nconst mapStateToProps = ( { metadata } ) => ( {\n  title: metadata.title\n} )\n\nconst mapDispatchToProps = { setTitle }\n\nexport default connect<Props, OwnProps, _, _, _, _>(mapStateToProps, mapDispatchToProps)(_TitleInput)\n","// @flow\nimport React from 'react'\nimport { Icon } from 'antd'\nimport PopModal from 'components/PopModal'\nimport styled from 'styled-components'\n\nconst ContactList = styled.ul`\n  list-style-type: none;\n  padding-left:0px;\n`\n\nconst HelpPopoverContainer = styled.div`\n  max-width: 300px;\n  width:300px;\n`\n\nconst ContactIcon = styled(Icon)`\n  font-size:125%;\n  padding-right:5px;\n`\n\nconst Email = styled.span`\n  font-family: courier;\n  text-decoration: underline;\n`\n\nexport default function HelpButton() {\n\n  return (\n    <PopModal\n      title='Help/Contact'\n      source={\n        <span>\n          <Icon type=\"question-circle\" style={ { paddingRight: '4px' } } />\n          Help/Contact\n        </span>\n      }\n    >\n      <HelpPopoverContainer>\n        <p>Math3d.org is a work in progress. Have a question? Suggestion? Found a bug?</p>\n\n        <p>Let us know!</p>\n\n        <ContactList>\n          <li>\n\n            <ContactIcon type=\"github\" />\n            <a\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              href=\"https://github.com/ChristopherChudzicki/math3d-react/issues\"\n            >\n              Open an issue on Github.\n            </a>\n          </li>\n          <li>\n            <ContactIcon type=\"mail\" />\n            Email <Email>math3dapp@gmail.com</Email>\n          </li>\n        </ContactList>\n      </HelpPopoverContainer>\n    </PopModal>\n  )\n\n}\n","// @flow\nimport React, { PureComponent } from 'react'\nimport { Icon } from 'antd'\nimport { connect } from 'react-redux'\nimport { openDrawer, closeDrawer } from 'containers/Drawer/actions'\n\ntype OwnProps = {||}\ntype StateProps = {|\n  isVisible: boolean,\n|}\ntype DispatchProps = {|\n  closeDrawer: (id: string, animationSpeed?: string) => void,\n  openDrawer: (id: string, animationSpeed?: string) => void\n|}\ntype Props = {| ...OwnProps, ...StateProps, ...DispatchProps |}\n\nclass _ExamplesButton extends PureComponent<Props> {\n\n  onClick = () => {\n    if (this.props.isVisible) {\n      this.props.closeDrawer('examples')\n    }\n    else {\n      this.props.openDrawer('examples')\n    }\n  }\n\n  render() {\n    return (\n      <span onClick={this.onClick}>\n        <Icon type=\"bulb\" style={ { paddingRight: '4px' } } />\n        Examples\n      </span>\n    )\n  }\n\n}\n\nconst mapStateToProps = ( { drawers } ) => ( {\n  isVisible: drawers.examples.isVisible\n} )\n\nconst mapDispatchToProps = {\n  openDrawer,\n  closeDrawer\n}\n\nexport default connect<Props, OwnProps, _, _, _, _>(mapStateToProps, mapDispatchToProps)(_ExamplesButton)\n","// @flow\nimport * as React from 'react'\nimport { Dropdown, Button, Menu, Icon } from 'antd'\nimport theme from 'constants/theme'\nimport styled from 'styled-components'\nimport withSizes from 'react-sizes'\n\nconst IconHolder = styled.span`\n  display:flex;\n  justify-content: center;\n  align-items: center;\n  width: 32px;\n  font-size: 150%;\n`\n\nconst style = {\n  display: 'flex',\n  backgroundColor: theme.gray[1],\n  borderBottom: `1px solid ${theme.gray[5]}`\n}\n\ntype Props = {\n  children: React.Node,\n  collapsed: boolean\n}\n\nconst _HeaderMenu = (props: Props) => {\n\n  return props.collapsed\n    ? (\n      <Dropdown\n        overlay={<Menu>{props.children}</Menu>}\n        trigger={['click']}\n      >\n        <Button>\n          <IconHolder>\n            <Icon type=\"menu-unfold\" />\n          </IconHolder>\n        </Button>\n      </Dropdown>\n    )\n    : (\n      <Menu\n        style={style}\n        mode={'horizontal'}\n      >\n        {props.children}\n      </Menu>\n    )\n}\n\nconst mapSizesToProps = ( { width } ) => ( { collapsed: width < 570 } )\n\nexport default withSizes(mapSizesToProps)(_HeaderMenu)\n","// @flow\nimport React from 'react'\nimport styled from 'styled-components'\nimport { HEADER_HEIGHT_PX } from '../../../constants'\nimport ShareButton from './containers/ShareButton'\nimport HeaderButton from './components/HeaderButton'\nimport TitleInput from './containers/TitleInput'\nimport HelpButton from './components/HelpButton'\nimport ExamplesButton from './containers/ExamplesButton'\nimport store from 'store/index'\nimport HeaderMenu from './containers/HeaderMenu'\nimport { Menu } from 'antd'\nconst Item = Menu.Item\n\nconst HeaderContainer = styled.div`\n  background-color: ${props => props.theme.gray[1]};\n  height: ${ HEADER_HEIGHT_PX }px;\n  display:flex;\n  width:100%;\n  align-items:center;\n  justify-content: space-between;\n  border-bottom: 1pt solid ${props => props.theme.gray[5]};\n`\n\nconst HeaderGroup = styled.div`\n  padding-left: 10px;\n  padding-right: 10px;\n  display:flex;\n  align-items:center;\n`\n\nconst Header = () => {\n  return (\n    <HeaderContainer>\n      <HeaderGroup>\n        <HeaderButton type='brand'>Math3D</HeaderButton>\n        <TitleInput />\n      </HeaderGroup>\n      <HeaderGroup>\n        <HeaderMenu>\n          <Item><ExamplesButton /></Item>\n          <Item><ShareButton getState={store.getState}/></Item>\n          <Item><HelpButton/></Item>\n        </HeaderMenu>\n      </HeaderGroup>\n    </HeaderContainer>\n  )\n}\n\nexport default Header\n","// @flow\nimport React, { PureComponent } from 'react'\nimport FlexContainer from 'components/FlexContainer'\nimport UserControls from './UserControls'\nimport Scene from './Scene'\nimport Examples from './Examples'\nimport Header from './Header'\nimport { loadGraphFromDb } from './actions'\nimport { loadDehydratedState } from 'store/actions'\nimport initialState from 'store/initialState'\nimport { connect } from 'react-redux'\nimport { setLastSavedState } from 'services/lastSavedState/actions'\n\ntype OwnProps = {|\n  graphId?: string\n|}\n\ntype DispatchProps = {|\n  loadGraphFromDb: (id: string) => Function,\n  setLastSavedState: typeof setLastSavedState,\n  loadDehydratedState: (dehydrated: {} ) => void\n|}\n\ntype Props = {|\n  ...DispatchProps,\n  ...OwnProps\n|}\n\nclass MainView extends PureComponent<Props> {\n\n  componentDidMount() {\n    if (this.props.graphId) {\n      this.props.loadGraphFromDb(this.props.graphId)\n    }\n    this.props.setLastSavedState()\n  }\n\n  componentDidUpdate() {\n    if (this.props.graphId) {\n      this.props.loadGraphFromDb(this.props.graphId)\n    }\n    else {\n      this.props.loadDehydratedState(initialState)\n    }\n  }\n\n  render() {\n    return <FlexContainer style={ { overflow: 'hidden', flexDirection: 'column' } }>\n      <Header />\n      <FlexContainer>\n        <UserControls />\n        <Scene />\n        <Examples />\n      </FlexContainer>\n    </FlexContainer>\n  }\n\n}\n\nconst mapDispatchToProps = {\n  loadGraphFromDb,\n  loadDehydratedState,\n  setLastSavedState\n}\n\nexport default connect<Props, OwnProps, _, _, _, _>(null, mapDispatchToProps)(MainView)\n","import { getGraph } from 'services/api'\nimport { loadDehydratedState } from 'store/actions'\n\nexport function loadGraphFromDb(id) {\n\n  return async dispatch => {\n    const { dehydrated } = await getGraph(id)\n    if (dehydrated) {\n      const action = loadDehydratedState(dehydrated)\n      return dispatch(action)\n    }\n    else {\n      console.group()\n      console.warn(`Graph ${id} not found`)\n      // TODO: Better error handling on client\n      console.groupEnd()\n    }\n  }\n}\n","import React, { Component } from 'react'\nimport MainView from './views/MainView'\nimport { Switch, Route } from 'react-router-dom'\n\nclass App extends Component {\n\n  legacyReRoute( { match } ) {\n    // Redirect users to the old site\n    window.location = `https://math3d.herokuapp.com/graph/${match.params.id}`\n  }\n\n  renderGraph( { match } ) {\n    return (\n      <MainView graphId={match.params.id}/>\n    )\n  }\n\n  render() {\n    // NOTE: I tried path='/load/:graph' for the routes, but got strange errors\n    // that are possibly related to hacky mathbox imports.\n    // This seems to work...\n    return (\n      <Switch>\n        <Route exact path='/graph/:id' render={this.legacyReRoute}/>\n        <Route exact path='/:id' render={this.renderGraph}/>\n        <Route exact path='/' render={this.renderGraph}/>\n      </Switch>\n    )\n  }\n\n}\n\nexport default App\n","// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the old content will have been purged and\n              // the fresh content will have been added to the cache.\n              // It's the perfect time to display a \"New content is\n              // available; please refresh.\" message in your web app.\n              console.log('New content is available; please refresh.');\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type').indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react'\nimport store from './store'\nimport { render } from 'react-dom'\nimport { Provider } from 'react-redux'\nimport './index.css'\nimport App from './App'\nimport { unregister } from './registerServiceWorker'\nimport { hasMeaningfulChangeOccured } from './services/lastSavedState/index'\n\nimport MathScopeProvider from './containers/MathScopeContext'\nimport { scopeEvaluator, parser } from './constants/parsing'\n\nimport theme from './constants/theme'\nimport { ThemeProvider } from 'styled-components'\n\nimport { BrowserRouter } from 'react-router-dom'\n\nimport ReactGA from 'react-ga'\n// TODO: Replace this with redux-beacon middleware\nReactGA.initialize('UA-131928751-1', {\n  testMode: process.env.NODE_ENV === 'development'\n} )\nReactGA.pageview(window.location.pathname + window.location.search)\n\n// User confirmation for unload\nwindow.addEventListener('beforeunload', event => {\n  const newState = store.getState()\n  const oldState = newState.lastSavedState\n  const shouldWarn = hasMeaningfulChangeOccured(newState, oldState)\n  if (shouldWarn) {\n    event.preventDefault()\n    event.returnValue = ''\n  }\n})\n\nconst target = document.querySelector('#root')\n\nrender(\n  <Provider store={store}>\n    <MathScopeProvider scopeEvaluator={scopeEvaluator} parser={parser}>\n      <ThemeProvider theme={theme}>\n        <BrowserRouter>\n          <App />\n        </BrowserRouter>\n      </ThemeProvider>\n    </MathScopeProvider>\n  </Provider>,\n  target\n)\n\nunregister()\n","import deepEqual from 'deep-equal';\n\nexport function hasMeaningfulChangeOccured(newState, oldState) {\n  const exemptKeys = new Set([\n    'drawers',\n    'tabs',\n    'sliderValues',\n    'lastSavedState',\n    'activeObject'\n  ]);\n  return Object.keys(newState)\n    .filter(key => !exemptKeys.has(key))\n    .some(key => {\n      const oldValue = oldState[key]\n      const newValue = newState[key]\n      return !deepEqual(newValue, oldValue)\n    })\n}"],"sourceRoot":""}